<!DOCTYPE html>

<html>
<head>
  <title>qunit-image.js</title>
  <meta http-equiv="content-type" content="text/html; charset=UTF-8">
  <meta name="viewport" content="width=device-width, target-densitydpi=160dpi, initial-scale=1.0; maximum-scale=1.0; user-scalable=0;">
  <link rel="stylesheet" media="all" href="docco.css" />
</head>
<body>
  <div id="container">
    <div id="background"></div>
    
    <ul class="sections">  
        <li id="title">
            <div class="annotation">
                <h1>qunit-image.js</h1>
            </div>
        </li>
        
           
        <li id="section-1">
            <div class="annotation">
              <div class="pilwrap">
                <a class="pilcrow" href="#section-1">&#182;</a>
              </div>            
              <p>qunit-image.js is an QUnit addon for comparing images.</p>
<h2>Version</h2>
<p>v0.0.1 - 2013-06-23  </p>
<h2>License</h2>
<p>Copyright Â© 2013 Alexander Zeilmann<br>qunit-image.js is <a href="http://MathLib.de/en/license">licensed under the MIT license</a></p>
<p>Includes a custom build of Lo-Dash (published under the MIT license).</p>
<h2>Documentation</h2>
<p>The source code is annotated using <a href="https://github.com/jashkenas/docco" title="View Docco on GitHub">Docco</a></p>

            </div>
            
            <div class="content"><div class="highlight"><pre><span class="nx">QUnit</span><span class="p">.</span><span class="nx">extend</span><span class="p">(</span><span class="nx">QUnit</span><span class="p">.</span><span class="nx">assert</span><span class="p">,</span> <span class="p">{</span>
  <span class="nx">imageEqual</span><span class="o">:</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">actual</span><span class="p">,</span> <span class="nx">expected</span><span class="p">,</span> <span class="nx">options</span><span class="p">)</span> <span class="p">{</span>

    <span class="nx">options</span> <span class="o">=</span> <span class="nx">options</span> <span class="o">||</span> <span class="p">{};</span>

    <span class="kd">var</span> <span class="nx">actCanvas</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">createElement</span><span class="p">(</span><span class="s1">&#39;canvas&#39;</span><span class="p">),</span>
        <span class="nx">actImage</span><span class="p">,</span> <span class="nx">actCtx</span><span class="p">,</span> <span class="nx">actData</span><span class="p">,</span>
        <span class="nx">expCanvas</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">createElement</span><span class="p">(</span><span class="s1">&#39;canvas&#39;</span><span class="p">),</span>
        <span class="nx">expImage</span><span class="p">,</span> <span class="nx">expCtx</span><span class="p">,</span> <span class="nx">expData</span><span class="p">,</span>
        <span class="nx">diffCanvas</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">createElement</span><span class="p">(</span><span class="s1">&#39;canvas&#39;</span><span class="p">),</span>
        <span class="nx">diffCtx</span><span class="p">,</span> <span class="nx">diffData</span><span class="p">,</span>
        <span class="nx">tester</span><span class="p">,</span>
        <span class="nx">channelErrors</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
        <span class="nx">imageDistance</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
        <span class="nx">allImagesLoaded</span> <span class="o">=</span> <span class="kc">false</span><span class="p">,</span>
        <span class="nx">passed</span> <span class="o">=</span> <span class="kc">true</span><span class="p">,</span>
        <span class="nx">width</span> <span class="o">=</span> <span class="nx">options</span><span class="p">.</span><span class="nx">width</span> <span class="o">||</span> <span class="mi">300</span><span class="p">,</span>
        <span class="nx">height</span> <span class="o">=</span> <span class="nx">options</span><span class="p">.</span><span class="nx">height</span> <span class="o">||</span> <span class="mi">300</span><span class="p">,</span>
        <span class="nx">max</span> <span class="o">=</span> <span class="mi">80</span><span class="p">,</span>
        <span class="nx">slope</span> <span class="o">=</span> <span class="mi">510</span> <span class="o">/</span> <span class="nx">max</span><span class="p">,</span>
        <span class="nx">id</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
        <span class="nx">message</span><span class="p">,</span> <span class="nx">i</span><span class="p">,</span> <span class="nx">ii</span><span class="p">,</span> <span class="nx">rdiff</span><span class="p">,</span> <span class="nx">gdiff</span><span class="p">,</span> <span class="nx">bdiff</span><span class="p">,</span> <span class="nx">adiff</span><span class="p">,</span> <span class="nx">hue</span><span class="p">,</span> <span class="nx">pixelError</span><span class="p">;</span>


    <span class="nb">window</span><span class="p">.</span><span class="nx">qunitImage</span> <span class="o">=</span> <span class="nb">window</span><span class="p">.</span><span class="nx">qunitImage</span> <span class="o">||</span> <span class="p">{</span>
      <span class="nx">tests</span><span class="o">:</span> <span class="p">[],</span>
      <span class="nx">id</span><span class="o">:</span> <span class="mi">0</span>
    <span class="p">};</span></pre></div></div>
            
        </li>
        
           
        <li id="section-2">
            <div class="annotation">
              <div class="pilwrap">
                <a class="pilcrow" href="#section-2">&#182;</a>
              </div>            
              
<p>This function is running after both images are loaded.
And is doing the complete testing</p>

            </div>
            
            <div class="content"><div class="highlight"><pre>    <span class="nx">tester</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>

      <span class="nx">expData</span> <span class="o">=</span> <span class="nx">expCtx</span><span class="p">.</span><span class="nx">getImageData</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="nx">width</span><span class="p">,</span> <span class="nx">height</span><span class="p">).</span><span class="nx">data</span><span class="p">;</span>
      <span class="nx">actData</span> <span class="o">=</span> <span class="nx">actCtx</span><span class="p">.</span><span class="nx">getImageData</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="nx">width</span><span class="p">,</span> <span class="nx">height</span><span class="p">).</span><span class="nx">data</span><span class="p">;</span>

      <span class="nx">diffCanvas</span><span class="p">.</span><span class="nx">height</span> <span class="o">=</span> <span class="nx">height</span><span class="p">;</span>
      <span class="nx">diffCanvas</span><span class="p">.</span><span class="nx">width</span> <span class="o">=</span> <span class="nx">width</span><span class="p">;</span>
      <span class="nx">diffCtx</span> <span class="o">=</span> <span class="nx">diffCanvas</span><span class="p">.</span><span class="nx">getContext</span><span class="p">(</span><span class="s1">&#39;2d&#39;</span><span class="p">);</span>
      <span class="nx">diffData</span> <span class="o">=</span> <span class="nx">diffCtx</span><span class="p">.</span><span class="nx">getImageData</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="nx">width</span><span class="p">,</span> <span class="nx">height</span><span class="p">);</span></pre></div></div>
            
        </li>
        
           
        <li id="section-3">
            <div class="annotation">
              <div class="pilwrap">
                <a class="pilcrow" href="#section-3">&#182;</a>
              </div>            
              
<p>We are using a very primitive comparison algorithm.
Perhaps I implement a better Delta-E sometime.</p>

            </div>
            
            <div class="content"><div class="highlight"><pre>      <span class="k">for</span> <span class="p">(</span><span class="nx">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="nx">ii</span> <span class="o">=</span> <span class="mi">4</span> <span class="o">*</span> <span class="nx">width</span> <span class="o">*</span> <span class="nx">height</span><span class="p">;</span> <span class="nx">i</span> <span class="o">&lt;</span> <span class="nx">ii</span><span class="p">;</span> <span class="nx">i</span> <span class="o">+=</span> <span class="mi">4</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">rdiff</span> <span class="o">=</span> <span class="nb">Math</span><span class="p">.</span><span class="nx">abs</span><span class="p">(</span><span class="nx">expData</span><span class="p">[</span><span class="nx">i</span><span class="p">]</span>     <span class="o">-</span> <span class="nx">actData</span><span class="p">[</span><span class="nx">i</span><span class="p">]);</span>
        <span class="nx">gdiff</span> <span class="o">=</span> <span class="nb">Math</span><span class="p">.</span><span class="nx">abs</span><span class="p">(</span><span class="nx">expData</span><span class="p">[</span><span class="nx">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="nx">actData</span><span class="p">[</span><span class="nx">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]);</span>
        <span class="nx">bdiff</span> <span class="o">=</span> <span class="nb">Math</span><span class="p">.</span><span class="nx">abs</span><span class="p">(</span><span class="nx">expData</span><span class="p">[</span><span class="nx">i</span> <span class="o">+</span> <span class="mi">2</span><span class="p">]</span> <span class="o">-</span> <span class="nx">actData</span><span class="p">[</span><span class="nx">i</span> <span class="o">+</span> <span class="mi">2</span><span class="p">]);</span>
        <span class="nx">adiff</span> <span class="o">=</span> <span class="nb">Math</span><span class="p">.</span><span class="nx">abs</span><span class="p">(</span><span class="nx">expData</span><span class="p">[</span><span class="nx">i</span> <span class="o">+</span> <span class="mi">3</span><span class="p">]</span> <span class="o">-</span> <span class="nx">actData</span><span class="p">[</span><span class="nx">i</span> <span class="o">+</span> <span class="mi">3</span><span class="p">]);</span>

        <span class="nx">pixelError</span> <span class="o">=</span> <span class="nx">rdiff</span> <span class="o">+</span> <span class="nx">gdiff</span> <span class="o">+</span> <span class="nx">bdiff</span> <span class="o">+</span> <span class="nx">adiff</span><span class="p">;</span>
        <span class="nx">imageDistance</span> <span class="o">+=</span> <span class="nx">pixelError</span><span class="p">;</span>
        <span class="nx">channelErrors</span> <span class="o">+=</span> <span class="o">!!</span><span class="nx">rdiff</span> <span class="o">+</span> <span class="o">!!</span><span class="nx">gdiff</span> <span class="o">+</span> <span class="o">!!</span><span class="nx">bdiff</span> <span class="o">+</span> <span class="o">!!</span><span class="nx">adiff</span><span class="p">;</span>

        <span class="nx">hue</span> <span class="o">=</span> <span class="nx">slope</span> <span class="o">*</span> <span class="nb">Math</span><span class="p">.</span><span class="nx">min</span><span class="p">(</span><span class="nx">max</span><span class="p">,</span> <span class="nx">pixelError</span><span class="p">);</span>

        <span class="nx">diffData</span><span class="p">.</span><span class="nx">data</span><span class="p">[</span><span class="nx">i</span><span class="p">]</span>     <span class="o">=</span> <span class="nb">Math</span><span class="p">.</span><span class="nx">min</span><span class="p">(</span><span class="mi">255</span><span class="p">,</span> <span class="nx">hue</span><span class="p">);</span>
        <span class="nx">diffData</span><span class="p">.</span><span class="nx">data</span><span class="p">[</span><span class="nx">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="nb">Math</span><span class="p">.</span><span class="nx">min</span><span class="p">(</span><span class="mi">255</span><span class="p">,</span> <span class="mi">510</span> <span class="o">-</span> <span class="nx">hue</span><span class="p">);</span>
        <span class="nx">diffData</span><span class="p">.</span><span class="nx">data</span><span class="p">[</span><span class="nx">i</span> <span class="o">+</span> <span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
        <span class="nx">diffData</span><span class="p">.</span><span class="nx">data</span><span class="p">[</span><span class="nx">i</span> <span class="o">+</span> <span class="mi">3</span><span class="p">]</span> <span class="o">=</span> <span class="mi">255</span><span class="p">;</span>
      <span class="p">}</span>

      <span class="nx">diffCtx</span><span class="p">.</span><span class="nx">putImageData</span><span class="p">(</span><span class="nx">diffData</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span></pre></div></div>
            
        </li>
        
           
        <li id="section-4">
            <div class="annotation">
              <div class="pilwrap">
                <a class="pilcrow" href="#section-4">&#182;</a>
              </div>            
              
<p>Decide if the test should fail or pass</p>

            </div>
            
            <div class="content"><div class="highlight"><pre>      <span class="k">if</span> <span class="p">(</span><span class="s1">&#39;imageDistance&#39;</span> <span class="k">in</span> <span class="nx">options</span> <span class="o">||</span> <span class="s1">&#39;channelErrors&#39;</span> <span class="k">in</span> <span class="nx">options</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="s1">&#39;imageDistance&#39;</span> <span class="k">in</span> <span class="nx">options</span><span class="p">)</span> <span class="p">{</span>
          <span class="nx">passed</span> <span class="o">=</span> <span class="nx">passed</span> <span class="o">&amp;&amp;</span> <span class="nx">width</span> <span class="o">*</span> <span class="nx">height</span> <span class="o">*</span> <span class="mi">4</span> <span class="o">*</span> <span class="nx">options</span><span class="p">.</span><span class="nx">imageDistance</span> <span class="o">&gt;</span> <span class="nx">imageDistance</span><span class="p">;</span>
        <span class="p">}</span>
        <span class="k">if</span> <span class="p">(</span><span class="s1">&#39;channelErrors&#39;</span> <span class="k">in</span> <span class="nx">options</span><span class="p">)</span> <span class="p">{</span>
          <span class="nx">passed</span> <span class="o">=</span> <span class="nx">passed</span> <span class="o">&amp;&amp;</span> <span class="nx">width</span> <span class="o">*</span> <span class="nx">height</span> <span class="o">*</span> <span class="mi">4</span> <span class="o">*</span> <span class="nx">options</span><span class="p">.</span><span class="nx">channelErrors</span> <span class="o">&gt;</span> <span class="nx">channelErrors</span><span class="p">;</span>
        <span class="p">}</span>
      <span class="p">}</span></pre></div></div>
            
        </li>
        
           
        <li id="section-5">
            <div class="annotation">
              <div class="pilwrap">
                <a class="pilcrow" href="#section-5">&#182;</a>
              </div>            
              
<p>If there are no preferences use imageDistance = 0.5</p>

            </div>
            
            <div class="content"><div class="highlight"><pre>      <span class="k">else</span> <span class="p">{</span>
        <span class="nx">passed</span> <span class="o">=</span> <span class="nx">width</span> <span class="o">*</span> <span class="nx">height</span> <span class="o">*</span> <span class="mi">4</span> <span class="o">*</span> <span class="mf">0.5</span> <span class="o">&gt;</span> <span class="nx">imageDistance</span><span class="p">;</span>
      <span class="p">}</span></pre></div></div>
            
        </li>
        
           
        <li id="section-6">
            <div class="annotation">
              <div class="pilwrap">
                <a class="pilcrow" href="#section-6">&#182;</a>
              </div>            
              
<p>Generate the HTML with the template</p>

            </div>
            
            <div class="content"><div class="highlight"><pre>      <span class="nx">message</span> <span class="o">=</span> <span class="nx">JST</span><span class="p">[</span><span class="s1">&#39;src/qunit-image.hbs&#39;</span><span class="p">]({</span>
        <span class="nx">id</span><span class="o">:</span> <span class="nb">window</span><span class="p">.</span><span class="nx">qunitImage</span><span class="p">.</span><span class="nx">id</span><span class="p">,</span>
        <span class="nx">width</span><span class="o">:</span> <span class="nx">width</span><span class="p">,</span>
        <span class="nx">height</span><span class="o">:</span> <span class="nx">height</span><span class="p">,</span>
        <span class="nx">channelErrors</span><span class="o">:</span> <span class="nx">channelErrors</span><span class="p">,</span>
        <span class="nx">imageDistance</span><span class="o">:</span> <span class="nx">imageDistance</span><span class="p">,</span>
        <span class="nx">actCanvas</span><span class="o">:</span> <span class="nx">actCanvas</span><span class="p">.</span><span class="nx">toDataURL</span><span class="p">(),</span>
        <span class="nx">expCanvas</span><span class="o">:</span> <span class="nx">expCanvas</span><span class="p">.</span><span class="nx">toDataURL</span><span class="p">(),</span>
        <span class="nx">diffCanvas</span><span class="o">:</span> <span class="nx">diffCanvas</span><span class="p">.</span><span class="nx">toDataURL</span><span class="p">()</span>
      <span class="p">});</span>

      <span class="nb">window</span><span class="p">.</span><span class="nx">qunitImage</span><span class="p">.</span><span class="nx">tests</span><span class="p">.</span><span class="nx">push</span><span class="p">({</span>
        <span class="nx">id</span><span class="o">:</span> <span class="nb">window</span><span class="p">.</span><span class="nx">qunitImage</span><span class="p">.</span><span class="nx">id</span><span class="p">,</span>
        <span class="nx">width</span><span class="o">:</span> <span class="nx">width</span><span class="p">,</span>
        <span class="nx">height</span><span class="o">:</span> <span class="nx">height</span><span class="p">,</span>
        <span class="nx">channelErrors</span><span class="o">:</span> <span class="nx">channelErrors</span><span class="p">,</span>
        <span class="nx">imageDistance</span><span class="o">:</span> <span class="nx">imageDistance</span><span class="p">,</span>
        <span class="nx">actual</span><span class="o">:</span> <span class="p">{</span>
          <span class="nx">canvas</span><span class="o">:</span> <span class="nx">actCanvas</span><span class="p">,</span>
          <span class="nx">ctx</span><span class="o">:</span> <span class="nx">actCtx</span><span class="p">,</span>
          <span class="nx">data</span><span class="o">:</span> <span class="nx">actData</span>
        <span class="p">},</span>
        <span class="nx">expected</span><span class="o">:</span> <span class="p">{</span>
          <span class="nx">canvas</span><span class="o">:</span> <span class="nx">expCanvas</span><span class="p">,</span>
          <span class="nx">ctx</span><span class="o">:</span> <span class="nx">expCtx</span><span class="p">,</span>
          <span class="nx">data</span><span class="o">:</span> <span class="nx">expData</span>
        <span class="p">},</span>
        <span class="nx">diffCanvas</span><span class="o">:</span> <span class="p">{</span>
          <span class="nx">canvas</span><span class="o">:</span> <span class="nx">diffCanvas</span><span class="p">,</span>
          <span class="nx">ctx</span><span class="o">:</span> <span class="nx">diffCtx</span><span class="p">,</span>
          <span class="nx">data</span><span class="o">:</span> <span class="nx">diffData</span>
        <span class="p">}</span>
      <span class="p">});</span></pre></div></div>
            
        </li>
        
           
        <li id="section-7">
            <div class="annotation">
              <div class="pilwrap">
                <a class="pilcrow" href="#section-7">&#182;</a>
              </div>            
              
<p>Increase the id counter</p>

            </div>
            
            <div class="content"><div class="highlight"><pre>      <span class="nb">window</span><span class="p">.</span><span class="nx">qunitImage</span><span class="p">.</span><span class="nx">id</span><span class="o">++</span><span class="p">;</span></pre></div></div>
            
        </li>
        
           
        <li id="section-8">
            <div class="annotation">
              <div class="pilwrap">
                <a class="pilcrow" href="#section-8">&#182;</a>
              </div>            
              
<p>Pass the results to QUnit</p>

            </div>
            
            <div class="content"><div class="highlight"><pre>      <span class="nx">QUnit</span><span class="p">.</span><span class="nx">config</span><span class="p">.</span><span class="nx">current</span><span class="p">.</span><span class="nx">assertions</span><span class="p">.</span><span class="nx">push</span><span class="p">({</span>
        <span class="nx">result</span><span class="o">:</span> <span class="nx">passed</span><span class="p">,</span>
        <span class="nx">message</span><span class="o">:</span> <span class="nx">message</span>
      <span class="p">});</span>

    <span class="p">};</span></pre></div></div>
            
        </li>
        
           
        <li id="section-9">
            <div class="annotation">
              <div class="pilwrap">
                <a class="pilcrow" href="#section-9">&#182;</a>
              </div>            
              
<p>Now let&#39;s load the images/canvas elements
First the actual image (the one to be tested)</p>

            </div>
            
            <div class="content"><div class="highlight"><pre>    <span class="k">if</span> <span class="p">(</span><span class="k">typeof</span> <span class="nx">actual</span> <span class="o">===</span> <span class="s1">&#39;string&#39;</span><span class="p">)</span> <span class="p">{</span>

      <span class="nx">actImage</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Image</span><span class="p">();</span>
      <span class="nx">actImage</span><span class="p">.</span><span class="nx">onload</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
        <span class="nx">actCanvas</span><span class="p">.</span><span class="nx">height</span> <span class="o">=</span> <span class="nx">height</span><span class="p">;</span>
        <span class="nx">actCanvas</span><span class="p">.</span><span class="nx">width</span> <span class="o">=</span> <span class="nx">width</span><span class="p">;</span>
        <span class="nx">actCtx</span> <span class="o">=</span> <span class="nx">actCanvas</span><span class="p">.</span><span class="nx">getContext</span><span class="p">(</span><span class="s1">&#39;2d&#39;</span><span class="p">);</span>
        <span class="nx">actCtx</span><span class="p">.</span><span class="nx">drawImage</span><span class="p">(</span><span class="nx">actImage</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span></pre></div></div>
            
        </li>
        
           
        <li id="section-10">
            <div class="annotation">
              <div class="pilwrap">
                <a class="pilcrow" href="#section-10">&#182;</a>
              </div>            
              
<p>Only start the tester if both images are loaded</p>

            </div>
            
            <div class="content"><div class="highlight"><pre>        <span class="k">if</span> <span class="p">(</span><span class="nx">allImagesLoaded</span><span class="p">)</span> <span class="p">{</span>
          <span class="k">if</span> <span class="p">(</span><span class="nx">QUnit</span><span class="p">.</span><span class="nx">config</span><span class="p">.</span><span class="nx">semaphore</span> <span class="o">!==</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
            <span class="nx">QUnit</span><span class="p">.</span><span class="nx">start</span><span class="p">();</span>
          <span class="p">}</span>
          <span class="nx">tester</span><span class="p">();</span>
        <span class="p">}</span>
        <span class="k">else</span> <span class="p">{</span>
          <span class="nx">allImagesLoaded</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span>
        <span class="p">}</span>
      <span class="p">};</span></pre></div></div>
            
        </li>
        
           
        <li id="section-11">
            <div class="annotation">
              <div class="pilwrap">
                <a class="pilcrow" href="#section-11">&#182;</a>
              </div>            
              
<p>Start loading the image</p>

            </div>
            
            <div class="content"><div class="highlight"><pre>      <span class="nx">actImage</span><span class="p">.</span><span class="nx">src</span> <span class="o">=</span> <span class="nx">actual</span><span class="p">;</span>
    <span class="p">}</span></pre></div></div>
            
        </li>
        
           
        <li id="section-12">
            <div class="annotation">
              <div class="pilwrap">
                <a class="pilcrow" href="#section-12">&#182;</a>
              </div>            
              
<p>Else &quot;actual&quot; should be a canvas</p>

            </div>
            
            <div class="content"><div class="highlight"><pre>    <span class="k">else</span> <span class="p">{</span>
      <span class="nx">actCanvas</span> <span class="o">=</span> <span class="nx">actual</span><span class="p">;</span>
      <span class="nx">actCtx</span> <span class="o">=</span> <span class="nx">actCanvas</span><span class="p">.</span><span class="nx">getContext</span><span class="p">(</span><span class="s1">&#39;2d&#39;</span><span class="p">);</span>      

      <span class="k">if</span> <span class="p">(</span><span class="nx">allImagesLoaded</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="nx">QUnit</span><span class="p">.</span><span class="nx">config</span><span class="p">.</span><span class="nx">semaphore</span> <span class="o">!==</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
          <span class="nx">QUnit</span><span class="p">.</span><span class="nx">start</span><span class="p">();</span>
        <span class="p">}</span>
        <span class="nx">tester</span><span class="p">();</span>
      <span class="p">}</span>
      <span class="k">else</span> <span class="p">{</span>
        <span class="nx">allImagesLoaded</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span>
      <span class="p">}</span>
    <span class="p">}</span></pre></div></div>
            
        </li>
        
           
        <li id="section-13">
            <div class="annotation">
              <div class="pilwrap">
                <a class="pilcrow" href="#section-13">&#182;</a>
              </div>            
              
<p>And the expected image</p>

            </div>
            
            <div class="content"><div class="highlight"><pre>    <span class="k">if</span> <span class="p">(</span><span class="k">typeof</span> <span class="nx">expected</span> <span class="o">===</span> <span class="s1">&#39;string&#39;</span><span class="p">)</span> <span class="p">{</span>

      <span class="nx">expImage</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Image</span><span class="p">();</span>
      <span class="nx">expImage</span><span class="p">.</span><span class="nx">onload</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
        <span class="nx">expCanvas</span><span class="p">.</span><span class="nx">height</span> <span class="o">=</span> <span class="nx">height</span><span class="p">;</span>
        <span class="nx">expCanvas</span><span class="p">.</span><span class="nx">width</span> <span class="o">=</span> <span class="nx">width</span><span class="p">;</span>
        <span class="nx">expCtx</span> <span class="o">=</span> <span class="nx">expCanvas</span><span class="p">.</span><span class="nx">getContext</span><span class="p">(</span><span class="s1">&#39;2d&#39;</span><span class="p">);</span>
        <span class="nx">expCtx</span><span class="p">.</span><span class="nx">drawImage</span><span class="p">(</span><span class="nx">expImage</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>

        <span class="k">if</span> <span class="p">(</span><span class="nx">allImagesLoaded</span><span class="p">)</span> <span class="p">{</span>
          <span class="k">if</span> <span class="p">(</span><span class="nx">QUnit</span><span class="p">.</span><span class="nx">config</span><span class="p">.</span><span class="nx">semaphore</span> <span class="o">!==</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
            <span class="nx">QUnit</span><span class="p">.</span><span class="nx">start</span><span class="p">();</span>
          <span class="p">}</span>
          <span class="nx">tester</span><span class="p">();</span>
        <span class="p">}</span>
        <span class="k">else</span> <span class="p">{</span>
          <span class="nx">allImagesLoaded</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span>
        <span class="p">}</span>
      <span class="p">};</span>
      <span class="nx">expImage</span><span class="p">.</span><span class="nx">src</span> <span class="o">=</span> <span class="nx">expected</span><span class="p">;</span>

    <span class="p">}</span>
    <span class="k">else</span> <span class="p">{</span>
      <span class="nx">expCanvas</span> <span class="o">=</span> <span class="nx">expected</span><span class="p">;</span>
      <span class="nx">expCtx</span> <span class="o">=</span> <span class="nx">expCanvas</span><span class="p">.</span><span class="nx">getContext</span><span class="p">(</span><span class="s1">&#39;2d&#39;</span><span class="p">);</span>

      <span class="k">if</span> <span class="p">(</span><span class="nx">allImagesLoaded</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="nx">QUnit</span><span class="p">.</span><span class="nx">config</span><span class="p">.</span><span class="nx">semaphore</span> <span class="o">!==</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
          <span class="nx">QUnit</span><span class="p">.</span><span class="nx">start</span><span class="p">();</span>
        <span class="p">}</span>
        <span class="nx">tester</span><span class="p">();</span>
      <span class="p">}</span>
      <span class="k">else</span> <span class="p">{</span>
        <span class="nx">allImagesLoaded</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span>
      <span class="p">}</span>
    <span class="p">}</span>
  <span class="p">}</span>
<span class="p">});</span></pre></div></div>
            
        </li>
        
           
        <li id="section-14">
            <div class="annotation">
              <div class="pilwrap">
                <a class="pilcrow" href="#section-14">&#182;</a>
              </div>            
              
<p>Register some event handlers for making the image comparison interactive
They are running after QUnit is completely done.</p>

            </div>
            
            <div class="content"><div class="highlight"><pre><span class="nx">QUnit</span><span class="p">.</span><span class="nx">done</span><span class="p">(</span><span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>

  <span class="nb">Array</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">forEach</span><span class="p">.</span><span class="nx">call</span><span class="p">(</span>
    <span class="nb">document</span><span class="p">.</span><span class="nx">getElementsByClassName</span><span class="p">(</span><span class="s1">&#39;qunit-image-select&#39;</span><span class="p">),</span>
    <span class="kd">function</span> <span class="p">(</span><span class="nx">elem</span><span class="p">)</span> <span class="p">{</span>
      <span class="nx">elem</span><span class="p">.</span><span class="nx">addEventListener</span><span class="p">(</span><span class="s1">&#39;change&#39;</span><span class="p">,</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">evt</span><span class="p">)</span> <span class="p">{</span>
        <span class="kd">var</span> <span class="nx">wrapper</span> <span class="o">=</span> <span class="nx">evt</span><span class="p">.</span><span class="nx">target</span><span class="p">.</span><span class="nx">parentElement</span><span class="p">.</span><span class="nx">nextElementSibling</span><span class="p">;</span>

        <span class="nx">wrapper</span><span class="p">.</span><span class="nx">getElementsByClassName</span><span class="p">(</span><span class="s1">&#39;qunit-image-isVisible&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">].</span><span class="nx">classList</span><span class="p">.</span><span class="nx">remove</span><span class="p">(</span><span class="s1">&#39;qunit-image-isVisible&#39;</span><span class="p">);</span>
        <span class="nx">wrapper</span><span class="p">.</span><span class="nx">children</span><span class="p">[</span><span class="nx">evt</span><span class="p">.</span><span class="nx">target</span><span class="p">.</span><span class="nx">value</span><span class="p">].</span><span class="nx">classList</span><span class="p">.</span><span class="nx">add</span><span class="p">(</span><span class="s1">&#39;qunit-image-isVisible&#39;</span><span class="p">);</span>
      <span class="p">});</span>
    <span class="p">}</span>
  <span class="p">);</span>

  <span class="nb">Array</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">forEach</span><span class="p">.</span><span class="nx">call</span><span class="p">(</span>
    <span class="nb">document</span><span class="p">.</span><span class="nx">getElementsByClassName</span><span class="p">(</span><span class="s1">&#39;qunit-image-range-clip&#39;</span><span class="p">),</span>
    <span class="kd">function</span> <span class="p">(</span><span class="nx">elem</span><span class="p">)</span> <span class="p">{</span>
      <span class="nx">elem</span><span class="p">.</span><span class="nx">addEventListener</span><span class="p">(</span><span class="s1">&#39;input&#39;</span><span class="p">,</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">evt</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">evt</span><span class="p">.</span><span class="nx">target</span><span class="p">.</span><span class="nx">nextElementSibling</span><span class="p">.</span><span class="nx">children</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="nx">style</span><span class="p">.</span><span class="nx">setProperty</span><span class="p">(</span><span class="s1">&#39;clip&#39;</span><span class="p">,</span> <span class="s1">&#39;rect(0px, 300px, 300px, &#39;</span> <span class="o">+</span> <span class="nx">evt</span><span class="p">.</span><span class="nx">target</span><span class="p">.</span><span class="nx">value</span> <span class="o">+</span> <span class="s1">&#39;px)&#39;</span><span class="p">);</span>
        <span class="nx">evt</span><span class="p">.</span><span class="nx">target</span><span class="p">.</span><span class="nx">nextElementSibling</span><span class="p">.</span><span class="nx">children</span><span class="p">[</span><span class="mi">1</span><span class="p">].</span><span class="nx">style</span><span class="p">.</span><span class="nx">setProperty</span><span class="p">(</span><span class="s1">&#39;clip&#39;</span><span class="p">,</span> <span class="s1">&#39;rect(0px, &#39;</span> <span class="o">+</span> <span class="nx">evt</span><span class="p">.</span><span class="nx">target</span><span class="p">.</span><span class="nx">value</span> <span class="o">+</span> <span class="s1">&#39;px, 300px, 0px)&#39;</span><span class="p">);</span>
      <span class="p">});</span>
    <span class="p">}</span>
  <span class="p">);</span>

  <span class="nb">Array</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">forEach</span><span class="p">.</span><span class="nx">call</span><span class="p">(</span>
    <span class="nb">document</span><span class="p">.</span><span class="nx">getElementsByClassName</span><span class="p">(</span><span class="s1">&#39;qunit-image-range-opacity&#39;</span><span class="p">),</span>
    <span class="kd">function</span> <span class="p">(</span><span class="nx">elem</span><span class="p">)</span> <span class="p">{</span>
      <span class="nx">elem</span><span class="p">.</span><span class="nx">addEventListener</span><span class="p">(</span><span class="s1">&#39;input&#39;</span><span class="p">,</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">evt</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">evt</span><span class="p">.</span><span class="nx">target</span><span class="p">.</span><span class="nx">nextElementSibling</span><span class="p">.</span><span class="nx">children</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="nx">style</span><span class="p">.</span><span class="nx">setProperty</span><span class="p">(</span><span class="s1">&#39;opacity&#39;</span><span class="p">,</span> <span class="mi">1</span> <span class="o">-</span> <span class="nx">evt</span><span class="p">.</span><span class="nx">target</span><span class="p">.</span><span class="nx">value</span><span class="p">);</span>
        <span class="nx">evt</span><span class="p">.</span><span class="nx">target</span><span class="p">.</span><span class="nx">nextElementSibling</span><span class="p">.</span><span class="nx">children</span><span class="p">[</span><span class="mi">1</span><span class="p">].</span><span class="nx">style</span><span class="p">.</span><span class="nx">setProperty</span><span class="p">(</span><span class="s1">&#39;opacity&#39;</span><span class="p">,</span> <span class="nx">evt</span><span class="p">.</span><span class="nx">target</span><span class="p">.</span><span class="nx">value</span><span class="p">);</span>
      <span class="p">});</span>
    <span class="p">}</span>
  <span class="p">);</span>

  <span class="nb">Array</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">forEach</span><span class="p">.</span><span class="nx">call</span><span class="p">(</span>
    <span class="nb">document</span><span class="p">.</span><span class="nx">getElementsByClassName</span><span class="p">(</span><span class="s1">&#39;qunit-image-img&#39;</span><span class="p">),</span>
    <span class="kd">function</span> <span class="p">(</span><span class="nx">elem</span><span class="p">,</span> <span class="nx">index</span><span class="p">)</span> <span class="p">{</span>
      <span class="nx">elem</span><span class="p">.</span><span class="nx">addEventListener</span><span class="p">(</span><span class="s1">&#39;mouseover&#39;</span><span class="p">,</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">evt</span><span class="p">)</span> <span class="p">{</span>
        <span class="kd">var</span> <span class="nx">id</span> <span class="o">=</span> <span class="nx">evt</span><span class="p">.</span><span class="nx">target</span><span class="p">.</span><span class="nx">getAttribute</span><span class="p">(</span><span class="s1">&#39;data-id&#39;</span><span class="p">),</span>
            <span class="nx">wrapper</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">getElementById</span><span class="p">(</span><span class="s1">&#39;qunit-image-pixelComparison-&#39;</span> <span class="o">+</span> <span class="nx">id</span><span class="p">);</span>

        <span class="nx">wrapper</span><span class="p">.</span><span class="nx">children</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="nx">style</span><span class="p">.</span><span class="nx">setProperty</span><span class="p">(</span><span class="s1">&#39;display&#39;</span><span class="p">,</span> <span class="s1">&#39;none&#39;</span><span class="p">);</span>
        <span class="nx">wrapper</span><span class="p">.</span><span class="nx">children</span><span class="p">[</span><span class="mi">1</span><span class="p">].</span><span class="nx">style</span><span class="p">.</span><span class="nx">setProperty</span><span class="p">(</span><span class="s1">&#39;display&#39;</span><span class="p">,</span> <span class="s1">&#39;block&#39;</span><span class="p">);</span>
      <span class="p">},</span> <span class="kc">false</span><span class="p">);</span>
    <span class="p">}</span>
  <span class="p">);</span>

  <span class="nb">Array</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">forEach</span><span class="p">.</span><span class="nx">call</span><span class="p">(</span>
    <span class="nb">document</span><span class="p">.</span><span class="nx">getElementsByClassName</span><span class="p">(</span><span class="s1">&#39;qunit-image-img&#39;</span><span class="p">),</span>
    <span class="kd">function</span> <span class="p">(</span><span class="nx">elem</span><span class="p">,</span> <span class="nx">index</span><span class="p">)</span> <span class="p">{</span>
      <span class="nx">elem</span><span class="p">.</span><span class="nx">addEventListener</span><span class="p">(</span><span class="s1">&#39;mouseout&#39;</span><span class="p">,</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">evt</span><span class="p">)</span> <span class="p">{</span>
        <span class="kd">var</span> <span class="nx">id</span> <span class="o">=</span> <span class="nx">evt</span><span class="p">.</span><span class="nx">target</span><span class="p">.</span><span class="nx">getAttribute</span><span class="p">(</span><span class="s1">&#39;data-id&#39;</span><span class="p">),</span>
            <span class="nx">wrapper</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">getElementById</span><span class="p">(</span><span class="s1">&#39;qunit-image-pixelComparison-&#39;</span> <span class="o">+</span> <span class="nx">id</span><span class="p">);</span>

        <span class="nx">wrapper</span><span class="p">.</span><span class="nx">children</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="nx">style</span><span class="p">.</span><span class="nx">setProperty</span><span class="p">(</span><span class="s1">&#39;display&#39;</span><span class="p">,</span> <span class="s1">&#39;block&#39;</span><span class="p">);</span>
        <span class="nx">wrapper</span><span class="p">.</span><span class="nx">children</span><span class="p">[</span><span class="mi">1</span><span class="p">].</span><span class="nx">style</span><span class="p">.</span><span class="nx">setProperty</span><span class="p">(</span><span class="s1">&#39;display&#39;</span><span class="p">,</span> <span class="s1">&#39;none&#39;</span><span class="p">);</span>
      <span class="p">},</span> <span class="kc">false</span><span class="p">);</span>
    <span class="p">}</span>
  <span class="p">);</span>




  <span class="nb">Array</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">forEach</span><span class="p">.</span><span class="nx">call</span><span class="p">(</span>
    <span class="nb">document</span><span class="p">.</span><span class="nx">getElementsByClassName</span><span class="p">(</span><span class="s1">&#39;qunit-image-img&#39;</span><span class="p">),</span>
    <span class="kd">function</span> <span class="p">(</span><span class="nx">elem</span><span class="p">,</span> <span class="nx">index</span><span class="p">)</span> <span class="p">{</span>
      <span class="nx">elem</span><span class="p">.</span><span class="nx">addEventListener</span><span class="p">(</span><span class="s1">&#39;mousemove&#39;</span><span class="p">,</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">evt</span><span class="p">)</span> <span class="p">{</span>

        <span class="kd">var</span> <span class="nx">id</span> <span class="o">=</span> <span class="nx">evt</span><span class="p">.</span><span class="nx">target</span><span class="p">.</span><span class="nx">getAttribute</span><span class="p">(</span><span class="s1">&#39;data-id&#39;</span><span class="p">),</span>
            <span class="nx">wrapper</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">getElementById</span><span class="p">(</span><span class="s1">&#39;qunit-image-pixelComparison-&#39;</span> <span class="o">+</span> <span class="nx">id</span><span class="p">),</span>
            <span class="nx">test</span> <span class="o">=</span> <span class="nb">window</span><span class="p">.</span><span class="nx">qunitImage</span><span class="p">.</span><span class="nx">tests</span><span class="p">[</span><span class="nx">id</span><span class="p">],</span>
            <span class="nx">x</span> <span class="o">=</span> <span class="s1">&#39;offsetX&#39;</span> <span class="k">in</span> <span class="nx">evt</span> <span class="o">?</span> <span class="nx">evt</span><span class="p">.</span><span class="nx">offsetX</span> <span class="o">:</span> <span class="nx">evt</span><span class="p">.</span><span class="nx">layerX</span><span class="p">,</span>
            <span class="nx">y</span> <span class="o">=</span> <span class="s1">&#39;offsetY&#39;</span> <span class="k">in</span> <span class="nx">evt</span> <span class="o">?</span> <span class="nx">evt</span><span class="p">.</span><span class="nx">offsetY</span> <span class="o">:</span> <span class="nx">evt</span><span class="p">.</span><span class="nx">layerY</span><span class="p">,</span>
            <span class="nx">actData</span> <span class="o">=</span> <span class="nx">test</span><span class="p">.</span><span class="nx">actual</span><span class="p">.</span><span class="nx">ctx</span><span class="p">.</span><span class="nx">getImageData</span><span class="p">(</span><span class="nx">x</span><span class="p">,</span> <span class="nx">y</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">).</span><span class="nx">data</span><span class="p">,</span>
            <span class="nx">expData</span> <span class="o">=</span> <span class="nx">test</span><span class="p">.</span><span class="nx">expected</span><span class="p">.</span><span class="nx">ctx</span><span class="p">.</span><span class="nx">getImageData</span><span class="p">(</span><span class="nx">x</span><span class="p">,</span> <span class="nx">y</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">).</span><span class="nx">data</span><span class="p">;</span>

        <span class="nx">wrapper</span><span class="p">.</span><span class="nx">getElementsByClassName</span><span class="p">(</span><span class="s1">&#39;qunit-image-xCoordinate&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">].</span><span class="nx">innerHTML</span> <span class="o">=</span> <span class="nx">x</span><span class="p">;</span>
        <span class="nx">wrapper</span><span class="p">.</span><span class="nx">getElementsByClassName</span><span class="p">(</span><span class="s1">&#39;qunit-image-yCoordinate&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">].</span><span class="nx">innerHTML</span> <span class="o">=</span> <span class="nx">y</span><span class="p">;</span>


        <span class="nx">wrapper</span><span class="p">.</span><span class="nx">getElementsByClassName</span><span class="p">(</span><span class="s1">&#39;qunit-image-table-rAct&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">].</span><span class="nx">innerHTML</span> <span class="o">=</span> <span class="nx">actData</span><span class="p">[</span><span class="mi">0</span><span class="p">];</span>
        <span class="nx">wrapper</span><span class="p">.</span><span class="nx">getElementsByClassName</span><span class="p">(</span><span class="s1">&#39;qunit-image-table-gAct&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">].</span><span class="nx">innerHTML</span> <span class="o">=</span> <span class="nx">actData</span><span class="p">[</span><span class="mi">1</span><span class="p">];</span>
        <span class="nx">wrapper</span><span class="p">.</span><span class="nx">getElementsByClassName</span><span class="p">(</span><span class="s1">&#39;qunit-image-table-bAct&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">].</span><span class="nx">innerHTML</span> <span class="o">=</span> <span class="nx">actData</span><span class="p">[</span><span class="mi">2</span><span class="p">];</span>
        <span class="nx">wrapper</span><span class="p">.</span><span class="nx">getElementsByClassName</span><span class="p">(</span><span class="s1">&#39;qunit-image-table-aAct&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">].</span><span class="nx">innerHTML</span> <span class="o">=</span> <span class="nx">actData</span><span class="p">[</span><span class="mi">3</span><span class="p">];</span>

        <span class="nx">wrapper</span><span class="p">.</span><span class="nx">getElementsByClassName</span><span class="p">(</span><span class="s1">&#39;qunit-image-table-rExp&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">].</span><span class="nx">innerHTML</span> <span class="o">=</span> <span class="nx">expData</span><span class="p">[</span><span class="mi">0</span><span class="p">];</span>
        <span class="nx">wrapper</span><span class="p">.</span><span class="nx">getElementsByClassName</span><span class="p">(</span><span class="s1">&#39;qunit-image-table-gExp&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">].</span><span class="nx">innerHTML</span> <span class="o">=</span> <span class="nx">expData</span><span class="p">[</span><span class="mi">1</span><span class="p">];</span>
        <span class="nx">wrapper</span><span class="p">.</span><span class="nx">getElementsByClassName</span><span class="p">(</span><span class="s1">&#39;qunit-image-table-bExp&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">].</span><span class="nx">innerHTML</span> <span class="o">=</span> <span class="nx">expData</span><span class="p">[</span><span class="mi">2</span><span class="p">];</span>
        <span class="nx">wrapper</span><span class="p">.</span><span class="nx">getElementsByClassName</span><span class="p">(</span><span class="s1">&#39;qunit-image-table-aExp&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">].</span><span class="nx">innerHTML</span> <span class="o">=</span> <span class="nx">expData</span><span class="p">[</span><span class="mi">3</span><span class="p">];</span>


        <span class="nx">wrapper</span><span class="p">.</span><span class="nx">getElementsByClassName</span><span class="p">(</span><span class="s1">&#39;qunit-image-table-act&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
          <span class="p">.</span><span class="nx">style</span><span class="p">.</span><span class="nx">setProperty</span><span class="p">(</span><span class="s1">&#39;background&#39;</span><span class="p">,</span> <span class="s1">&#39;rgba(&#39;</span> <span class="o">+</span> <span class="nx">actData</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="s1">&#39;,&#39;</span> <span class="o">+</span> <span class="nx">actData</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="s1">&#39;,&#39;</span> <span class="o">+</span>
            <span class="nx">actData</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">+</span> <span class="s1">&#39;,&#39;</span> <span class="o">+</span> <span class="nx">actData</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="o">+</span> <span class="s1">&#39;)&#39;</span><span class="p">);</span>
        <span class="nx">wrapper</span><span class="p">.</span><span class="nx">getElementsByClassName</span><span class="p">(</span><span class="s1">&#39;qunit-image-table-exp&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
          <span class="p">.</span><span class="nx">style</span><span class="p">.</span><span class="nx">setProperty</span><span class="p">(</span><span class="s1">&#39;background&#39;</span><span class="p">,</span> <span class="s1">&#39;rgba(&#39;</span> <span class="o">+</span> <span class="nx">expData</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="s1">&#39;,&#39;</span> <span class="o">+</span> <span class="nx">expData</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="s1">&#39;,&#39;</span> <span class="o">+</span>
            <span class="nx">expData</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">+</span> <span class="s1">&#39;,&#39;</span> <span class="o">+</span> <span class="nx">expData</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="o">+</span> <span class="s1">&#39;)&#39;</span><span class="p">);</span>
      <span class="p">},</span> <span class="kc">false</span><span class="p">);</span>
    <span class="p">}</span>
  <span class="p">);</span>


<span class="p">});</span>
<span class="k">this</span><span class="p">[</span><span class="s2">&quot;JST&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="k">this</span><span class="p">[</span><span class="s2">&quot;JST&quot;</span><span class="p">]</span> <span class="o">||</span> <span class="p">{};</span>

<span class="k">this</span><span class="p">[</span><span class="s2">&quot;JST&quot;</span><span class="p">][</span><span class="s2">&quot;src/qunit-image.hbs&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">obj</span><span class="p">)</span> <span class="p">{</span>
<span class="nx">obj</span> <span class="o">||</span> <span class="p">(</span><span class="nx">obj</span> <span class="o">=</span> <span class="p">{});</span>
<span class="kd">var</span> <span class="nx">__t</span><span class="p">,</span> <span class="nx">__p</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="nx">__e</span> <span class="o">=</span> <span class="nx">_</span><span class="p">.</span><span class="nx">escape</span><span class="p">;</span>
<span class="kd">with</span> <span class="p">(</span><span class="nx">obj</span><span class="p">)</span> <span class="p">{</span>
<span class="nx">__p</span> <span class="o">+=</span> <span class="s1">&#39;&lt;div class=&quot;qunit-image-wrapper&quot;&gt;\n\t&lt;div&gt;\n\t\tTesting a &#39;</span> <span class="o">+</span>
<span class="p">((</span><span class="nx">__t</span> <span class="o">=</span> <span class="p">(</span><span class="nx">width</span><span class="p">))</span> <span class="o">==</span> <span class="kc">null</span> <span class="o">?</span> <span class="s1">&#39;&#39;</span> <span class="o">:</span> <span class="nx">__t</span><span class="p">)</span> <span class="o">+</span>
<span class="s1">&#39;px by &#39;</span> <span class="o">+</span>
<span class="p">((</span><span class="nx">__t</span> <span class="o">=</span> <span class="p">(</span><span class="nx">height</span><span class="p">))</span> <span class="o">==</span> <span class="kc">null</span> <span class="o">?</span> <span class="s1">&#39;&#39;</span> <span class="o">:</span> <span class="nx">__t</span><span class="p">)</span> <span class="o">+</span>
<span class="s1">&#39;px image (&#39;</span> <span class="o">+</span>
<span class="p">((</span><span class="nx">__t</span> <span class="o">=</span> <span class="p">(</span><span class="nx">height</span> <span class="o">*</span> <span class="nx">width</span><span class="p">))</span> <span class="o">==</span> <span class="kc">null</span> <span class="o">?</span> <span class="s1">&#39;&#39;</span> <span class="o">:</span> <span class="nx">__t</span><span class="p">)</span> <span class="o">+</span>
<span class="s1">&#39; total pixels, &#39;</span> <span class="o">+</span>
<span class="p">((</span><span class="nx">__t</span> <span class="o">=</span> <span class="p">(</span><span class="nx">width</span> <span class="o">*</span> <span class="nx">height</span> <span class="o">*</span> <span class="mi">4</span><span class="p">))</span> <span class="o">==</span> <span class="kc">null</span> <span class="o">?</span> <span class="s1">&#39;&#39;</span> <span class="o">:</span> <span class="nx">__t</span><span class="p">)</span> <span class="o">+</span>
<span class="s1">&#39; channels).\n\t&lt;/div&gt;\n\t&lt;div&gt;\n\t\tThere were errors on &#39;</span> <span class="o">+</span>
<span class="p">((</span><span class="nx">__t</span> <span class="o">=</span> <span class="p">(</span><span class="nx">channelErrors</span><span class="p">))</span> <span class="o">==</span> <span class="kc">null</span> <span class="o">?</span> <span class="s1">&#39;&#39;</span> <span class="o">:</span> <span class="nx">__t</span><span class="p">)</span> <span class="o">+</span>
<span class="s1">&#39; channels (&#39;</span> <span class="o">+</span>
<span class="p">((</span><span class="nx">__t</span> <span class="o">=</span> <span class="p">((</span><span class="mi">25</span> <span class="o">*</span> <span class="nx">channelErrors</span> <span class="o">/</span> <span class="p">(</span><span class="nx">width</span> <span class="o">*</span> <span class="nx">height</span><span class="p">)).</span><span class="nx">toFixed</span><span class="p">(</span><span class="mi">3</span><span class="p">)))</span> <span class="o">==</span> <span class="kc">null</span> <span class="o">?</span> <span class="s1">&#39;&#39;</span> <span class="o">:</span> <span class="nx">__t</span><span class="p">)</span> <span class="o">+</span>
<span class="s1">&#39;%).\n\t&lt;/div&gt;\n\t&lt;div&gt;\n\t\tThe very primitive accumulated rgba-distance of the images is &#39;</span> <span class="o">+</span>
<span class="p">((</span><span class="nx">__t</span> <span class="o">=</span> <span class="p">(</span><span class="nx">imageDistance</span><span class="p">))</span> <span class="o">==</span> <span class="kc">null</span> <span class="o">?</span> <span class="s1">&#39;&#39;</span> <span class="o">:</span> <span class="nx">__t</span><span class="p">)</span> <span class="o">+</span>
<span class="s1">&#39;.\n\t&lt;/div&gt;\n\t&lt;div class=&quot;qunit-image-clearfix&quot;&gt;\n\t\t&lt;div style=&quot;width:&#39;</span> <span class="o">+</span>
<span class="p">((</span><span class="nx">__t</span> <span class="o">=</span> <span class="p">(</span><span class="nx">width</span><span class="p">))</span> <span class="o">==</span> <span class="kc">null</span> <span class="o">?</span> <span class="s1">&#39;&#39;</span> <span class="o">:</span> <span class="nx">__t</span><span class="p">)</span> <span class="o">+</span>
<span class="s1">&#39;px; height:&#39;</span> <span class="o">+</span>
<span class="p">((</span><span class="nx">__t</span> <span class="o">=</span> <span class="p">(</span><span class="nx">height</span><span class="p">))</span> <span class="o">==</span> <span class="kc">null</span> <span class="o">?</span> <span class="s1">&#39;&#39;</span> <span class="o">:</span> <span class="nx">__t</span><span class="p">)</span> <span class="o">+</span>
<span class="s1">&#39;px;&quot; class=&quot;qunit-image-figure&quot;&gt;\n\t\t\t&lt;div class=&quot;qunit-image-figcaption&quot;&gt;The actual image&lt;/div&gt;\n\t\t\t&lt;img class=&quot;qunit-image-img&quot; src=&quot;&#39;</span> <span class="o">+</span>
<span class="p">((</span><span class="nx">__t</span> <span class="o">=</span> <span class="p">(</span><span class="nx">actCanvas</span><span class="p">))</span> <span class="o">==</span> <span class="kc">null</span> <span class="o">?</span> <span class="s1">&#39;&#39;</span> <span class="o">:</span> <span class="nx">__t</span><span class="p">)</span> <span class="o">+</span>
<span class="s1">&#39;&quot; width=&quot;&#39;</span> <span class="o">+</span>
<span class="p">((</span><span class="nx">__t</span> <span class="o">=</span> <span class="p">(</span><span class="nx">width</span><span class="p">))</span> <span class="o">==</span> <span class="kc">null</span> <span class="o">?</span> <span class="s1">&#39;&#39;</span> <span class="o">:</span> <span class="nx">__t</span><span class="p">)</span> <span class="o">+</span>
<span class="s1">&#39;px&quot; height=&quot;&#39;</span> <span class="o">+</span>
<span class="p">((</span><span class="nx">__t</span> <span class="o">=</span> <span class="p">(</span><span class="nx">height</span><span class="p">))</span> <span class="o">==</span> <span class="kc">null</span> <span class="o">?</span> <span class="s1">&#39;&#39;</span> <span class="o">:</span> <span class="nx">__t</span><span class="p">)</span> <span class="o">+</span>
<span class="s1">&#39;px&quot; data-id=&quot;&#39;</span> <span class="o">+</span>
<span class="p">((</span><span class="nx">__t</span> <span class="o">=</span> <span class="p">(</span><span class="nx">id</span><span class="p">))</span> <span class="o">==</span> <span class="kc">null</span> <span class="o">?</span> <span class="s1">&#39;&#39;</span> <span class="o">:</span> <span class="nx">__t</span><span class="p">)</span> <span class="o">+</span>
<span class="s1">&#39;&quot;/&gt;\n\t\t&lt;/div&gt;\n\n\t\t&lt;div style=&quot;width:&#39;</span> <span class="o">+</span>
<span class="p">((</span><span class="nx">__t</span> <span class="o">=</span> <span class="p">(</span><span class="nx">width</span><span class="p">))</span> <span class="o">==</span> <span class="kc">null</span> <span class="o">?</span> <span class="s1">&#39;&#39;</span> <span class="o">:</span> <span class="nx">__t</span><span class="p">)</span> <span class="o">+</span>
<span class="s1">&#39;px; height:&#39;</span> <span class="o">+</span>
<span class="p">((</span><span class="nx">__t</span> <span class="o">=</span> <span class="p">(</span><span class="nx">height</span><span class="p">))</span> <span class="o">==</span> <span class="kc">null</span> <span class="o">?</span> <span class="s1">&#39;&#39;</span> <span class="o">:</span> <span class="nx">__t</span><span class="p">)</span> <span class="o">+</span>
<span class="s1">&#39;px;&quot; class=&quot;qunit-image-figure&quot;&gt;\n\t\t\t&lt;div class=&quot;qunit-image-figcaption&quot;&gt;The reference image&lt;/div&gt;\n\t\t\t&lt;img class=&quot;qunit-image-img&quot; src=&quot;&#39;</span> <span class="o">+</span>
<span class="p">((</span><span class="nx">__t</span> <span class="o">=</span> <span class="p">(</span><span class="nx">expCanvas</span><span class="p">))</span> <span class="o">==</span> <span class="kc">null</span> <span class="o">?</span> <span class="s1">&#39;&#39;</span> <span class="o">:</span> <span class="nx">__t</span><span class="p">)</span> <span class="o">+</span>
<span class="s1">&#39;&quot; width=&quot;&#39;</span> <span class="o">+</span>
<span class="p">((</span><span class="nx">__t</span> <span class="o">=</span> <span class="p">(</span><span class="nx">width</span><span class="p">))</span> <span class="o">==</span> <span class="kc">null</span> <span class="o">?</span> <span class="s1">&#39;&#39;</span> <span class="o">:</span> <span class="nx">__t</span><span class="p">)</span> <span class="o">+</span>
<span class="s1">&#39;px&quot; height=&quot;&#39;</span> <span class="o">+</span>
<span class="p">((</span><span class="nx">__t</span> <span class="o">=</span> <span class="p">(</span><span class="nx">height</span><span class="p">))</span> <span class="o">==</span> <span class="kc">null</span> <span class="o">?</span> <span class="s1">&#39;&#39;</span> <span class="o">:</span> <span class="nx">__t</span><span class="p">)</span> <span class="o">+</span>
<span class="s1">&#39;px&quot; data-id=&quot;&#39;</span> <span class="o">+</span>
<span class="p">((</span><span class="nx">__t</span> <span class="o">=</span> <span class="p">(</span><span class="nx">id</span><span class="p">))</span> <span class="o">==</span> <span class="kc">null</span> <span class="o">?</span> <span class="s1">&#39;&#39;</span> <span class="o">:</span> <span class="nx">__t</span><span class="p">)</span> <span class="o">+</span>
<span class="s1">&#39;&quot;/&gt;\n\t\t&lt;/div&gt;\n\n\t\t&lt;div style=&quot;width:&#39;</span> <span class="o">+</span>
<span class="p">((</span><span class="nx">__t</span> <span class="o">=</span> <span class="p">(</span><span class="nx">width</span><span class="p">))</span> <span class="o">==</span> <span class="kc">null</span> <span class="o">?</span> <span class="s1">&#39;&#39;</span> <span class="o">:</span> <span class="nx">__t</span><span class="p">)</span> <span class="o">+</span>
<span class="s1">&#39;px; height:&#39;</span> <span class="o">+</span>
<span class="p">((</span><span class="nx">__t</span> <span class="o">=</span> <span class="p">(</span><span class="nx">height</span><span class="p">))</span> <span class="o">==</span> <span class="kc">null</span> <span class="o">?</span> <span class="s1">&#39;&#39;</span> <span class="o">:</span> <span class="nx">__t</span><span class="p">)</span> <span class="o">+</span>
<span class="s1">&#39;px;&quot; class=&quot;qunit-image-figure&quot;&gt;\n\t\t\t&lt;div class=&quot;qunit-image-figcaption&quot;&gt;\n\t\t\t\t&lt;select class=&quot;qunit-image-select&quot;&gt;\n\t\t\t\t\t&lt;option value=&quot;0&quot;&gt;difference heatmap&lt;/option&gt;\n\t\t\t\t\t&lt;option value=&quot;1&quot;&gt;clip slider&lt;/option&gt;\n\t\t\t\t\t&lt;option value=&quot;2&quot;&gt;opacity slider&lt;/option&gt;\n\t\t\t\t&lt;/select&gt;\n\t\t\t&lt;/div&gt;\n\n\t\t\t&lt;div&gt;\n\t\t\t\t&lt;img src=&quot;&#39;</span> <span class="o">+</span>
<span class="p">((</span><span class="nx">__t</span> <span class="o">=</span> <span class="p">(</span><span class="nx">diffCanvas</span><span class="p">))</span> <span class="o">==</span> <span class="kc">null</span> <span class="o">?</span> <span class="s1">&#39;&#39;</span> <span class="o">:</span> <span class="nx">__t</span><span class="p">)</span> <span class="o">+</span>
<span class="s1">&#39;&quot; class=&quot;qunit-image-img qunit-image-comparisonImage qunit-image-isVisible&quot; width=&quot;&#39;</span> <span class="o">+</span>
<span class="p">((</span><span class="nx">__t</span> <span class="o">=</span> <span class="p">(</span><span class="nx">width</span><span class="p">))</span> <span class="o">==</span> <span class="kc">null</span> <span class="o">?</span> <span class="s1">&#39;&#39;</span> <span class="o">:</span> <span class="nx">__t</span><span class="p">)</span> <span class="o">+</span>
<span class="s1">&#39;px&quot; height=&quot;&#39;</span> <span class="o">+</span>
<span class="p">((</span><span class="nx">__t</span> <span class="o">=</span> <span class="p">(</span><span class="nx">height</span><span class="p">))</span> <span class="o">==</span> <span class="kc">null</span> <span class="o">?</span> <span class="s1">&#39;&#39;</span> <span class="o">:</span> <span class="nx">__t</span><span class="p">)</span> <span class="o">+</span>
<span class="s1">&#39;px&quot; data-id=&quot;&#39;</span> <span class="o">+</span>
<span class="p">((</span><span class="nx">__t</span> <span class="o">=</span> <span class="p">(</span><span class="nx">id</span><span class="p">))</span> <span class="o">==</span> <span class="kc">null</span> <span class="o">?</span> <span class="s1">&#39;&#39;</span> <span class="o">:</span> <span class="nx">__t</span><span class="p">)</span> <span class="o">+</span>
<span class="s1">&#39;&quot;/&gt;\n\n\t\t\t\t&lt;div class=&quot;qunit-image-comparisonImage&quot;&gt;\n\t\t\t\t\t&lt;input type=&quot;range&quot; min=&quot;0&quot; max=&quot;&#39;</span> <span class="o">+</span>
<span class="p">((</span><span class="nx">__t</span> <span class="o">=</span> <span class="p">(</span><span class="nx">width</span><span class="p">))</span> <span class="o">==</span> <span class="kc">null</span> <span class="o">?</span> <span class="s1">&#39;&#39;</span> <span class="o">:</span> <span class="nx">__t</span><span class="p">)</span> <span class="o">+</span>
<span class="s1">&#39;&quot; class=&quot;qunit-image-range-clip&quot; style=&quot;width:&#39;</span> <span class="o">+</span>
<span class="p">((</span><span class="nx">__t</span> <span class="o">=</span> <span class="p">(</span><span class="nx">width</span><span class="p">))</span> <span class="o">==</span> <span class="kc">null</span> <span class="o">?</span> <span class="s1">&#39;&#39;</span> <span class="o">:</span> <span class="nx">__t</span><span class="p">)</span> <span class="o">+</span>
<span class="s1">&#39;px;&quot;&gt;\n\t\t\t\t\t&lt;div class=&quot;qunit-image-absoluteContainer&quot; style=&quot;width:&#39;</span> <span class="o">+</span>
<span class="p">((</span><span class="nx">__t</span> <span class="o">=</span> <span class="p">(</span><span class="nx">width</span><span class="p">))</span> <span class="o">==</span> <span class="kc">null</span> <span class="o">?</span> <span class="s1">&#39;&#39;</span> <span class="o">:</span> <span class="nx">__t</span><span class="p">)</span> <span class="o">+</span>
<span class="s1">&#39;px; height:&#39;</span> <span class="o">+</span>
<span class="p">((</span><span class="nx">__t</span> <span class="o">=</span> <span class="p">(</span><span class="nx">height</span><span class="p">))</span> <span class="o">==</span> <span class="kc">null</span> <span class="o">?</span> <span class="s1">&#39;&#39;</span> <span class="o">:</span> <span class="nx">__t</span><span class="p">)</span> <span class="o">+</span>
<span class="s1">&#39;px&quot;&gt;\n\t\t\t\t\t\t&lt;img class=&quot;qunit-image-img&quot; src=&quot;&#39;</span> <span class="o">+</span>
<span class="p">((</span><span class="nx">__t</span> <span class="o">=</span> <span class="p">(</span><span class="nx">actCanvas</span><span class="p">))</span> <span class="o">==</span> <span class="kc">null</span> <span class="o">?</span> <span class="s1">&#39;&#39;</span> <span class="o">:</span> <span class="nx">__t</span><span class="p">)</span> <span class="o">+</span>
<span class="s1">&#39;&quot; width=&quot;&#39;</span> <span class="o">+</span>
<span class="p">((</span><span class="nx">__t</span> <span class="o">=</span> <span class="p">(</span><span class="nx">width</span><span class="p">))</span> <span class="o">==</span> <span class="kc">null</span> <span class="o">?</span> <span class="s1">&#39;&#39;</span> <span class="o">:</span> <span class="nx">__t</span><span class="p">)</span> <span class="o">+</span>
<span class="s1">&#39;px&quot; height=&quot;&#39;</span> <span class="o">+</span>
<span class="p">((</span><span class="nx">__t</span> <span class="o">=</span> <span class="p">(</span><span class="nx">height</span><span class="p">))</span> <span class="o">==</span> <span class="kc">null</span> <span class="o">?</span> <span class="s1">&#39;&#39;</span> <span class="o">:</span> <span class="nx">__t</span><span class="p">)</span> <span class="o">+</span>
<span class="s1">&#39;px&quot;\n\t\t\t\t\t\t\t\t\tstyle=&quot;clip: rect(0px, &#39;</span> <span class="o">+</span>
<span class="p">((</span><span class="nx">__t</span> <span class="o">=</span> <span class="p">(</span><span class="nx">width</span><span class="p">))</span> <span class="o">==</span> <span class="kc">null</span> <span class="o">?</span> <span class="s1">&#39;&#39;</span> <span class="o">:</span> <span class="nx">__t</span><span class="p">)</span> <span class="o">+</span>
<span class="s1">&#39;px, &#39;</span> <span class="o">+</span>
<span class="p">((</span><span class="nx">__t</span> <span class="o">=</span> <span class="p">(</span><span class="nx">height</span><span class="p">))</span> <span class="o">==</span> <span class="kc">null</span> <span class="o">?</span> <span class="s1">&#39;&#39;</span> <span class="o">:</span> <span class="nx">__t</span><span class="p">)</span> <span class="o">+</span>
<span class="s1">&#39;px, &#39;</span> <span class="o">+</span>
<span class="p">((</span><span class="nx">__t</span> <span class="o">=</span> <span class="p">(</span><span class="nx">width</span> <span class="o">/</span> <span class="mi">2</span><span class="p">))</span> <span class="o">==</span> <span class="kc">null</span> <span class="o">?</span> <span class="s1">&#39;&#39;</span> <span class="o">:</span> <span class="nx">__t</span><span class="p">)</span> <span class="o">+</span>
<span class="s1">&#39;px)&quot; data-id=&quot;&#39;</span> <span class="o">+</span>
<span class="p">((</span><span class="nx">__t</span> <span class="o">=</span> <span class="p">(</span><span class="nx">id</span><span class="p">))</span> <span class="o">==</span> <span class="kc">null</span> <span class="o">?</span> <span class="s1">&#39;&#39;</span> <span class="o">:</span> <span class="nx">__t</span><span class="p">)</span> <span class="o">+</span>
<span class="s1">&#39;&quot;/&gt;\n\t\t\t\t\t\t&lt;img class=&quot;qunit-image-img&quot; src=&quot;&#39;</span> <span class="o">+</span>
<span class="p">((</span><span class="nx">__t</span> <span class="o">=</span> <span class="p">(</span><span class="nx">expCanvas</span><span class="p">))</span> <span class="o">==</span> <span class="kc">null</span> <span class="o">?</span> <span class="s1">&#39;&#39;</span> <span class="o">:</span> <span class="nx">__t</span><span class="p">)</span> <span class="o">+</span>
<span class="s1">&#39;&quot; width=&quot;&#39;</span> <span class="o">+</span>
<span class="p">((</span><span class="nx">__t</span> <span class="o">=</span> <span class="p">(</span><span class="nx">width</span><span class="p">))</span> <span class="o">==</span> <span class="kc">null</span> <span class="o">?</span> <span class="s1">&#39;&#39;</span> <span class="o">:</span> <span class="nx">__t</span><span class="p">)</span> <span class="o">+</span>
<span class="s1">&#39;px&quot; height=&quot;&#39;</span> <span class="o">+</span>
<span class="p">((</span><span class="nx">__t</span> <span class="o">=</span> <span class="p">(</span><span class="nx">height</span><span class="p">))</span> <span class="o">==</span> <span class="kc">null</span> <span class="o">?</span> <span class="s1">&#39;&#39;</span> <span class="o">:</span> <span class="nx">__t</span><span class="p">)</span> <span class="o">+</span>
<span class="s1">&#39;px&quot;\n\t\t\t\t\t\t\t\t\tstyle=&quot;clip: rect(0px, &#39;</span> <span class="o">+</span>
<span class="p">((</span><span class="nx">__t</span> <span class="o">=</span> <span class="p">(</span><span class="nx">width</span> <span class="o">/</span> <span class="mi">2</span><span class="p">))</span> <span class="o">==</span> <span class="kc">null</span> <span class="o">?</span> <span class="s1">&#39;&#39;</span> <span class="o">:</span> <span class="nx">__t</span><span class="p">)</span> <span class="o">+</span>
<span class="s1">&#39;px, &#39;</span> <span class="o">+</span>
<span class="p">((</span><span class="nx">__t</span> <span class="o">=</span> <span class="p">(</span><span class="nx">height</span><span class="p">))</span> <span class="o">==</span> <span class="kc">null</span> <span class="o">?</span> <span class="s1">&#39;&#39;</span> <span class="o">:</span> <span class="nx">__t</span><span class="p">)</span> <span class="o">+</span>
<span class="s1">&#39;px, 0px)&quot; data-id=&quot;&#39;</span> <span class="o">+</span>
<span class="p">((</span><span class="nx">__t</span> <span class="o">=</span> <span class="p">(</span><span class="nx">id</span><span class="p">))</span> <span class="o">==</span> <span class="kc">null</span> <span class="o">?</span> <span class="s1">&#39;&#39;</span> <span class="o">:</span> <span class="nx">__t</span><span class="p">)</span> <span class="o">+</span>
<span class="s1">&#39;&quot;/&gt;\n\t\t\t\t\t&lt;/div&gt;\n\t\t\t\t&lt;/div&gt;\n\n\t\t\t\t&lt;div class=&quot;qunit-image-comparisonImage&quot;&gt;\n\t\t\t\t\t&lt;input type=&quot;range&quot; min=&quot;0&quot; max=&quot;1&quot; step=&quot;0.01&quot; class=&quot;qunit-image-range-opacity&quot; style=&quot;width:&#39;</span> <span class="o">+</span>
<span class="p">((</span><span class="nx">__t</span> <span class="o">=</span> <span class="p">(</span><span class="nx">width</span><span class="p">))</span> <span class="o">==</span> <span class="kc">null</span> <span class="o">?</span> <span class="s1">&#39;&#39;</span> <span class="o">:</span> <span class="nx">__t</span><span class="p">)</span> <span class="o">+</span>
<span class="s1">&#39;px;&quot;&gt;\n\t\t\t\t\t&lt;div class=&quot;qunit-image-absoluteContainer&quot; style=&quot;width:&#39;</span> <span class="o">+</span>
<span class="p">((</span><span class="nx">__t</span> <span class="o">=</span> <span class="p">(</span><span class="nx">width</span><span class="p">))</span> <span class="o">==</span> <span class="kc">null</span> <span class="o">?</span> <span class="s1">&#39;&#39;</span> <span class="o">:</span> <span class="nx">__t</span><span class="p">)</span> <span class="o">+</span>
<span class="s1">&#39;px; height:&#39;</span> <span class="o">+</span>
<span class="p">((</span><span class="nx">__t</span> <span class="o">=</span> <span class="p">(</span><span class="nx">height</span><span class="p">))</span> <span class="o">==</span> <span class="kc">null</span> <span class="o">?</span> <span class="s1">&#39;&#39;</span> <span class="o">:</span> <span class="nx">__t</span><span class="p">)</span> <span class="o">+</span>
<span class="s1">&#39;px&quot;&gt;\n\t\t\t\t\t\t&lt;img class=&quot;qunit-image-img&quot; src=&quot;&#39;</span> <span class="o">+</span>
<span class="p">((</span><span class="nx">__t</span> <span class="o">=</span> <span class="p">(</span><span class="nx">actCanvas</span><span class="p">))</span> <span class="o">==</span> <span class="kc">null</span> <span class="o">?</span> <span class="s1">&#39;&#39;</span> <span class="o">:</span> <span class="nx">__t</span><span class="p">)</span> <span class="o">+</span>
<span class="s1">&#39;&quot; width=&quot;&#39;</span> <span class="o">+</span>
<span class="p">((</span><span class="nx">__t</span> <span class="o">=</span> <span class="p">(</span><span class="nx">width</span><span class="p">))</span> <span class="o">==</span> <span class="kc">null</span> <span class="o">?</span> <span class="s1">&#39;&#39;</span> <span class="o">:</span> <span class="nx">__t</span><span class="p">)</span> <span class="o">+</span>
<span class="s1">&#39;px&quot; height=&quot;&#39;</span> <span class="o">+</span>
<span class="p">((</span><span class="nx">__t</span> <span class="o">=</span> <span class="p">(</span><span class="nx">height</span><span class="p">))</span> <span class="o">==</span> <span class="kc">null</span> <span class="o">?</span> <span class="s1">&#39;&#39;</span> <span class="o">:</span> <span class="nx">__t</span><span class="p">)</span> <span class="o">+</span>
<span class="s1">&#39;px&quot; style=&quot;opacity: 0.5&quot; data-id=&quot;&#39;</span> <span class="o">+</span>
<span class="p">((</span><span class="nx">__t</span> <span class="o">=</span> <span class="p">(</span><span class="nx">id</span><span class="p">))</span> <span class="o">==</span> <span class="kc">null</span> <span class="o">?</span> <span class="s1">&#39;&#39;</span> <span class="o">:</span> <span class="nx">__t</span><span class="p">)</span> <span class="o">+</span>
<span class="s1">&#39;&quot;/&gt;\n\t\t\t\t\t\t&lt;img class=&quot;qunit-image-img&quot; src=&quot;&#39;</span> <span class="o">+</span>
<span class="p">((</span><span class="nx">__t</span> <span class="o">=</span> <span class="p">(</span><span class="nx">expCanvas</span><span class="p">))</span> <span class="o">==</span> <span class="kc">null</span> <span class="o">?</span> <span class="s1">&#39;&#39;</span> <span class="o">:</span> <span class="nx">__t</span><span class="p">)</span> <span class="o">+</span>
<span class="s1">&#39;&quot; width=&quot;&#39;</span> <span class="o">+</span>
<span class="p">((</span><span class="nx">__t</span> <span class="o">=</span> <span class="p">(</span><span class="nx">width</span><span class="p">))</span> <span class="o">==</span> <span class="kc">null</span> <span class="o">?</span> <span class="s1">&#39;&#39;</span> <span class="o">:</span> <span class="nx">__t</span><span class="p">)</span> <span class="o">+</span>
<span class="s1">&#39;px&quot; height=&quot;&#39;</span> <span class="o">+</span>
<span class="p">((</span><span class="nx">__t</span> <span class="o">=</span> <span class="p">(</span><span class="nx">height</span><span class="p">))</span> <span class="o">==</span> <span class="kc">null</span> <span class="o">?</span> <span class="s1">&#39;&#39;</span> <span class="o">:</span> <span class="nx">__t</span><span class="p">)</span> <span class="o">+</span>
<span class="s1">&#39;px&quot; style=&quot;opacity: 0.5&quot; data-id=&quot;&#39;</span> <span class="o">+</span>
<span class="p">((</span><span class="nx">__t</span> <span class="o">=</span> <span class="p">(</span><span class="nx">id</span><span class="p">))</span> <span class="o">==</span> <span class="kc">null</span> <span class="o">?</span> <span class="s1">&#39;&#39;</span> <span class="o">:</span> <span class="nx">__t</span><span class="p">)</span> <span class="o">+</span>
<span class="s1">&#39;&quot;/&gt;\n\t\t\t\t\t&lt;/div&gt;\n\t\t\t\t&lt;/div&gt;\n\t\t\t&lt;/div&gt;\n\t\t&lt;/div&gt;\n\n\n\t\t&lt;div id=&quot;qunit-image-pixelComparison-&#39;</span> <span class="o">+</span>
<span class="p">((</span><span class="nx">__t</span> <span class="o">=</span> <span class="p">(</span><span class="nx">id</span><span class="p">))</span> <span class="o">==</span> <span class="kc">null</span> <span class="o">?</span> <span class="s1">&#39;&#39;</span> <span class="o">:</span> <span class="nx">__t</span><span class="p">)</span> <span class="o">+</span>
<span class="s1">&#39;&quot; style=&quot;width:&#39;</span> <span class="o">+</span>
<span class="p">((</span><span class="nx">__t</span> <span class="o">=</span> <span class="p">(</span><span class="nx">width</span><span class="p">))</span> <span class="o">==</span> <span class="kc">null</span> <span class="o">?</span> <span class="s1">&#39;&#39;</span> <span class="o">:</span> <span class="nx">__t</span><span class="p">)</span> <span class="o">+</span>
<span class="s1">&#39;px; height:&#39;</span> <span class="o">+</span>
<span class="p">((</span><span class="nx">__t</span> <span class="o">=</span> <span class="p">(</span><span class="nx">height</span><span class="p">))</span> <span class="o">==</span> <span class="kc">null</span> <span class="o">?</span> <span class="s1">&#39;&#39;</span> <span class="o">:</span> <span class="nx">__t</span><span class="p">)</span> <span class="o">+</span>
<span class="s1">&#39;px;&quot; class=&quot;qunit-image-figure&quot;&gt;\n\t\t\t&lt;div&gt;\n\t\t\t\tHover one of the images to get a pixel comparison.\n\t\t\t&lt;/div&gt;\n\t\t\t&lt;div style=&quot;display: none&quot;&gt;\n\t\t\t\tAt the currently selected Coordinate (&lt;span class=&quot;qunit-image-xCoordinate&quot;&gt;&lt;/span&gt;,&lt;span class=&quot;qunit-image-yCoordinate&quot;&gt;&lt;/span&gt;) the following colors are found:\n\t\t\t\t&lt;table&gt;\n\t\t\t\t\t&lt;thead&gt;\n\t\t\t\t\t\t&lt;tr&gt;\n\t\t\t\t\t\t\t&lt;th&gt;&lt;/th&gt;\n\t\t\t\t\t\t\t&lt;th&gt;actual&lt;/th&gt;\n\t\t\t\t\t\t\t&lt;th&gt;expected&lt;/th&gt;\n\t\t\t\t\t\t&lt;/tr&gt;\n\t\t\t\t\t&lt;/thead&gt;\n\t\t\t\t\t&lt;tbody&gt;\n\t\t\t\t\t\t&lt;tr&gt;\n\t\t\t\t\t\t\t&lt;td&gt;R&lt;/td&gt;\n\t\t\t\t\t\t\t&lt;td class=&quot;qunit-image-table-rAct&quot;&gt;&lt;/td&gt;\n\t\t\t\t\t\t\t&lt;td class=&quot;qunit-image-table-rExp&quot;&gt;&lt;/td&gt;\n\t\t\t\t\t\t&lt;/tr&gt;\n\t\t\t\t\t\t&lt;tr&gt;\n\t\t\t\t\t\t\t&lt;td&gt;G&lt;/td&gt;\n\t\t\t\t\t\t\t&lt;td class=&quot;qunit-image-table-gAct&quot;&gt;&lt;/td&gt;\n\t\t\t\t\t\t\t&lt;td class=&quot;qunit-image-table-gExp&quot;&gt;&lt;/td&gt;\n\t\t\t\t\t\t&lt;/tr&gt;\n\t\t\t\t\t\t&lt;tr&gt;\n\t\t\t\t\t\t\t&lt;td&gt;B&lt;/td&gt;\n\t\t\t\t\t\t\t&lt;td class=&quot;qunit-image-table-bAct&quot;&gt;&lt;/td&gt;\n\t\t\t\t\t\t\t&lt;td class=&quot;qunit-image-table-bExp&quot;&gt;&lt;/td&gt;\n\t\t\t\t\t\t&lt;/tr&gt;\n\t\t\t\t\t\t&lt;tr&gt;\n\t\t\t\t\t\t\t&lt;td&gt;A&lt;/td&gt;\n\t\t\t\t\t\t\t&lt;td class=&quot;qunit-image-table-aAct&quot;&gt;&lt;/td&gt;\n\t\t\t\t\t\t\t&lt;td class=&quot;qunit-image-table-aExp&quot;&gt;&lt;/td&gt;\n\t\t\t\t\t\t&lt;/tr&gt;\n\t\t\t\t\t\t&lt;tr&gt;\n\t\t\t\t\t\t\t&lt;td&gt;=&lt;/td&gt;\n\t\t\t\t\t\t\t&lt;td class=&quot;qunit-image-table-act&quot;&gt;&lt;/td&gt;\n\t\t\t\t\t\t\t&lt;td class=&quot;qunit-image-table-exp&quot;&gt;&lt;/td&gt;\n\t\t\t\t\t\t&lt;/tr&gt;\n\t\t\t\t\t&lt;/tbody&gt;\n\t\t\t\t&lt;/table&gt;\n\t\t\t&lt;/div&gt;\n\t\t&lt;/div&gt;\n\t\t\n\t&lt;/div&gt;\n&lt;/div&gt;&#39;</span><span class="p">;</span>

<span class="p">}</span>
<span class="k">return</span> <span class="nx">__p</span>
<span class="p">};</span>
<span class="cm">/**</span>
<span class="cm"> * @license</span>
<span class="cm"> * Lo-Dash 1.2.1 (Custom Build) &lt;http://lodash.com/&gt;</span>
<span class="cm"> * Build: `lodash include=&quot;template&quot;`</span>
<span class="cm"> * Copyright 2012-2013 The Dojo Foundation &lt;http://dojofoundation.org/&gt;</span>
<span class="cm"> * Based on Underscore.js 1.4.4 &lt;http://underscorejs.org/&gt;</span>
<span class="cm"> * Copyright 2009-2013 Jeremy Ashkenas, DocumentCloud Inc.</span>
<span class="cm"> * Available under MIT license &lt;http://lodash.com/license&gt;</span>
<span class="cm"> */</span>
<span class="p">;(</span><span class="kd">function</span><span class="p">(</span><span class="nb">window</span><span class="p">)</span> <span class="p">{</span>

  <span class="cm">/** Used as a safe reference for `undefined` in pre ES5 environments */</span>
  <span class="kd">var</span> <span class="kc">undefined</span><span class="p">;</span>

  <span class="cm">/** Detect free variable `exports` */</span>
  <span class="kd">var</span> <span class="nx">freeExports</span> <span class="o">=</span> <span class="k">typeof</span> <span class="nx">exports</span> <span class="o">==</span> <span class="s1">&#39;object&#39;</span> <span class="o">&amp;&amp;</span> <span class="nx">exports</span><span class="p">;</span>

  <span class="cm">/** Detect free variable `module` */</span>
  <span class="kd">var</span> <span class="nx">freeModule</span> <span class="o">=</span> <span class="k">typeof</span> <span class="nx">module</span> <span class="o">==</span> <span class="s1">&#39;object&#39;</span> <span class="o">&amp;&amp;</span> <span class="nx">module</span> <span class="o">&amp;&amp;</span> <span class="nx">module</span><span class="p">.</span><span class="nx">exports</span> <span class="o">==</span> <span class="nx">freeExports</span> <span class="o">&amp;&amp;</span> <span class="nx">module</span><span class="p">;</span>

  <span class="cm">/** Detect free variable `global`, from Node.js or Browserified code, and use it as `window` */</span>
  <span class="kd">var</span> <span class="nx">freeGlobal</span> <span class="o">=</span> <span class="k">typeof</span> <span class="nx">global</span> <span class="o">==</span> <span class="s1">&#39;object&#39;</span> <span class="o">&amp;&amp;</span> <span class="nx">global</span><span class="p">;</span>
  <span class="k">if</span> <span class="p">(</span><span class="nx">freeGlobal</span><span class="p">.</span><span class="nx">global</span> <span class="o">===</span> <span class="nx">freeGlobal</span> <span class="o">||</span> <span class="nx">freeGlobal</span><span class="p">.</span><span class="nb">window</span> <span class="o">===</span> <span class="nx">freeGlobal</span><span class="p">)</span> <span class="p">{</span>
    <span class="nb">window</span> <span class="o">=</span> <span class="nx">freeGlobal</span><span class="p">;</span>
  <span class="p">}</span>

  <span class="cm">/** Used to generate unique IDs */</span>
  <span class="kd">var</span> <span class="nx">idCounter</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>

  <span class="cm">/** Used internally to indicate various things */</span>
  <span class="kd">var</span> <span class="nx">indicatorObject</span> <span class="o">=</span> <span class="p">{};</span>

  <span class="cm">/** Used to prefix keys to avoid issues with `__proto__` and properties on `Object.prototype` */</span>
  <span class="kd">var</span> <span class="nx">keyPrefix</span> <span class="o">=</span> <span class="o">+</span><span class="k">new</span> <span class="nb">Date</span> <span class="o">+</span> <span class="s1">&#39;&#39;</span><span class="p">;</span>

  <span class="cm">/** Used as the size when optimizations are enabled for large arrays */</span>
  <span class="kd">var</span> <span class="nx">largeArraySize</span> <span class="o">=</span> <span class="mi">200</span><span class="p">;</span>

  <span class="cm">/** Used to match empty string literals in compiled template source */</span>
  <span class="kd">var</span> <span class="nx">reEmptyStringLeading</span> <span class="o">=</span> <span class="sr">/\b__p \+= &#39;&#39;;/g</span><span class="p">,</span>
      <span class="nx">reEmptyStringMiddle</span> <span class="o">=</span> <span class="sr">/\b(__p \+=) &#39;&#39; \+/g</span><span class="p">,</span>
      <span class="nx">reEmptyStringTrailing</span> <span class="o">=</span> <span class="sr">/(__e\(.*?\)|\b__t\)) \+\n&#39;&#39;;/g</span><span class="p">;</span>

  <span class="cm">/** Used to match HTML entities */</span>
  <span class="kd">var</span> <span class="nx">reEscapedHtml</span> <span class="o">=</span> <span class="sr">/&amp;(?:amp|lt|gt|quot|#39);/g</span><span class="p">;</span>

  <span class="cm">/**</span>
<span class="cm">   * Used to match ES6 template delimiters</span>
<span class="cm">   * http://people.mozilla.org/~jorendorff/es6-draft.html#sec-7.8.6</span>
<span class="cm">   */</span>
  <span class="kd">var</span> <span class="nx">reEsTemplate</span> <span class="o">=</span> <span class="sr">/\$\{([^\\}]*(?:\\.[^\\}]*)*)\}/g</span><span class="p">;</span>

  <span class="cm">/** Used to match regexp flags from their coerced string values */</span>
  <span class="kd">var</span> <span class="nx">reFlags</span> <span class="o">=</span> <span class="sr">/\w*$/</span><span class="p">;</span>

  <span class="cm">/** Used to match &quot;interpolate&quot; template delimiters */</span>
  <span class="kd">var</span> <span class="nx">reInterpolate</span> <span class="o">=</span> <span class="sr">/&lt;%=([\s\S]+?)%&gt;/g</span><span class="p">;</span>

  <span class="cm">/** Used to ensure capturing order of template delimiters */</span>
  <span class="kd">var</span> <span class="nx">reNoMatch</span> <span class="o">=</span> <span class="sr">/($^)/</span><span class="p">;</span>

  <span class="cm">/** Used to match HTML characters */</span>
  <span class="kd">var</span> <span class="nx">reUnescapedHtml</span> <span class="o">=</span> <span class="sr">/[&amp;&lt;&gt;&quot;&#39;]/g</span><span class="p">;</span>

  <span class="cm">/** Used to match unescaped characters in compiled string literals */</span>
  <span class="kd">var</span> <span class="nx">reUnescapedString</span> <span class="o">=</span> <span class="sr">/[&#39;\n\r\t\u2028\u2029\\]/g</span><span class="p">;</span>

  <span class="cm">/** Used to fix the JScript [[DontEnum]] bug */</span>
  <span class="kd">var</span> <span class="nx">shadowedProps</span> <span class="o">=</span> <span class="p">[</span>
    <span class="s1">&#39;constructor&#39;</span><span class="p">,</span> <span class="s1">&#39;hasOwnProperty&#39;</span><span class="p">,</span> <span class="s1">&#39;isPrototypeOf&#39;</span><span class="p">,</span> <span class="s1">&#39;propertyIsEnumerable&#39;</span><span class="p">,</span>
    <span class="s1">&#39;toLocaleString&#39;</span><span class="p">,</span> <span class="s1">&#39;toString&#39;</span><span class="p">,</span> <span class="s1">&#39;valueOf&#39;</span>
  <span class="p">];</span>

  <span class="cm">/** Used to make template sourceURLs easier to identify */</span>
  <span class="kd">var</span> <span class="nx">templateCounter</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>

  <span class="cm">/** `Object#toString` result shortcuts */</span>
  <span class="kd">var</span> <span class="nx">argsClass</span> <span class="o">=</span> <span class="s1">&#39;[object Arguments]&#39;</span><span class="p">,</span>
      <span class="nx">arrayClass</span> <span class="o">=</span> <span class="s1">&#39;[object Array]&#39;</span><span class="p">,</span>
      <span class="nx">boolClass</span> <span class="o">=</span> <span class="s1">&#39;[object Boolean]&#39;</span><span class="p">,</span>
      <span class="nx">dateClass</span> <span class="o">=</span> <span class="s1">&#39;[object Date]&#39;</span><span class="p">,</span>
      <span class="nx">funcClass</span> <span class="o">=</span> <span class="s1">&#39;[object Function]&#39;</span><span class="p">,</span>
      <span class="nx">numberClass</span> <span class="o">=</span> <span class="s1">&#39;[object Number]&#39;</span><span class="p">,</span>
      <span class="nx">objectClass</span> <span class="o">=</span> <span class="s1">&#39;[object Object]&#39;</span><span class="p">,</span>
      <span class="nx">regexpClass</span> <span class="o">=</span> <span class="s1">&#39;[object RegExp]&#39;</span><span class="p">,</span>
      <span class="nx">stringClass</span> <span class="o">=</span> <span class="s1">&#39;[object String]&#39;</span><span class="p">;</span>

  <span class="cm">/** Used to determine if values are of the language type Object */</span>
  <span class="kd">var</span> <span class="nx">objectTypes</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s1">&#39;boolean&#39;</span><span class="o">:</span> <span class="kc">false</span><span class="p">,</span>
    <span class="s1">&#39;function&#39;</span><span class="o">:</span> <span class="kc">true</span><span class="p">,</span>
    <span class="s1">&#39;object&#39;</span><span class="o">:</span> <span class="kc">true</span><span class="p">,</span>
    <span class="s1">&#39;number&#39;</span><span class="o">:</span> <span class="kc">false</span><span class="p">,</span>
    <span class="s1">&#39;string&#39;</span><span class="o">:</span> <span class="kc">false</span><span class="p">,</span>
    <span class="s1">&#39;undefined&#39;</span><span class="o">:</span> <span class="kc">false</span>
  <span class="p">};</span>

  <span class="cm">/** Used to escape characters for inclusion in compiled string literals */</span>
  <span class="kd">var</span> <span class="nx">stringEscapes</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s1">&#39;\\&#39;</span><span class="o">:</span> <span class="s1">&#39;\\&#39;</span><span class="p">,</span>
    <span class="s2">&quot;&#39;&quot;</span><span class="o">:</span> <span class="s2">&quot;&#39;&quot;</span><span class="p">,</span>
    <span class="s1">&#39;\n&#39;</span><span class="o">:</span> <span class="s1">&#39;n&#39;</span><span class="p">,</span>
    <span class="s1">&#39;\r&#39;</span><span class="o">:</span> <span class="s1">&#39;r&#39;</span><span class="p">,</span>
    <span class="s1">&#39;\t&#39;</span><span class="o">:</span> <span class="s1">&#39;t&#39;</span><span class="p">,</span>
    <span class="s1">&#39;\u2028&#39;</span><span class="o">:</span> <span class="s1">&#39;u2028&#39;</span><span class="p">,</span>
    <span class="s1">&#39;\u2029&#39;</span><span class="o">:</span> <span class="s1">&#39;u2029&#39;</span>
  <span class="p">};</span>

  <span class="cm">/*--------------------------------------------------------------------------*/</span>

  <span class="cm">/** Used for `Array` and `Object` method references */</span>
  <span class="kd">var</span> <span class="nx">arrayRef</span> <span class="o">=</span> <span class="nb">Array</span><span class="p">(),</span>
      <span class="nx">objectRef</span> <span class="o">=</span> <span class="nb">Object</span><span class="p">();</span>

  <span class="cm">/** Used to restore the original `_` reference in `noConflict` */</span>
  <span class="kd">var</span> <span class="nx">oldDash</span> <span class="o">=</span> <span class="nb">window</span><span class="p">.</span><span class="nx">_</span><span class="p">;</span>

  <span class="cm">/** Used to detect if a method is native */</span>
  <span class="kd">var</span> <span class="nx">reNative</span> <span class="o">=</span> <span class="nb">RegExp</span><span class="p">(</span><span class="s1">&#39;^&#39;</span> <span class="o">+</span>
    <span class="nb">String</span><span class="p">(</span><span class="nx">objectRef</span><span class="p">.</span><span class="nx">valueOf</span><span class="p">)</span>
      <span class="p">.</span><span class="nx">replace</span><span class="p">(</span><span class="sr">/[.*+?^${}()|[\]\\]/g</span><span class="p">,</span> <span class="s1">&#39;\\$&amp;&#39;</span><span class="p">)</span>
      <span class="p">.</span><span class="nx">replace</span><span class="p">(</span><span class="sr">/valueOf|for [^\]]+/g</span><span class="p">,</span> <span class="s1">&#39;.+?&#39;</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;$&#39;</span>
  <span class="p">);</span>

  <span class="cm">/** Native method shortcuts */</span>
  <span class="kd">var</span> <span class="nx">ceil</span> <span class="o">=</span> <span class="nb">Math</span><span class="p">.</span><span class="nx">ceil</span><span class="p">,</span>
      <span class="nx">clearTimeout</span> <span class="o">=</span> <span class="nb">window</span><span class="p">.</span><span class="nx">clearTimeout</span><span class="p">,</span>
      <span class="nx">concat</span> <span class="o">=</span> <span class="nx">arrayRef</span><span class="p">.</span><span class="nx">concat</span><span class="p">,</span>
      <span class="nx">floor</span> <span class="o">=</span> <span class="nb">Math</span><span class="p">.</span><span class="nx">floor</span><span class="p">,</span>
      <span class="nx">hasOwnProperty</span> <span class="o">=</span> <span class="nx">objectRef</span><span class="p">.</span><span class="nx">hasOwnProperty</span><span class="p">,</span>
      <span class="nx">push</span> <span class="o">=</span> <span class="nx">arrayRef</span><span class="p">.</span><span class="nx">push</span><span class="p">,</span>
      <span class="nx">setTimeout</span> <span class="o">=</span> <span class="nb">window</span><span class="p">.</span><span class="nx">setTimeout</span><span class="p">,</span>
      <span class="nx">toString</span> <span class="o">=</span> <span class="nx">objectRef</span><span class="p">.</span><span class="nx">toString</span><span class="p">;</span>

  <span class="cm">/* Native method shortcuts for methods with the same name as other `lodash` methods */</span>
  <span class="kd">var</span> <span class="nx">nativeBind</span> <span class="o">=</span> <span class="nx">reNative</span><span class="p">.</span><span class="nx">test</span><span class="p">(</span><span class="nx">nativeBind</span> <span class="o">=</span> <span class="nx">toString</span><span class="p">.</span><span class="nx">bind</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="nx">nativeBind</span><span class="p">,</span>
      <span class="nx">nativeIsArray</span> <span class="o">=</span> <span class="nx">reNative</span><span class="p">.</span><span class="nx">test</span><span class="p">(</span><span class="nx">nativeIsArray</span> <span class="o">=</span> <span class="nb">Array</span><span class="p">.</span><span class="nx">isArray</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="nx">nativeIsArray</span><span class="p">,</span>
      <span class="nx">nativeIsFinite</span> <span class="o">=</span> <span class="nb">window</span><span class="p">.</span><span class="nb">isFinite</span><span class="p">,</span>
      <span class="nx">nativeIsNaN</span> <span class="o">=</span> <span class="nb">window</span><span class="p">.</span><span class="nb">isNaN</span><span class="p">,</span>
      <span class="nx">nativeKeys</span> <span class="o">=</span> <span class="nx">reNative</span><span class="p">.</span><span class="nx">test</span><span class="p">(</span><span class="nx">nativeKeys</span> <span class="o">=</span> <span class="nb">Object</span><span class="p">.</span><span class="nx">keys</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="nx">nativeKeys</span><span class="p">,</span>
      <span class="nx">nativeMax</span> <span class="o">=</span> <span class="nb">Math</span><span class="p">.</span><span class="nx">max</span><span class="p">,</span>
      <span class="nx">nativeMin</span> <span class="o">=</span> <span class="nb">Math</span><span class="p">.</span><span class="nx">min</span><span class="p">,</span>
      <span class="nx">nativeRandom</span> <span class="o">=</span> <span class="nb">Math</span><span class="p">.</span><span class="nx">random</span><span class="p">,</span>
      <span class="nx">nativeSlice</span> <span class="o">=</span> <span class="nx">arrayRef</span><span class="p">.</span><span class="nx">slice</span><span class="p">;</span>

  <span class="cm">/** Detect various environments */</span>
  <span class="kd">var</span> <span class="nx">isIeOpera</span> <span class="o">=</span> <span class="nx">reNative</span><span class="p">.</span><span class="nx">test</span><span class="p">(</span><span class="nb">window</span><span class="p">.</span><span class="nx">attachEvent</span><span class="p">),</span>
      <span class="nx">isV8</span> <span class="o">=</span> <span class="nx">nativeBind</span> <span class="o">&amp;&amp;</span> <span class="o">!</span><span class="sr">/\n|true/</span><span class="p">.</span><span class="nx">test</span><span class="p">(</span><span class="nx">nativeBind</span> <span class="o">+</span> <span class="nx">isIeOpera</span><span class="p">);</span>

  <span class="cm">/*--------------------------------------------------------------------------*/</span>

  <span class="cm">/**</span>
<span class="cm">   * Creates a `lodash` object, which wraps the given `value`, to enable method</span>
<span class="cm">   * chaining.</span>
<span class="cm">   *</span>
<span class="cm">   * In addition to Lo-Dash methods, wrappers also have the following `Array` methods:</span>
<span class="cm">   * `concat`, `join`, `pop`, `push`, `reverse`, `shift`, `slice`, `sort`, `splice`,</span>
<span class="cm">   * and `unshift`</span>
<span class="cm">   *</span>
<span class="cm">   * Chaining is supported in custom builds as long as the `value` method is</span>
<span class="cm">   * implicitly or explicitly included in the build.</span>
<span class="cm">   *</span>
<span class="cm">   * The chainable wrapper functions are:</span>
<span class="cm">   * `after`, `assign`, `bind`, `bindAll`, `bindKey`, `chain`, `compact`,</span>
<span class="cm">   * `compose`, `concat`, `countBy`, `createCallback`, `debounce`, `defaults`,</span>
<span class="cm">   * `defer`, `delay`, `difference`, `filter`, `flatten`, `forEach`, `forIn`,</span>
<span class="cm">   * `forOwn`, `functions`, `groupBy`, `initial`, `intersection`, `invert`,</span>
<span class="cm">   * `invoke`, `keys`, `map`, `max`, `memoize`, `merge`, `min`, `object`, `omit`,</span>
<span class="cm">   * `once`, `pairs`, `partial`, `partialRight`, `pick`, `pluck`, `push`, `range`,</span>
<span class="cm">   * `reject`, `rest`, `reverse`, `shuffle`, `slice`, `sort`, `sortBy`, `splice`,</span>
<span class="cm">   * `tap`, `throttle`, `times`, `toArray`, `union`, `uniq`, `unshift`, `unzip`,</span>
<span class="cm">   * `values`, `where`, `without`, `wrap`, and `zip`</span>
<span class="cm">   *</span>
<span class="cm">   * The non-chainable wrapper functions are:</span>
<span class="cm">   * `clone`, `cloneDeep`, `contains`, `escape`, `every`, `find`, `has`,</span>
<span class="cm">   * `identity`, `indexOf`, `isArguments`, `isArray`, `isBoolean`, `isDate`,</span>
<span class="cm">   * `isElement`, `isEmpty`, `isEqual`, `isFinite`, `isFunction`, `isNaN`,</span>
<span class="cm">   * `isNull`, `isNumber`, `isObject`, `isPlainObject`, `isRegExp`, `isString`,</span>
<span class="cm">   * `isUndefined`, `join`, `lastIndexOf`, `mixin`, `noConflict`, `parseInt`,</span>
<span class="cm">   * `pop`, `random`, `reduce`, `reduceRight`, `result`, `shift`, `size`, `some`,</span>
<span class="cm">   * `sortedIndex`, `runInContext`, `template`, `unescape`, `uniqueId`, and `value`</span>
<span class="cm">   *</span>
<span class="cm">   * The wrapper functions `first` and `last` return wrapped values when `n` is</span>
<span class="cm">   * passed, otherwise they return unwrapped values.</span>
<span class="cm">   *</span>
<span class="cm">   * @name _</span>
<span class="cm">   * @constructor</span>
<span class="cm">   * @category Chaining</span>
<span class="cm">   * @param {Mixed} value The value to wrap in a `lodash` instance.</span>
<span class="cm">   * @returns {Object} Returns a `lodash` instance.</span>
<span class="cm">   * @example</span>
<span class="cm">   *</span>
<span class="cm">   * var wrapped = _([1, 2, 3]);</span>
<span class="cm">   *</span>
<span class="cm">   * // returns an unwrapped value</span>
<span class="cm">   * wrapped.reduce(function(sum, num) {</span>
<span class="cm">   *   return sum + num;</span>
<span class="cm">   * });</span>
<span class="cm">   * // =&gt; 6</span>
<span class="cm">   *</span>
<span class="cm">   * // returns a wrapped value</span>
<span class="cm">   * var squares = wrapped.map(function(num) {</span>
<span class="cm">   *   return num * num;</span>
<span class="cm">   * });</span>
<span class="cm">   *</span>
<span class="cm">   * _.isArray(squares);</span>
<span class="cm">   * // =&gt; false</span>
<span class="cm">   *</span>
<span class="cm">   * _.isArray(squares.value());</span>
<span class="cm">   * // =&gt; true</span>
<span class="cm">   */</span>
  <span class="kd">function</span> <span class="nx">lodash</span><span class="p">()</span> <span class="p">{</span></pre></div></div>
            
        </li>
        
           
        <li id="section-15">
            <div class="annotation">
              <div class="pilwrap">
                <a class="pilcrow" href="#section-15">&#182;</a>
              </div>            
              
<p>no operation performed</p>

            </div>
            
            <div class="content"><div class="highlight"><pre>  <span class="p">}</span>

  <span class="cm">/**</span>
<span class="cm">   * An object used to flag environments features.</span>
<span class="cm">   *</span>
<span class="cm">   * @static</span>
<span class="cm">   * @memberOf _</span>
<span class="cm">   * @type Object</span>
<span class="cm">   */</span>
  <span class="kd">var</span> <span class="nx">support</span> <span class="o">=</span> <span class="nx">lodash</span><span class="p">.</span><span class="nx">support</span> <span class="o">=</span> <span class="p">{};</span>

  <span class="p">(</span><span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">ctor</span> <span class="o">=</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span> <span class="k">this</span><span class="p">.</span><span class="nx">x</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span> <span class="p">},</span>
        <span class="nx">props</span> <span class="o">=</span> <span class="p">[];</span>

    <span class="nx">ctor</span><span class="p">.</span><span class="nx">prototype</span> <span class="o">=</span> <span class="p">{</span> <span class="s1">&#39;valueOf&#39;</span><span class="o">:</span> <span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;y&#39;</span><span class="o">:</span> <span class="mi">1</span> <span class="p">};</span>
    <span class="k">for</span> <span class="p">(</span><span class="kd">var</span> <span class="nx">prop</span> <span class="k">in</span> <span class="k">new</span> <span class="nx">ctor</span><span class="p">)</span> <span class="p">{</span> <span class="nx">props</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nx">prop</span><span class="p">);</span> <span class="p">}</span>
    <span class="k">for</span> <span class="p">(</span><span class="nx">prop</span> <span class="k">in</span> <span class="nx">arguments</span><span class="p">)</span> <span class="p">{</span> <span class="p">}</span>

    <span class="cm">/**</span>
<span class="cm">     * Detect if `arguments` objects are `Object` objects (all but Narwhal and Opera &lt; 10.5).</span>
<span class="cm">     *</span>
<span class="cm">     * @memberOf _.support</span>
<span class="cm">     * @type Boolean</span>
<span class="cm">     */</span>
    <span class="nx">support</span><span class="p">.</span><span class="nx">argsObject</span> <span class="o">=</span> <span class="nx">arguments</span><span class="p">.</span><span class="nx">constructor</span> <span class="o">==</span> <span class="nb">Object</span> <span class="o">&amp;&amp;</span> <span class="o">!</span><span class="p">(</span><span class="nx">arguments</span> <span class="k">instanceof</span> <span class="nb">Array</span><span class="p">);</span>

    <span class="cm">/**</span>
<span class="cm">     * Detect if an `arguments` object&#39;s [[Class]] is resolvable (all but Firefox &lt; 4, IE &lt; 9).</span>
<span class="cm">     *</span>
<span class="cm">     * @memberOf _.support</span>
<span class="cm">     * @type Boolean</span>
<span class="cm">     */</span>
    <span class="nx">support</span><span class="p">.</span><span class="nx">argsClass</span> <span class="o">=</span> <span class="nx">isArguments</span><span class="p">(</span><span class="nx">arguments</span><span class="p">);</span>

    <span class="cm">/**</span>
<span class="cm">     * Detect if `prototype` properties are enumerable by default.</span>
<span class="cm">     *</span>
<span class="cm">     * Firefox &lt; 3.6, Opera &gt; 9.50 - Opera &lt; 11.60, and Safari &lt; 5.1</span>
<span class="cm">     * (if the prototype or a property on the prototype has been set)</span>
<span class="cm">     * incorrectly sets a function&#39;s `prototype` property [[Enumerable]]</span>
<span class="cm">     * value to `true`.</span>
<span class="cm">     *</span>
<span class="cm">     * @memberOf _.support</span>
<span class="cm">     * @type Boolean</span>
<span class="cm">     */</span>
    <span class="nx">support</span><span class="p">.</span><span class="nx">enumPrototypes</span> <span class="o">=</span> <span class="nx">ctor</span><span class="p">.</span><span class="nx">propertyIsEnumerable</span><span class="p">(</span><span class="s1">&#39;prototype&#39;</span><span class="p">);</span>

    <span class="cm">/**</span>
<span class="cm">     * Detect if `Function#bind` exists and is inferred to be fast (all but V8).</span>
<span class="cm">     *</span>
<span class="cm">     * @memberOf _.support</span>
<span class="cm">     * @type Boolean</span>
<span class="cm">     */</span>
    <span class="nx">support</span><span class="p">.</span><span class="nx">fastBind</span> <span class="o">=</span> <span class="nx">nativeBind</span> <span class="o">&amp;&amp;</span> <span class="o">!</span><span class="nx">isV8</span><span class="p">;</span>

    <span class="cm">/**</span>
<span class="cm">     * Detect if `arguments` object indexes are non-enumerable</span>
<span class="cm">     * (Firefox &lt; 4, IE &lt; 9, PhantomJS, Safari &lt; 5.1).</span>
<span class="cm">     *</span>
<span class="cm">     * @memberOf _.support</span>
<span class="cm">     * @type Boolean</span>
<span class="cm">     */</span>
    <span class="nx">support</span><span class="p">.</span><span class="nx">nonEnumArgs</span> <span class="o">=</span> <span class="nx">prop</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">;</span>

    <span class="cm">/**</span>
<span class="cm">     * Detect if properties shadowing those on `Object.prototype` are non-enumerable.</span>
<span class="cm">     *</span>
<span class="cm">     * In IE &lt; 9 an objects own properties, shadowing non-enumerable ones, are</span>
<span class="cm">     * made non-enumerable as well (a.k.a the JScript [[DontEnum]] bug).</span>
<span class="cm">     *</span>
<span class="cm">     * @memberOf _.support</span>
<span class="cm">     * @type Boolean</span>
<span class="cm">     */</span>
    <span class="nx">support</span><span class="p">.</span><span class="nx">nonEnumShadows</span> <span class="o">=</span> <span class="o">!</span><span class="sr">/valueOf/</span><span class="p">.</span><span class="nx">test</span><span class="p">(</span><span class="nx">props</span><span class="p">);</span>

    <span class="cm">/**</span>
<span class="cm">     * Detect lack of support for accessing string characters by index.</span>
<span class="cm">     *</span>
<span class="cm">     * IE &lt; 8 can&#39;t access characters by index and IE 8 can only access</span>
<span class="cm">     * characters by index on string literals.</span>
<span class="cm">     *</span>
<span class="cm">     * @memberOf _.support</span>
<span class="cm">     * @type Boolean</span>
<span class="cm">     */</span>
    <span class="nx">support</span><span class="p">.</span><span class="nx">unindexedChars</span> <span class="o">=</span> <span class="p">(</span><span class="s1">&#39;x&#39;</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="nb">Object</span><span class="p">(</span><span class="s1">&#39;x&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">])</span> <span class="o">!=</span> <span class="s1">&#39;xx&#39;</span><span class="p">;</span>

    <span class="cm">/**</span>
<span class="cm">     * Detect if a DOM node&#39;s [[Class]] is resolvable (all but IE &lt; 9)</span>
<span class="cm">     * and that the JS engine errors when attempting to coerce an object to</span>
<span class="cm">     * a string without a `toString` function.</span>
<span class="cm">     *</span>
<span class="cm">     * @memberOf _.support</span>
<span class="cm">     * @type Boolean</span>
<span class="cm">     */</span>
    <span class="k">try</span> <span class="p">{</span>
      <span class="nx">support</span><span class="p">.</span><span class="nx">nodeClass</span> <span class="o">=</span> <span class="o">!</span><span class="p">(</span><span class="nx">toString</span><span class="p">.</span><span class="nx">call</span><span class="p">(</span><span class="nb">document</span><span class="p">)</span> <span class="o">==</span> <span class="nx">objectClass</span> <span class="o">&amp;&amp;</span> <span class="o">!</span><span class="p">({</span> <span class="s1">&#39;toString&#39;</span><span class="o">:</span> <span class="mi">0</span> <span class="p">}</span> <span class="o">+</span> <span class="s1">&#39;&#39;</span><span class="p">));</span>
    <span class="p">}</span> <span class="k">catch</span><span class="p">(</span><span class="nx">e</span><span class="p">)</span> <span class="p">{</span>
      <span class="nx">support</span><span class="p">.</span><span class="nx">nodeClass</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span>
    <span class="p">}</span>
  <span class="p">}(</span><span class="mi">1</span><span class="p">));</span>

  <span class="cm">/**</span>
<span class="cm">   * By default, the template delimiters used by Lo-Dash are similar to those in</span>
<span class="cm">   * embedded Ruby (ERB). Change the following template settings to use alternative</span>
<span class="cm">   * delimiters.</span>
<span class="cm">   *</span>
<span class="cm">   * @static</span>
<span class="cm">   * @memberOf _</span>
<span class="cm">   * @type Object</span>
<span class="cm">   */</span>
  <span class="nx">lodash</span><span class="p">.</span><span class="nx">templateSettings</span> <span class="o">=</span> <span class="p">{</span>

    <span class="cm">/**</span>
<span class="cm">     * Used to detect `data` property values to be HTML-escaped.</span>
<span class="cm">     *</span>
<span class="cm">     * @memberOf _.templateSettings</span>
<span class="cm">     * @type RegExp</span>
<span class="cm">     */</span>
    <span class="s1">&#39;escape&#39;</span><span class="o">:</span> <span class="sr">/&lt;%-([\s\S]+?)%&gt;/g</span><span class="p">,</span>

    <span class="cm">/**</span>
<span class="cm">     * Used to detect code to be evaluated.</span>
<span class="cm">     *</span>
<span class="cm">     * @memberOf _.templateSettings</span>
<span class="cm">     * @type RegExp</span>
<span class="cm">     */</span>
    <span class="s1">&#39;evaluate&#39;</span><span class="o">:</span> <span class="sr">/&lt;%([\s\S]+?)%&gt;/g</span><span class="p">,</span>

    <span class="cm">/**</span>
<span class="cm">     * Used to detect `data` property values to inject.</span>
<span class="cm">     *</span>
<span class="cm">     * @memberOf _.templateSettings</span>
<span class="cm">     * @type RegExp</span>
<span class="cm">     */</span>
    <span class="s1">&#39;interpolate&#39;</span><span class="o">:</span> <span class="nx">reInterpolate</span><span class="p">,</span>

    <span class="cm">/**</span>
<span class="cm">     * Used to reference the data object in the template text.</span>
<span class="cm">     *</span>
<span class="cm">     * @memberOf _.templateSettings</span>
<span class="cm">     * @type String</span>
<span class="cm">     */</span>
    <span class="s1">&#39;variable&#39;</span><span class="o">:</span> <span class="s1">&#39;&#39;</span><span class="p">,</span>

    <span class="cm">/**</span>
<span class="cm">     * Used to import variables into the compiled template.</span>
<span class="cm">     *</span>
<span class="cm">     * @memberOf _.templateSettings</span>
<span class="cm">     * @type Object</span>
<span class="cm">     */</span>
    <span class="s1">&#39;imports&#39;</span><span class="o">:</span> <span class="p">{</span>

      <span class="cm">/**</span>
<span class="cm">       * A reference to the `lodash` function.</span>
<span class="cm">       *</span>
<span class="cm">       * @memberOf _.templateSettings.imports</span>
<span class="cm">       * @type Function</span>
<span class="cm">       */</span>
      <span class="s1">&#39;_&#39;</span><span class="o">:</span> <span class="nx">lodash</span>
    <span class="p">}</span>
  <span class="p">};</span>

  <span class="cm">/*--------------------------------------------------------------------------*/</span>

  <span class="cm">/**</span>
<span class="cm">   * The template used to create iterator functions.</span>
<span class="cm">   *</span>
<span class="cm">   * @private</span>
<span class="cm">   * @param {Object} data The data object used to populate the text.</span>
<span class="cm">   * @returns {String} Returns the interpolated text.</span>
<span class="cm">   */</span>
  <span class="kd">var</span> <span class="nx">iteratorTemplate</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">obj</span><span class="p">)</span> <span class="p">{</span>

    <span class="kd">var</span> <span class="nx">__p</span> <span class="o">=</span> <span class="s1">&#39;var index, iterable = &#39;</span> <span class="o">+</span>
    <span class="p">(</span><span class="nx">obj</span><span class="p">.</span><span class="nx">firstArg</span><span class="p">)</span> <span class="o">+</span>
    <span class="s1">&#39;, result = &#39;</span> <span class="o">+</span>
    <span class="p">(</span><span class="nx">obj</span><span class="p">.</span><span class="nx">init</span><span class="p">)</span> <span class="o">+</span>
    <span class="s1">&#39;;\nif (!iterable) return result;\n&#39;</span> <span class="o">+</span>
    <span class="p">(</span><span class="nx">obj</span><span class="p">.</span><span class="nx">top</span><span class="p">)</span> <span class="o">+</span>
    <span class="s1">&#39;;\n&#39;</span><span class="p">;</span>
     <span class="k">if</span> <span class="p">(</span><span class="nx">obj</span><span class="p">.</span><span class="nx">arrays</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">__p</span> <span class="o">+=</span> <span class="s1">&#39;var length = iterable.length; index = -1;\nif (&#39;</span> <span class="o">+</span>
    <span class="p">(</span><span class="nx">obj</span><span class="p">.</span><span class="nx">arrays</span><span class="p">)</span> <span class="o">+</span>
    <span class="s1">&#39;) {  &#39;</span><span class="p">;</span>
     <span class="k">if</span> <span class="p">(</span><span class="nx">support</span><span class="p">.</span><span class="nx">unindexedChars</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">__p</span> <span class="o">+=</span> <span class="s1">&#39;\n  if (isString(iterable)) {\n    iterable = iterable.split(\&#39;\&#39;)\n  }  &#39;</span><span class="p">;</span>
     <span class="p">}</span>
    <span class="nx">__p</span> <span class="o">+=</span> <span class="s1">&#39;\n  while (++index &lt; length) {\n    &#39;</span> <span class="o">+</span>
    <span class="p">(</span><span class="nx">obj</span><span class="p">.</span><span class="nx">loop</span><span class="p">)</span> <span class="o">+</span>
    <span class="s1">&#39;\n  }\n}\nelse {  &#39;</span><span class="p">;</span>
      <span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="nx">support</span><span class="p">.</span><span class="nx">nonEnumArgs</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">__p</span> <span class="o">+=</span> <span class="s1">&#39;\n  var length = iterable.length; index = -1;\n  if (length &amp;&amp; isArguments(iterable)) {\n    while (++index &lt; length) {\n      index += \&#39;\&#39;;\n      &#39;</span> <span class="o">+</span>
    <span class="p">(</span><span class="nx">obj</span><span class="p">.</span><span class="nx">loop</span><span class="p">)</span> <span class="o">+</span>
    <span class="s1">&#39;\n    }\n  } else {  &#39;</span><span class="p">;</span>
     <span class="p">}</span>

     <span class="k">if</span> <span class="p">(</span><span class="nx">support</span><span class="p">.</span><span class="nx">enumPrototypes</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">__p</span> <span class="o">+=</span> <span class="s1">&#39;\n  var skipProto = typeof iterable == \&#39;function\&#39;;\n  &#39;</span><span class="p">;</span>
     <span class="p">}</span>

     <span class="k">if</span> <span class="p">(</span><span class="nx">obj</span><span class="p">.</span><span class="nx">useHas</span> <span class="o">&amp;&amp;</span> <span class="nx">obj</span><span class="p">.</span><span class="nx">useKeys</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">__p</span> <span class="o">+=</span> <span class="s1">&#39;\n  var ownIndex = -1,\n      ownProps = objectTypes[typeof iterable] ? keys(iterable) : [],\n      length = ownProps.length;\n\n  while (++ownIndex &lt; length) {\n    index = ownProps[ownIndex];\n    &#39;</span><span class="p">;</span>
     <span class="k">if</span> <span class="p">(</span><span class="nx">support</span><span class="p">.</span><span class="nx">enumPrototypes</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">__p</span> <span class="o">+=</span> <span class="s1">&#39;if (!(skipProto &amp;&amp; index == \&#39;prototype\&#39;)) {\n  &#39;</span><span class="p">;</span>
     <span class="p">}</span>
    <span class="nx">__p</span> <span class="o">+=</span> 
    <span class="p">(</span><span class="nx">obj</span><span class="p">.</span><span class="nx">loop</span><span class="p">);</span>
     <span class="k">if</span> <span class="p">(</span><span class="nx">support</span><span class="p">.</span><span class="nx">enumPrototypes</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">__p</span> <span class="o">+=</span> <span class="s1">&#39;}\n&#39;</span><span class="p">;</span>
     <span class="p">}</span>
    <span class="nx">__p</span> <span class="o">+=</span> <span class="s1">&#39;  }  &#39;</span><span class="p">;</span>
     <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
    <span class="nx">__p</span> <span class="o">+=</span> <span class="s1">&#39;\n  for (index in iterable) {&#39;</span><span class="p">;</span>
        <span class="k">if</span> <span class="p">(</span><span class="nx">support</span><span class="p">.</span><span class="nx">enumPrototypes</span> <span class="o">||</span> <span class="nx">obj</span><span class="p">.</span><span class="nx">useHas</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">__p</span> <span class="o">+=</span> <span class="s1">&#39;\n    if (&#39;</span><span class="p">;</span>
          <span class="k">if</span> <span class="p">(</span><span class="nx">support</span><span class="p">.</span><span class="nx">enumPrototypes</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">__p</span> <span class="o">+=</span> <span class="s1">&#39;!(skipProto &amp;&amp; index == \&#39;prototype\&#39;)&#39;</span><span class="p">;</span>
     <span class="p">}</span>      <span class="k">if</span> <span class="p">(</span><span class="nx">support</span><span class="p">.</span><span class="nx">enumPrototypes</span> <span class="o">&amp;&amp;</span> <span class="nx">obj</span><span class="p">.</span><span class="nx">useHas</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">__p</span> <span class="o">+=</span> <span class="s1">&#39; &amp;&amp; &#39;</span><span class="p">;</span>
     <span class="p">}</span>      <span class="k">if</span> <span class="p">(</span><span class="nx">obj</span><span class="p">.</span><span class="nx">useHas</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">__p</span> <span class="o">+=</span> <span class="s1">&#39;hasOwnProperty.call(iterable, index)&#39;</span><span class="p">;</span>
     <span class="p">}</span>
    <span class="nx">__p</span> <span class="o">+=</span> <span class="s1">&#39;) {    &#39;</span><span class="p">;</span>
     <span class="p">}</span>
    <span class="nx">__p</span> <span class="o">+=</span> 
    <span class="p">(</span><span class="nx">obj</span><span class="p">.</span><span class="nx">loop</span><span class="p">)</span> <span class="o">+</span>
    <span class="s1">&#39;;    &#39;</span><span class="p">;</span>
     <span class="k">if</span> <span class="p">(</span><span class="nx">support</span><span class="p">.</span><span class="nx">enumPrototypes</span> <span class="o">||</span> <span class="nx">obj</span><span class="p">.</span><span class="nx">useHas</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">__p</span> <span class="o">+=</span> <span class="s1">&#39;\n    }&#39;</span><span class="p">;</span>
     <span class="p">}</span>
    <span class="nx">__p</span> <span class="o">+=</span> <span class="s1">&#39;\n  }    &#39;</span><span class="p">;</span>
     <span class="k">if</span> <span class="p">(</span><span class="nx">support</span><span class="p">.</span><span class="nx">nonEnumShadows</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">__p</span> <span class="o">+=</span> <span class="s1">&#39;\n\n  var ctor = iterable.constructor;\n      &#39;</span><span class="p">;</span>
     <span class="k">for</span> <span class="p">(</span><span class="kd">var</span> <span class="nx">k</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="nx">k</span> <span class="o">&lt;</span> <span class="mi">7</span><span class="p">;</span> <span class="nx">k</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">__p</span> <span class="o">+=</span> <span class="s1">&#39;\n  index = \&#39;&#39;</span> <span class="o">+</span>
    <span class="p">(</span><span class="nx">obj</span><span class="p">.</span><span class="nx">shadowedProps</span><span class="p">[</span><span class="nx">k</span><span class="p">])</span> <span class="o">+</span>
    <span class="s1">&#39;\&#39;;\n  if (&#39;</span><span class="p">;</span>
          <span class="k">if</span> <span class="p">(</span><span class="nx">obj</span><span class="p">.</span><span class="nx">shadowedProps</span><span class="p">[</span><span class="nx">k</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;constructor&#39;</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">__p</span> <span class="o">+=</span> <span class="s1">&#39;!(ctor &amp;&amp; ctor.prototype === iterable) &amp;&amp; &#39;</span><span class="p">;</span>
          <span class="p">}</span>
    <span class="nx">__p</span> <span class="o">+=</span> <span class="s1">&#39;hasOwnProperty.call(iterable, index)) {\n    &#39;</span> <span class="o">+</span>
    <span class="p">(</span><span class="nx">obj</span><span class="p">.</span><span class="nx">loop</span><span class="p">)</span> <span class="o">+</span>
    <span class="s1">&#39;\n  }      &#39;</span><span class="p">;</span>
     <span class="p">}</span>

     <span class="p">}</span>

     <span class="p">}</span>

     <span class="k">if</span> <span class="p">(</span><span class="nx">obj</span><span class="p">.</span><span class="nx">arrays</span> <span class="o">||</span> <span class="nx">support</span><span class="p">.</span><span class="nx">nonEnumArgs</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">__p</span> <span class="o">+=</span> <span class="s1">&#39;\n}&#39;</span><span class="p">;</span>
     <span class="p">}</span>
    <span class="nx">__p</span> <span class="o">+=</span> 
    <span class="p">(</span><span class="nx">obj</span><span class="p">.</span><span class="nx">bottom</span><span class="p">)</span> <span class="o">+</span>
    <span class="s1">&#39;;\nreturn result&#39;</span><span class="p">;</span>

    <span class="k">return</span> <span class="nx">__p</span>
  <span class="p">};</span>

  <span class="cm">/** Reusable iterator options for `assign` and `defaults` */</span>
  <span class="kd">var</span> <span class="nx">defaultsIteratorOptions</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s1">&#39;args&#39;</span><span class="o">:</span> <span class="s1">&#39;object, source, guard&#39;</span><span class="p">,</span>
    <span class="s1">&#39;top&#39;</span><span class="o">:</span>
      <span class="s1">&#39;var args = arguments,\n&#39;</span> <span class="o">+</span>
      <span class="s1">&#39;    argsIndex = 0,\n&#39;</span> <span class="o">+</span>
      <span class="s2">&quot;    argsLength = typeof guard == &#39;number&#39; ? 2 : args.length;\n&quot;</span> <span class="o">+</span>
      <span class="s1">&#39;while (++argsIndex &lt; argsLength) {\n&#39;</span> <span class="o">+</span>
      <span class="s1">&#39;  iterable = args[argsIndex];\n&#39;</span> <span class="o">+</span>
      <span class="s1">&#39;  if (iterable &amp;&amp; objectTypes[typeof iterable]) {&#39;</span><span class="p">,</span>
    <span class="s1">&#39;loop&#39;</span><span class="o">:</span> <span class="s2">&quot;if (typeof result[index] == &#39;undefined&#39;) result[index] = iterable[index]&quot;</span><span class="p">,</span>
    <span class="s1">&#39;bottom&#39;</span><span class="o">:</span> <span class="s1">&#39;  }\n}&#39;</span>
  <span class="p">};</span>

  <span class="cm">/** Reusable iterator options shared by `each`, `forIn`, and `forOwn` */</span>
  <span class="kd">var</span> <span class="nx">eachIteratorOptions</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s1">&#39;args&#39;</span><span class="o">:</span> <span class="s1">&#39;collection, callback, thisArg&#39;</span><span class="p">,</span>
    <span class="s1">&#39;top&#39;</span><span class="o">:</span> <span class="s2">&quot;callback = callback &amp;&amp; typeof thisArg == &#39;undefined&#39; ? callback : lodash.createCallback(callback, thisArg)&quot;</span><span class="p">,</span>
    <span class="s1">&#39;arrays&#39;</span><span class="o">:</span> <span class="s2">&quot;typeof length == &#39;number&#39;&quot;</span><span class="p">,</span>
    <span class="s1">&#39;loop&#39;</span><span class="o">:</span> <span class="s1">&#39;if (callback(iterable[index], index, collection) === false) return result&#39;</span>
  <span class="p">};</span>

  <span class="cm">/** Reusable iterator options for `forIn` and `forOwn` */</span>
  <span class="kd">var</span> <span class="nx">forOwnIteratorOptions</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s1">&#39;top&#39;</span><span class="o">:</span> <span class="s1">&#39;if (!objectTypes[typeof iterable]) return result;\n&#39;</span> <span class="o">+</span> <span class="nx">eachIteratorOptions</span><span class="p">.</span><span class="nx">top</span><span class="p">,</span>
    <span class="s1">&#39;arrays&#39;</span><span class="o">:</span> <span class="kc">false</span>
  <span class="p">};</span>

  <span class="cm">/*--------------------------------------------------------------------------*/</span>

  <span class="cm">/**</span>
<span class="cm">   * Creates a function optimized to search large arrays for a given `value`,</span>
<span class="cm">   * starting at `fromIndex`, using strict equality for comparisons, i.e. `===`.</span>
<span class="cm">   *</span>
<span class="cm">   * @private</span>
<span class="cm">   * @param {Array} array The array to search.</span>
<span class="cm">   * @param {Mixed} value The value to search for.</span>
<span class="cm">   * @returns {Boolean} Returns `true`, if `value` is found, else `false`.</span>
<span class="cm">   */</span>
  <span class="kd">function</span> <span class="nx">cachedContains</span><span class="p">(</span><span class="nx">array</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">length</span> <span class="o">=</span> <span class="nx">array</span><span class="p">.</span><span class="nx">length</span><span class="p">,</span>
        <span class="nx">isLarge</span> <span class="o">=</span> <span class="nx">length</span> <span class="o">&gt;=</span> <span class="nx">largeArraySize</span><span class="p">;</span>

    <span class="k">if</span> <span class="p">(</span><span class="nx">isLarge</span><span class="p">)</span> <span class="p">{</span>
      <span class="kd">var</span> <span class="nx">cache</span> <span class="o">=</span> <span class="p">{},</span>
          <span class="nx">index</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span><span class="p">;</span>

      <span class="k">while</span> <span class="p">(</span><span class="o">++</span><span class="nx">index</span> <span class="o">&lt;</span> <span class="nx">length</span><span class="p">)</span> <span class="p">{</span>
        <span class="kd">var</span> <span class="nx">key</span> <span class="o">=</span> <span class="nx">keyPrefix</span> <span class="o">+</span> <span class="nx">array</span><span class="p">[</span><span class="nx">index</span><span class="p">];</span>
        <span class="p">(</span><span class="nx">cache</span><span class="p">[</span><span class="nx">key</span><span class="p">]</span> <span class="o">||</span> <span class="p">(</span><span class="nx">cache</span><span class="p">[</span><span class="nx">key</span><span class="p">]</span> <span class="o">=</span> <span class="p">[])).</span><span class="nx">push</span><span class="p">(</span><span class="nx">array</span><span class="p">[</span><span class="nx">index</span><span class="p">]);</span>
      <span class="p">}</span>
    <span class="p">}</span>
    <span class="k">return</span> <span class="kd">function</span><span class="p">(</span><span class="nx">value</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">if</span> <span class="p">(</span><span class="nx">isLarge</span><span class="p">)</span> <span class="p">{</span>
        <span class="kd">var</span> <span class="nx">key</span> <span class="o">=</span> <span class="nx">keyPrefix</span> <span class="o">+</span> <span class="nx">value</span><span class="p">;</span>
        <span class="k">return</span>  <span class="nx">cache</span><span class="p">[</span><span class="nx">key</span><span class="p">]</span> <span class="o">&amp;&amp;</span> <span class="nx">indexOf</span><span class="p">(</span><span class="nx">cache</span><span class="p">[</span><span class="nx">key</span><span class="p">],</span> <span class="nx">value</span><span class="p">)</span> <span class="o">&gt;</span> <span class="o">-</span><span class="mi">1</span><span class="p">;</span>
      <span class="p">}</span>
      <span class="k">return</span> <span class="nx">indexOf</span><span class="p">(</span><span class="nx">array</span><span class="p">,</span> <span class="nx">value</span><span class="p">)</span> <span class="o">&gt;</span> <span class="o">-</span><span class="mi">1</span><span class="p">;</span>
    <span class="p">}</span>
  <span class="p">}</span>

  <span class="cm">/**</span>
<span class="cm">   * Used by `_.max` and `_.min` as the default `callback` when a given</span>
<span class="cm">   * `collection` is a string value.</span>
<span class="cm">   *</span>
<span class="cm">   * @private</span>
<span class="cm">   * @param {String} value The character to inspect.</span>
<span class="cm">   * @returns {Number} Returns the code unit of given character.</span>
<span class="cm">   */</span>
  <span class="kd">function</span> <span class="nx">charAtCallback</span><span class="p">(</span><span class="nx">value</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="nx">value</span><span class="p">.</span><span class="nx">charCodeAt</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span>
  <span class="p">}</span>

  <span class="cm">/**</span>
<span class="cm">   * Used by `sortBy` to compare transformed `collection` values, stable sorting</span>
<span class="cm">   * them in ascending order.</span>
<span class="cm">   *</span>
<span class="cm">   * @private</span>
<span class="cm">   * @param {Object} a The object to compare to `b`.</span>
<span class="cm">   * @param {Object} b The object to compare to `a`.</span>
<span class="cm">   * @returns {Number} Returns the sort order indicator of `1` or `-1`.</span>
<span class="cm">   */</span>
  <span class="kd">function</span> <span class="nx">compareAscending</span><span class="p">(</span><span class="nx">a</span><span class="p">,</span> <span class="nx">b</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">ai</span> <span class="o">=</span> <span class="nx">a</span><span class="p">.</span><span class="nx">index</span><span class="p">,</span>
        <span class="nx">bi</span> <span class="o">=</span> <span class="nx">b</span><span class="p">.</span><span class="nx">index</span><span class="p">;</span>

    <span class="nx">a</span> <span class="o">=</span> <span class="nx">a</span><span class="p">.</span><span class="nx">criteria</span><span class="p">;</span>
    <span class="nx">b</span> <span class="o">=</span> <span class="nx">b</span><span class="p">.</span><span class="nx">criteria</span><span class="p">;</span></pre></div></div>
            
        </li>
        
           
        <li id="section-16">
            <div class="annotation">
              <div class="pilwrap">
                <a class="pilcrow" href="#section-16">&#182;</a>
              </div>            
              
<p>ensure a stable sort in V8 and other engines
<a href="http://code.google.com/p/v8/issues/detail?id=90">http://code.google.com/p/v8/issues/detail?id=90</a></p>

            </div>
            
            <div class="content"><div class="highlight"><pre>    <span class="k">if</span> <span class="p">(</span><span class="nx">a</span> <span class="o">!==</span> <span class="nx">b</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">if</span> <span class="p">(</span><span class="nx">a</span> <span class="o">&gt;</span> <span class="nx">b</span> <span class="o">||</span> <span class="k">typeof</span> <span class="nx">a</span> <span class="o">==</span> <span class="s1">&#39;undefined&#39;</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">return</span> <span class="mi">1</span><span class="p">;</span>
      <span class="p">}</span>
      <span class="k">if</span> <span class="p">(</span><span class="nx">a</span> <span class="o">&lt;</span> <span class="nx">b</span> <span class="o">||</span> <span class="k">typeof</span> <span class="nx">b</span> <span class="o">==</span> <span class="s1">&#39;undefined&#39;</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">return</span> <span class="o">-</span><span class="mi">1</span><span class="p">;</span>
      <span class="p">}</span>
    <span class="p">}</span>
    <span class="k">return</span> <span class="nx">ai</span> <span class="o">&lt;</span> <span class="nx">bi</span> <span class="o">?</span> <span class="o">-</span><span class="mi">1</span> <span class="o">:</span> <span class="mi">1</span><span class="p">;</span>
  <span class="p">}</span>

  <span class="cm">/**</span>
<span class="cm">   * Creates a function that, when called, invokes `func` with the `this` binding</span>
<span class="cm">   * of `thisArg` and prepends any `partialArgs` to the arguments passed to the</span>
<span class="cm">   * bound function.</span>
<span class="cm">   *</span>
<span class="cm">   * @private</span>
<span class="cm">   * @param {Function|String} func The function to bind or the method name.</span>
<span class="cm">   * @param {Mixed} [thisArg] The `this` binding of `func`.</span>
<span class="cm">   * @param {Array} partialArgs An array of arguments to be partially applied.</span>
<span class="cm">   * @param {Object} [idicator] Used to indicate binding by key or partially</span>
<span class="cm">   *  applying arguments from the right.</span>
<span class="cm">   * @returns {Function} Returns the new bound function.</span>
<span class="cm">   */</span>
  <span class="kd">function</span> <span class="nx">createBound</span><span class="p">(</span><span class="nx">func</span><span class="p">,</span> <span class="nx">thisArg</span><span class="p">,</span> <span class="nx">partialArgs</span><span class="p">,</span> <span class="nx">indicator</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">isFunc</span> <span class="o">=</span> <span class="nx">isFunction</span><span class="p">(</span><span class="nx">func</span><span class="p">),</span>
        <span class="nx">isPartial</span> <span class="o">=</span> <span class="o">!</span><span class="nx">partialArgs</span><span class="p">,</span>
        <span class="nx">key</span> <span class="o">=</span> <span class="nx">thisArg</span><span class="p">;</span></pre></div></div>
            
        </li>
        
           
        <li id="section-17">
            <div class="annotation">
              <div class="pilwrap">
                <a class="pilcrow" href="#section-17">&#182;</a>
              </div>            
              
<p>juggle arguments</p>

            </div>
            
            <div class="content"><div class="highlight"><pre>    <span class="k">if</span> <span class="p">(</span><span class="nx">isPartial</span><span class="p">)</span> <span class="p">{</span>
      <span class="kd">var</span> <span class="nx">rightIndicator</span> <span class="o">=</span> <span class="nx">indicator</span><span class="p">;</span>
      <span class="nx">partialArgs</span> <span class="o">=</span> <span class="nx">thisArg</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">isFunc</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">indicator</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">throw</span> <span class="k">new</span> <span class="nx">TypeError</span><span class="p">;</span>
      <span class="p">}</span>
      <span class="nx">thisArg</span> <span class="o">=</span> <span class="nx">func</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="kd">function</span> <span class="nx">bound</span><span class="p">()</span> <span class="p">{</span></pre></div></div>
            
        </li>
        
           
        <li id="section-18">
            <div class="annotation">
              <div class="pilwrap">
                <a class="pilcrow" href="#section-18">&#182;</a>
              </div>            
              
<p><code>Function#bind</code> spec
<a href="http://es5.github.com/#x15.3.4.5">http://es5.github.com/#x15.3.4.5</a></p>

            </div>
            
            <div class="content"><div class="highlight"><pre>      <span class="kd">var</span> <span class="nx">args</span> <span class="o">=</span> <span class="nx">arguments</span><span class="p">,</span>
          <span class="nx">thisBinding</span> <span class="o">=</span> <span class="nx">isPartial</span> <span class="o">?</span> <span class="k">this</span> <span class="o">:</span> <span class="nx">thisArg</span><span class="p">;</span>

      <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">isFunc</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">func</span> <span class="o">=</span> <span class="nx">thisArg</span><span class="p">[</span><span class="nx">key</span><span class="p">];</span>
      <span class="p">}</span>
      <span class="k">if</span> <span class="p">(</span><span class="nx">partialArgs</span><span class="p">.</span><span class="nx">length</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">args</span> <span class="o">=</span> <span class="nx">args</span><span class="p">.</span><span class="nx">length</span>
          <span class="o">?</span> <span class="p">(</span><span class="nx">args</span> <span class="o">=</span> <span class="nx">nativeSlice</span><span class="p">.</span><span class="nx">call</span><span class="p">(</span><span class="nx">args</span><span class="p">),</span> <span class="nx">rightIndicator</span> <span class="o">?</span> <span class="nx">args</span><span class="p">.</span><span class="nx">concat</span><span class="p">(</span><span class="nx">partialArgs</span><span class="p">)</span> <span class="o">:</span> <span class="nx">partialArgs</span><span class="p">.</span><span class="nx">concat</span><span class="p">(</span><span class="nx">args</span><span class="p">))</span>
          <span class="o">:</span> <span class="nx">partialArgs</span><span class="p">;</span>
      <span class="p">}</span>
      <span class="k">if</span> <span class="p">(</span><span class="k">this</span> <span class="k">instanceof</span> <span class="nx">bound</span><span class="p">)</span> <span class="p">{</span></pre></div></div>
            
        </li>
        
           
        <li id="section-19">
            <div class="annotation">
              <div class="pilwrap">
                <a class="pilcrow" href="#section-19">&#182;</a>
              </div>            
              
<p>ensure <code>new bound</code> is an instance of <code>func</code></p>

            </div>
            
            <div class="content"><div class="highlight"><pre>        <span class="nx">noop</span><span class="p">.</span><span class="nx">prototype</span> <span class="o">=</span> <span class="nx">func</span><span class="p">.</span><span class="nx">prototype</span><span class="p">;</span>
        <span class="nx">thisBinding</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">noop</span><span class="p">;</span>
        <span class="nx">noop</span><span class="p">.</span><span class="nx">prototype</span> <span class="o">=</span> <span class="kc">null</span><span class="p">;</span></pre></div></div>
            
        </li>
        
           
        <li id="section-20">
            <div class="annotation">
              <div class="pilwrap">
                <a class="pilcrow" href="#section-20">&#182;</a>
              </div>            
              
<p>mimic the constructor&#39;s <code>return</code> behavior
<a href="http://es5.github.com/#x13.2.2">http://es5.github.com/#x13.2.2</a></p>

            </div>
            
            <div class="content"><div class="highlight"><pre>        <span class="kd">var</span> <span class="nx">result</span> <span class="o">=</span> <span class="nx">func</span><span class="p">.</span><span class="nx">apply</span><span class="p">(</span><span class="nx">thisBinding</span><span class="p">,</span> <span class="nx">args</span><span class="p">);</span>
        <span class="k">return</span> <span class="nx">isObject</span><span class="p">(</span><span class="nx">result</span><span class="p">)</span> <span class="o">?</span> <span class="nx">result</span> <span class="o">:</span> <span class="nx">thisBinding</span><span class="p">;</span>
      <span class="p">}</span>
      <span class="k">return</span> <span class="nx">func</span><span class="p">.</span><span class="nx">apply</span><span class="p">(</span><span class="nx">thisBinding</span><span class="p">,</span> <span class="nx">args</span><span class="p">);</span>
    <span class="p">}</span>
    <span class="k">return</span> <span class="nx">bound</span><span class="p">;</span>
  <span class="p">}</span>

  <span class="cm">/**</span>
<span class="cm">   * Creates compiled iteration functions.</span>
<span class="cm">   *</span>
<span class="cm">   * @private</span>
<span class="cm">   * @param {Object} [options1, options2, ...] The compile options object(s).</span>
<span class="cm">   *  arrays - A string of code to determine if the iterable is an array or array-like.</span>
<span class="cm">   *  useHas - A boolean to specify using `hasOwnProperty` checks in the object loop.</span>
<span class="cm">   *  useKeys - A boolean to specify using `_.keys` for own property iteration.</span>
<span class="cm">   *  args - A string of comma separated arguments the iteration function will accept.</span>
<span class="cm">   *  top - A string of code to execute before the iteration branches.</span>
<span class="cm">   *  loop - A string of code to execute in the object loop.</span>
<span class="cm">   *  bottom - A string of code to execute after the iteration branches.</span>
<span class="cm">   * @returns {Function} Returns the compiled function.</span>
<span class="cm">   */</span>
  <span class="kd">function</span> <span class="nx">createIterator</span><span class="p">()</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">data</span> <span class="o">=</span> <span class="p">{</span></pre></div></div>
            
        </li>
        
           
        <li id="section-21">
            <div class="annotation">
              <div class="pilwrap">
                <a class="pilcrow" href="#section-21">&#182;</a>
              </div>            
              
<p>data properties</p>

            </div>
            
            <div class="content"><div class="highlight"><pre>      <span class="s1">&#39;shadowedProps&#39;</span><span class="o">:</span> <span class="nx">shadowedProps</span><span class="p">,</span></pre></div></div>
            
        </li>
        
           
        <li id="section-22">
            <div class="annotation">
              <div class="pilwrap">
                <a class="pilcrow" href="#section-22">&#182;</a>
              </div>            
              
<p>iterator options</p>

            </div>
            
            <div class="content"><div class="highlight"><pre>      <span class="s1">&#39;arrays&#39;</span><span class="o">:</span> <span class="s1">&#39;isArray(iterable)&#39;</span><span class="p">,</span>
      <span class="s1">&#39;bottom&#39;</span><span class="o">:</span> <span class="s1">&#39;&#39;</span><span class="p">,</span>
      <span class="s1">&#39;init&#39;</span><span class="o">:</span> <span class="s1">&#39;iterable&#39;</span><span class="p">,</span>
      <span class="s1">&#39;loop&#39;</span><span class="o">:</span> <span class="s1">&#39;&#39;</span><span class="p">,</span>
      <span class="s1">&#39;top&#39;</span><span class="o">:</span> <span class="s1">&#39;&#39;</span><span class="p">,</span>
      <span class="s1">&#39;useHas&#39;</span><span class="o">:</span> <span class="kc">true</span><span class="p">,</span>
      <span class="s1">&#39;useKeys&#39;</span><span class="o">:</span> <span class="o">!!</span><span class="nx">keys</span>
    <span class="p">};</span></pre></div></div>
            
        </li>
        
           
        <li id="section-23">
            <div class="annotation">
              <div class="pilwrap">
                <a class="pilcrow" href="#section-23">&#182;</a>
              </div>            
              
<p>merge options into a template data object</p>

            </div>
            
            <div class="content"><div class="highlight"><pre>    <span class="k">for</span> <span class="p">(</span><span class="kd">var</span> <span class="nx">object</span><span class="p">,</span> <span class="nx">index</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="nx">object</span> <span class="o">=</span> <span class="nx">arguments</span><span class="p">[</span><span class="nx">index</span><span class="p">];</span> <span class="nx">index</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">for</span> <span class="p">(</span><span class="kd">var</span> <span class="nx">key</span> <span class="k">in</span> <span class="nx">object</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">data</span><span class="p">[</span><span class="nx">key</span><span class="p">]</span> <span class="o">=</span> <span class="nx">object</span><span class="p">[</span><span class="nx">key</span><span class="p">];</span>
      <span class="p">}</span>
    <span class="p">}</span>
    <span class="kd">var</span> <span class="nx">args</span> <span class="o">=</span> <span class="nx">data</span><span class="p">.</span><span class="nx">args</span><span class="p">;</span>
    <span class="nx">data</span><span class="p">.</span><span class="nx">firstArg</span> <span class="o">=</span> <span class="sr">/^[^,]+/</span><span class="p">.</span><span class="nx">exec</span><span class="p">(</span><span class="nx">args</span><span class="p">)[</span><span class="mi">0</span><span class="p">];</span></pre></div></div>
            
        </li>
        
           
        <li id="section-24">
            <div class="annotation">
              <div class="pilwrap">
                <a class="pilcrow" href="#section-24">&#182;</a>
              </div>            
              
<p>create the function factory</p>

            </div>
            
            <div class="content"><div class="highlight"><pre>    <span class="kd">var</span> <span class="nx">factory</span> <span class="o">=</span> <span class="nb">Function</span><span class="p">(</span>
        <span class="s1">&#39;hasOwnProperty, isArguments, isArray, keys, &#39;</span> <span class="o">+</span>
        <span class="s1">&#39;lodash, objectTypes&#39;</span><span class="p">,</span>
      <span class="s1">&#39;return function(&#39;</span> <span class="o">+</span> <span class="nx">args</span> <span class="o">+</span> <span class="s1">&#39;) {\n&#39;</span> <span class="o">+</span> <span class="nx">iteratorTemplate</span><span class="p">(</span><span class="nx">data</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;\n}&#39;</span>
    <span class="p">);</span></pre></div></div>
            
        </li>
        
           
        <li id="section-25">
            <div class="annotation">
              <div class="pilwrap">
                <a class="pilcrow" href="#section-25">&#182;</a>
              </div>            
              
<p>return the compiled function</p>

            </div>
            
            <div class="content"><div class="highlight"><pre>    <span class="k">return</span> <span class="nx">factory</span><span class="p">(</span>
      <span class="nx">hasOwnProperty</span><span class="p">,</span> <span class="nx">isArguments</span><span class="p">,</span> <span class="nx">isArray</span><span class="p">,</span> <span class="nx">keys</span><span class="p">,</span>
      <span class="nx">lodash</span><span class="p">,</span> <span class="nx">objectTypes</span>
    <span class="p">);</span>
  <span class="p">}</span>

  <span class="cm">/**</span>
<span class="cm">   * Used by `template` to escape characters for inclusion in compiled</span>
<span class="cm">   * string literals.</span>
<span class="cm">   *</span>
<span class="cm">   * @private</span>
<span class="cm">   * @param {String} match The matched character to escape.</span>
<span class="cm">   * @returns {String} Returns the escaped character.</span>
<span class="cm">   */</span>
  <span class="kd">function</span> <span class="nx">escapeStringChar</span><span class="p">(</span><span class="nx">match</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="s1">&#39;\\&#39;</span> <span class="o">+</span> <span class="nx">stringEscapes</span><span class="p">[</span><span class="nx">match</span><span class="p">];</span>
  <span class="p">}</span>

  <span class="cm">/**</span>
<span class="cm">   * Used by `escape` to convert characters to HTML entities.</span>
<span class="cm">   *</span>
<span class="cm">   * @private</span>
<span class="cm">   * @param {String} match The matched character to escape.</span>
<span class="cm">   * @returns {String} Returns the escaped character.</span>
<span class="cm">   */</span>
  <span class="kd">function</span> <span class="nx">escapeHtmlChar</span><span class="p">(</span><span class="nx">match</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="nx">htmlEscapes</span><span class="p">[</span><span class="nx">match</span><span class="p">];</span>
  <span class="p">}</span>

  <span class="cm">/**</span>
<span class="cm">   * Checks if `value` is a DOM node in IE &lt; 9.</span>
<span class="cm">   *</span>
<span class="cm">   * @private</span>
<span class="cm">   * @param {Mixed} value The value to check.</span>
<span class="cm">   * @returns {Boolean} Returns `true` if the `value` is a DOM node, else `false`.</span>
<span class="cm">   */</span>
  <span class="kd">function</span> <span class="nx">isNode</span><span class="p">(</span><span class="nx">value</span><span class="p">)</span> <span class="p">{</span></pre></div></div>
            
        </li>
        
           
        <li id="section-26">
            <div class="annotation">
              <div class="pilwrap">
                <a class="pilcrow" href="#section-26">&#182;</a>
              </div>            
              
<p>IE &lt; 9 presents DOM nodes as <code>Object</code> objects except they have <code>toString</code>
methods that are <code>typeof</code> &quot;string&quot; and still can coerce nodes to strings</p>

            </div>
            
            <div class="content"><div class="highlight"><pre>    <span class="k">return</span> <span class="k">typeof</span> <span class="nx">value</span><span class="p">.</span><span class="nx">toString</span> <span class="o">!=</span> <span class="s1">&#39;function&#39;</span> <span class="o">&amp;&amp;</span> <span class="k">typeof</span> <span class="p">(</span><span class="nx">value</span> <span class="o">+</span> <span class="s1">&#39;&#39;</span><span class="p">)</span> <span class="o">==</span> <span class="s1">&#39;string&#39;</span><span class="p">;</span>
  <span class="p">}</span>

  <span class="cm">/**</span>
<span class="cm">   * A no-operation function.</span>
<span class="cm">   *</span>
<span class="cm">   * @private</span>
<span class="cm">   */</span>
  <span class="kd">function</span> <span class="nx">noop</span><span class="p">()</span> <span class="p">{</span></pre></div></div>
            
        </li>
        
           
        <li id="section-27">
            <div class="annotation">
              <div class="pilwrap">
                <a class="pilcrow" href="#section-27">&#182;</a>
              </div>            
              
<p>no operation performed</p>

            </div>
            
            <div class="content"><div class="highlight"><pre>  <span class="p">}</span>

  <span class="cm">/**</span>
<span class="cm">   * Slices the `collection` from the `start` index up to, but not including,</span>
<span class="cm">   * the `end` index.</span>
<span class="cm">   *</span>
<span class="cm">   * Note: This function is used, instead of `Array#slice`, to support node lists</span>
<span class="cm">   * in IE &lt; 9 and to ensure dense arrays are returned.</span>
<span class="cm">   *</span>
<span class="cm">   * @private</span>
<span class="cm">   * @param {Array|Object|String} collection The collection to slice.</span>
<span class="cm">   * @param {Number} start The start index.</span>
<span class="cm">   * @param {Number} end The end index.</span>
<span class="cm">   * @returns {Array} Returns the new array.</span>
<span class="cm">   */</span>
  <span class="kd">function</span> <span class="nx">slice</span><span class="p">(</span><span class="nx">array</span><span class="p">,</span> <span class="nx">start</span><span class="p">,</span> <span class="nx">end</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">start</span> <span class="o">||</span> <span class="p">(</span><span class="nx">start</span> <span class="o">=</span> <span class="mi">0</span><span class="p">);</span>
    <span class="k">if</span> <span class="p">(</span><span class="k">typeof</span> <span class="nx">end</span> <span class="o">==</span> <span class="s1">&#39;undefined&#39;</span><span class="p">)</span> <span class="p">{</span>
      <span class="nx">end</span> <span class="o">=</span> <span class="nx">array</span> <span class="o">?</span> <span class="nx">array</span><span class="p">.</span><span class="nx">length</span> <span class="o">:</span> <span class="mi">0</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="kd">var</span> <span class="nx">index</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span>
        <span class="nx">length</span> <span class="o">=</span> <span class="nx">end</span> <span class="o">-</span> <span class="nx">start</span> <span class="o">||</span> <span class="mi">0</span><span class="p">,</span>
        <span class="nx">result</span> <span class="o">=</span> <span class="nb">Array</span><span class="p">(</span><span class="nx">length</span> <span class="o">&lt;</span> <span class="mi">0</span> <span class="o">?</span> <span class="mi">0</span> <span class="o">:</span> <span class="nx">length</span><span class="p">);</span>

    <span class="k">while</span> <span class="p">(</span><span class="o">++</span><span class="nx">index</span> <span class="o">&lt;</span> <span class="nx">length</span><span class="p">)</span> <span class="p">{</span>
      <span class="nx">result</span><span class="p">[</span><span class="nx">index</span><span class="p">]</span> <span class="o">=</span> <span class="nx">array</span><span class="p">[</span><span class="nx">start</span> <span class="o">+</span> <span class="nx">index</span><span class="p">];</span>
    <span class="p">}</span>
    <span class="k">return</span> <span class="nx">result</span><span class="p">;</span>
  <span class="p">}</span>

  <span class="cm">/**</span>
<span class="cm">   * Used by `unescape` to convert HTML entities to characters.</span>
<span class="cm">   *</span>
<span class="cm">   * @private</span>
<span class="cm">   * @param {String} match The matched character to unescape.</span>
<span class="cm">   * @returns {String} Returns the unescaped character.</span>
<span class="cm">   */</span>
  <span class="kd">function</span> <span class="nx">unescapeHtmlChar</span><span class="p">(</span><span class="nx">match</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="nx">htmlUnescapes</span><span class="p">[</span><span class="nx">match</span><span class="p">];</span>
  <span class="p">}</span>

  <span class="cm">/*--------------------------------------------------------------------------*/</span>

  <span class="cm">/**</span>
<span class="cm">   * Checks if `value` is an `arguments` object.</span>
<span class="cm">   *</span>
<span class="cm">   * @static</span>
<span class="cm">   * @memberOf _</span>
<span class="cm">   * @category Objects</span>
<span class="cm">   * @param {Mixed} value The value to check.</span>
<span class="cm">   * @returns {Boolean} Returns `true`, if the `value` is an `arguments` object, else `false`.</span>
<span class="cm">   * @example</span>
<span class="cm">   *</span>
<span class="cm">   * (function() { return _.isArguments(arguments); })(1, 2, 3);</span>
<span class="cm">   * // =&gt; true</span>
<span class="cm">   *</span>
<span class="cm">   * _.isArguments([1, 2, 3]);</span>
<span class="cm">   * // =&gt; false</span>
<span class="cm">   */</span>
  <span class="kd">function</span> <span class="nx">isArguments</span><span class="p">(</span><span class="nx">value</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="nx">toString</span><span class="p">.</span><span class="nx">call</span><span class="p">(</span><span class="nx">value</span><span class="p">)</span> <span class="o">==</span> <span class="nx">argsClass</span><span class="p">;</span>
  <span class="p">}</span></pre></div></div>
            
        </li>
        
           
        <li id="section-28">
            <div class="annotation">
              <div class="pilwrap">
                <a class="pilcrow" href="#section-28">&#182;</a>
              </div>            
              
<p>fallback for browsers that can&#39;t detect <code>arguments</code> objects by [[Class]]</p>

            </div>
            
            <div class="content"><div class="highlight"><pre>  <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">support</span><span class="p">.</span><span class="nx">argsClass</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">isArguments</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">value</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">return</span> <span class="nx">value</span> <span class="o">?</span> <span class="nx">hasOwnProperty</span><span class="p">.</span><span class="nx">call</span><span class="p">(</span><span class="nx">value</span><span class="p">,</span> <span class="s1">&#39;callee&#39;</span><span class="p">)</span> <span class="o">:</span> <span class="kc">false</span><span class="p">;</span>
    <span class="p">};</span>
  <span class="p">}</span>

  <span class="cm">/**</span>
<span class="cm">   * Checks if `value` is an array.</span>
<span class="cm">   *</span>
<span class="cm">   * @static</span>
<span class="cm">   * @memberOf _</span>
<span class="cm">   * @category Objects</span>
<span class="cm">   * @param {Mixed} value The value to check.</span>
<span class="cm">   * @returns {Boolean} Returns `true`, if the `value` is an array, else `false`.</span>
<span class="cm">   * @example</span>
<span class="cm">   *</span>
<span class="cm">   * (function() { return _.isArray(arguments); })();</span>
<span class="cm">   * // =&gt; false</span>
<span class="cm">   *</span>
<span class="cm">   * _.isArray([1, 2, 3]);</span>
<span class="cm">   * // =&gt; true</span>
<span class="cm">   */</span>
  <span class="kd">var</span> <span class="nx">isArray</span> <span class="o">=</span> <span class="nx">nativeIsArray</span> <span class="o">||</span> <span class="kd">function</span><span class="p">(</span><span class="nx">value</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="nx">value</span> <span class="o">?</span> <span class="p">(</span><span class="k">typeof</span> <span class="nx">value</span> <span class="o">==</span> <span class="s1">&#39;object&#39;</span> <span class="o">&amp;&amp;</span> <span class="nx">toString</span><span class="p">.</span><span class="nx">call</span><span class="p">(</span><span class="nx">value</span><span class="p">)</span> <span class="o">==</span> <span class="nx">arrayClass</span><span class="p">)</span> <span class="o">:</span> <span class="kc">false</span><span class="p">;</span>
  <span class="p">};</span>

  <span class="cm">/**</span>
<span class="cm">   * A fallback implementation of `Object.keys` which produces an array of the</span>
<span class="cm">   * given object&#39;s own enumerable property names.</span>
<span class="cm">   *</span>
<span class="cm">   * @private</span>
<span class="cm">   * @type Function</span>
<span class="cm">   * @param {Object} object The object to inspect.</span>
<span class="cm">   * @returns {Array} Returns a new array of property names.</span>
<span class="cm">   */</span>
  <span class="kd">var</span> <span class="nx">shimKeys</span> <span class="o">=</span> <span class="nx">createIterator</span><span class="p">({</span>
    <span class="s1">&#39;args&#39;</span><span class="o">:</span> <span class="s1">&#39;object&#39;</span><span class="p">,</span>
    <span class="s1">&#39;init&#39;</span><span class="o">:</span> <span class="s1">&#39;[]&#39;</span><span class="p">,</span>
    <span class="s1">&#39;top&#39;</span><span class="o">:</span> <span class="s1">&#39;if (!(objectTypes[typeof object])) return result&#39;</span><span class="p">,</span>
    <span class="s1">&#39;loop&#39;</span><span class="o">:</span> <span class="s1">&#39;result.push(index)&#39;</span><span class="p">,</span>
    <span class="s1">&#39;arrays&#39;</span><span class="o">:</span> <span class="kc">false</span>
  <span class="p">});</span>

  <span class="cm">/**</span>
<span class="cm">   * Creates an array composed of the own enumerable property names of `object`.</span>
<span class="cm">   *</span>
<span class="cm">   * @static</span>
<span class="cm">   * @memberOf _</span>
<span class="cm">   * @category Objects</span>
<span class="cm">   * @param {Object} object The object to inspect.</span>
<span class="cm">   * @returns {Array} Returns a new array of property names.</span>
<span class="cm">   * @example</span>
<span class="cm">   *</span>
<span class="cm">   * _.keys({ &#39;one&#39;: 1, &#39;two&#39;: 2, &#39;three&#39;: 3 });</span>
<span class="cm">   * // =&gt; [&#39;one&#39;, &#39;two&#39;, &#39;three&#39;] (order is not guaranteed)</span>
<span class="cm">   */</span>
  <span class="kd">var</span> <span class="nx">keys</span> <span class="o">=</span> <span class="o">!</span><span class="nx">nativeKeys</span> <span class="o">?</span> <span class="nx">shimKeys</span> <span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">object</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">isObject</span><span class="p">(</span><span class="nx">object</span><span class="p">))</span> <span class="p">{</span>
      <span class="k">return</span> <span class="p">[];</span>
    <span class="p">}</span>
    <span class="k">if</span> <span class="p">((</span><span class="nx">support</span><span class="p">.</span><span class="nx">enumPrototypes</span> <span class="o">&amp;&amp;</span> <span class="k">typeof</span> <span class="nx">object</span> <span class="o">==</span> <span class="s1">&#39;function&#39;</span><span class="p">)</span> <span class="o">||</span>
        <span class="p">(</span><span class="nx">support</span><span class="p">.</span><span class="nx">nonEnumArgs</span> <span class="o">&amp;&amp;</span> <span class="nx">object</span><span class="p">.</span><span class="nx">length</span> <span class="o">&amp;&amp;</span> <span class="nx">isArguments</span><span class="p">(</span><span class="nx">object</span><span class="p">)))</span> <span class="p">{</span>
      <span class="k">return</span> <span class="nx">shimKeys</span><span class="p">(</span><span class="nx">object</span><span class="p">);</span>
    <span class="p">}</span>
    <span class="k">return</span> <span class="nx">nativeKeys</span><span class="p">(</span><span class="nx">object</span><span class="p">);</span>
  <span class="p">};</span>

  <span class="cm">/**</span>
<span class="cm">   * Used to convert characters to HTML entities:</span>
<span class="cm">   *</span>
<span class="cm">   * Though the `&gt;` character is escaped for symmetry, characters like `&gt;` and `/`</span>
<span class="cm">   * don&#39;t require escaping in HTML and have no special meaning unless they&#39;re part</span>
<span class="cm">   * of a tag or an unquoted attribute value.</span>
<span class="cm">   * http://mathiasbynens.be/notes/ambiguous-ampersands (under &quot;semi-related fun fact&quot;)</span>
<span class="cm">   */</span>
  <span class="kd">var</span> <span class="nx">htmlEscapes</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s1">&#39;&amp;&#39;</span><span class="o">:</span> <span class="s1">&#39;&amp;amp;&#39;</span><span class="p">,</span>
    <span class="s1">&#39;&lt;&#39;</span><span class="o">:</span> <span class="s1">&#39;&amp;lt;&#39;</span><span class="p">,</span>
    <span class="s1">&#39;&gt;&#39;</span><span class="o">:</span> <span class="s1">&#39;&amp;gt;&#39;</span><span class="p">,</span>
    <span class="s1">&#39;&quot;&#39;</span><span class="o">:</span> <span class="s1">&#39;&amp;quot;&#39;</span><span class="p">,</span>
    <span class="s2">&quot;&#39;&quot;</span><span class="o">:</span> <span class="s1">&#39;&amp;#39;&#39;</span>
  <span class="p">};</span>

  <span class="cm">/** Used to convert HTML entities to characters */</span>
  <span class="kd">var</span> <span class="nx">htmlUnescapes</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;&amp;amp;&#39;</span><span class="o">:</span><span class="s1">&#39;&amp;&#39;</span><span class="p">,</span><span class="s1">&#39;&amp;lt;&#39;</span><span class="o">:</span><span class="s1">&#39;&lt;&#39;</span><span class="p">,</span><span class="s1">&#39;&amp;gt;&#39;</span><span class="o">:</span><span class="s1">&#39;&gt;&#39;</span><span class="p">,</span><span class="s1">&#39;&amp;quot;&#39;</span><span class="o">:</span><span class="s1">&#39;&quot;&#39;</span><span class="p">,</span><span class="s1">&#39;&amp;#x27;&#39;</span><span class="o">:</span><span class="s2">&quot;&#39;&quot;</span><span class="p">};</span>

  <span class="cm">/*--------------------------------------------------------------------------*/</span>

  <span class="cm">/**</span>
<span class="cm">   * Assigns own enumerable properties of source object(s) to the destination</span>
<span class="cm">   * object for all destination properties that resolve to `undefined`. Once a</span>
<span class="cm">   * property is set, additional defaults of the same property will be ignored.</span>
<span class="cm">   *</span>
<span class="cm">   * @static</span>
<span class="cm">   * @memberOf _</span>
<span class="cm">   * @type Function</span>
<span class="cm">   * @category Objects</span>
<span class="cm">   * @param {Object} object The destination object.</span>
<span class="cm">   * @param {Object} [source1, source2, ...] The source objects.</span>
<span class="cm">   * @param- {Object} [guard] Allows working with `_.reduce` without using its</span>
<span class="cm">   *  callback&#39;s `key` and `object` arguments as sources.</span>
<span class="cm">   * @returns {Object} Returns the destination object.</span>
<span class="cm">   * @example</span>
<span class="cm">   *</span>
<span class="cm">   * var food = { &#39;name&#39;: &#39;apple&#39; };</span>
<span class="cm">   * _.defaults(food, { &#39;name&#39;: &#39;banana&#39;, &#39;type&#39;: &#39;fruit&#39; });</span>
<span class="cm">   * // =&gt; { &#39;name&#39;: &#39;apple&#39;, &#39;type&#39;: &#39;fruit&#39; }</span>
<span class="cm">   */</span>
  <span class="kd">var</span> <span class="nx">defaults</span> <span class="o">=</span> <span class="nx">createIterator</span><span class="p">(</span><span class="nx">defaultsIteratorOptions</span><span class="p">);</span>

  <span class="cm">/**</span>
<span class="cm">   * Iterates over `object`&#39;s own and inherited enumerable properties, executing</span>
<span class="cm">   * the `callback` for each property. The `callback` is bound to `thisArg` and</span>
<span class="cm">   * invoked with three arguments; (value, key, object). Callbacks may exit iteration</span>
<span class="cm">   * early by explicitly returning `false`.</span>
<span class="cm">   *</span>
<span class="cm">   * @static</span>
<span class="cm">   * @memberOf _</span>
<span class="cm">   * @type Function</span>
<span class="cm">   * @category Objects</span>
<span class="cm">   * @param {Object} object The object to iterate over.</span>
<span class="cm">   * @param {Function} [callback=identity] The function called per iteration.</span>
<span class="cm">   * @param {Mixed} [thisArg] The `this` binding of `callback`.</span>
<span class="cm">   * @returns {Object} Returns `object`.</span>
<span class="cm">   * @example</span>
<span class="cm">   *</span>
<span class="cm">   * function Dog(name) {</span>
<span class="cm">   *   this.name = name;</span>
<span class="cm">   * }</span>
<span class="cm">   *</span>
<span class="cm">   * Dog.prototype.bark = function() {</span>
<span class="cm">   *   alert(&#39;Woof, woof!&#39;);</span>
<span class="cm">   * };</span>
<span class="cm">   *</span>
<span class="cm">   * _.forIn(new Dog(&#39;Dagny&#39;), function(value, key) {</span>
<span class="cm">   *   alert(key);</span>
<span class="cm">   * });</span>
<span class="cm">   * // =&gt; alerts &#39;name&#39; and &#39;bark&#39; (order is not guaranteed)</span>
<span class="cm">   */</span>
  <span class="kd">var</span> <span class="nx">forIn</span> <span class="o">=</span> <span class="nx">createIterator</span><span class="p">(</span><span class="nx">eachIteratorOptions</span><span class="p">,</span> <span class="nx">forOwnIteratorOptions</span><span class="p">,</span> <span class="p">{</span>
    <span class="s1">&#39;useHas&#39;</span><span class="o">:</span> <span class="kc">false</span>
  <span class="p">});</span>

  <span class="cm">/**</span>
<span class="cm">   * Iterates over an object&#39;s own enumerable properties, executing the `callback`</span>
<span class="cm">   * for each property. The `callback` is bound to `thisArg` and invoked with three</span>
<span class="cm">   * arguments; (value, key, object). Callbacks may exit iteration early by explicitly</span>
<span class="cm">   * returning `false`.</span>
<span class="cm">   *</span>
<span class="cm">   * @static</span>
<span class="cm">   * @memberOf _</span>
<span class="cm">   * @type Function</span>
<span class="cm">   * @category Objects</span>
<span class="cm">   * @param {Object} object The object to iterate over.</span>
<span class="cm">   * @param {Function} [callback=identity] The function called per iteration.</span>
<span class="cm">   * @param {Mixed} [thisArg] The `this` binding of `callback`.</span>
<span class="cm">   * @returns {Object} Returns `object`.</span>
<span class="cm">   * @example</span>
<span class="cm">   *</span>
<span class="cm">   * _.forOwn({ &#39;0&#39;: &#39;zero&#39;, &#39;1&#39;: &#39;one&#39;, &#39;length&#39;: 2 }, function(num, key) {</span>
<span class="cm">   *   alert(key);</span>
<span class="cm">   * });</span>
<span class="cm">   * // =&gt; alerts &#39;0&#39;, &#39;1&#39;, and &#39;length&#39; (order is not guaranteed)</span>
<span class="cm">   */</span>
  <span class="kd">var</span> <span class="nx">forOwn</span> <span class="o">=</span> <span class="nx">createIterator</span><span class="p">(</span><span class="nx">eachIteratorOptions</span><span class="p">,</span> <span class="nx">forOwnIteratorOptions</span><span class="p">);</span>

  <span class="cm">/**</span>
<span class="cm">   * Performs a deep comparison between two values to determine if they are</span>
<span class="cm">   * equivalent to each other. If `callback` is passed, it will be executed to</span>
<span class="cm">   * compare values. If `callback` returns `undefined`, comparisons will be handled</span>
<span class="cm">   * by the method instead. The `callback` is bound to `thisArg` and invoked with</span>
<span class="cm">   * two arguments; (a, b).</span>
<span class="cm">   *</span>
<span class="cm">   * @static</span>
<span class="cm">   * @memberOf _</span>
<span class="cm">   * @category Objects</span>
<span class="cm">   * @param {Mixed} a The value to compare.</span>
<span class="cm">   * @param {Mixed} b The other value to compare.</span>
<span class="cm">   * @param {Function} [callback] The function to customize comparing values.</span>
<span class="cm">   * @param {Mixed} [thisArg] The `this` binding of `callback`.</span>
<span class="cm">   * @param- {Array} [stackA=[]] Tracks traversed `a` objects.</span>
<span class="cm">   * @param- {Array} [stackB=[]] Tracks traversed `b` objects.</span>
<span class="cm">   * @returns {Boolean} Returns `true`, if the values are equivalent, else `false`.</span>
<span class="cm">   * @example</span>
<span class="cm">   *</span>
<span class="cm">   * var moe = { &#39;name&#39;: &#39;moe&#39;, &#39;age&#39;: 40 };</span>
<span class="cm">   * var copy = { &#39;name&#39;: &#39;moe&#39;, &#39;age&#39;: 40 };</span>
<span class="cm">   *</span>
<span class="cm">   * moe == copy;</span>
<span class="cm">   * // =&gt; false</span>
<span class="cm">   *</span>
<span class="cm">   * _.isEqual(moe, copy);</span>
<span class="cm">   * // =&gt; true</span>
<span class="cm">   *</span>
<span class="cm">   * var words = [&#39;hello&#39;, &#39;goodbye&#39;];</span>
<span class="cm">   * var otherWords = [&#39;hi&#39;, &#39;goodbye&#39;];</span>
<span class="cm">   *</span>
<span class="cm">   * _.isEqual(words, otherWords, function(a, b) {</span>
<span class="cm">   *   var reGreet = /^(?:hello|hi)$/i,</span>
<span class="cm">   *       aGreet = _.isString(a) &amp;&amp; reGreet.test(a),</span>
<span class="cm">   *       bGreet = _.isString(b) &amp;&amp; reGreet.test(b);</span>
<span class="cm">   *</span>
<span class="cm">   *   return (aGreet || bGreet) ? (aGreet == bGreet) : undefined;</span>
<span class="cm">   * });</span>
<span class="cm">   * // =&gt; true</span>
<span class="cm">   */</span>
  <span class="kd">function</span> <span class="nx">isEqual</span><span class="p">(</span><span class="nx">a</span><span class="p">,</span> <span class="nx">b</span><span class="p">,</span> <span class="nx">callback</span><span class="p">,</span> <span class="nx">thisArg</span><span class="p">,</span> <span class="nx">stackA</span><span class="p">,</span> <span class="nx">stackB</span><span class="p">)</span> <span class="p">{</span></pre></div></div>
            
        </li>
        
           
        <li id="section-29">
            <div class="annotation">
              <div class="pilwrap">
                <a class="pilcrow" href="#section-29">&#182;</a>
              </div>            
              
<p>used to indicate that when comparing objects, <code>a</code> has at least the properties of <code>b</code></p>

            </div>
            
            <div class="content"><div class="highlight"><pre>    <span class="kd">var</span> <span class="nx">whereIndicator</span> <span class="o">=</span> <span class="nx">callback</span> <span class="o">===</span> <span class="nx">indicatorObject</span><span class="p">;</span>
    <span class="k">if</span> <span class="p">(</span><span class="k">typeof</span> <span class="nx">callback</span> <span class="o">==</span> <span class="s1">&#39;function&#39;</span> <span class="o">&amp;&amp;</span> <span class="o">!</span><span class="nx">whereIndicator</span><span class="p">)</span> <span class="p">{</span>
      <span class="nx">callback</span> <span class="o">=</span> <span class="nx">lodash</span><span class="p">.</span><span class="nx">createCallback</span><span class="p">(</span><span class="nx">callback</span><span class="p">,</span> <span class="nx">thisArg</span><span class="p">,</span> <span class="mi">2</span><span class="p">);</span>
      <span class="kd">var</span> <span class="nx">result</span> <span class="o">=</span> <span class="nx">callback</span><span class="p">(</span><span class="nx">a</span><span class="p">,</span> <span class="nx">b</span><span class="p">);</span>
      <span class="k">if</span> <span class="p">(</span><span class="k">typeof</span> <span class="nx">result</span> <span class="o">!=</span> <span class="s1">&#39;undefined&#39;</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">return</span> <span class="o">!!</span><span class="nx">result</span><span class="p">;</span>
      <span class="p">}</span>
    <span class="p">}</span></pre></div></div>
            
        </li>
        
           
        <li id="section-30">
            <div class="annotation">
              <div class="pilwrap">
                <a class="pilcrow" href="#section-30">&#182;</a>
              </div>            
              
<p>exit early for identical values</p>

            </div>
            
            <div class="content"><div class="highlight"><pre>    <span class="k">if</span> <span class="p">(</span><span class="nx">a</span> <span class="o">===</span> <span class="nx">b</span><span class="p">)</span> <span class="p">{</span></pre></div></div>
            
        </li>
        
           
        <li id="section-31">
            <div class="annotation">
              <div class="pilwrap">
                <a class="pilcrow" href="#section-31">&#182;</a>
              </div>            
              
<p>treat <code>+0</code> vs. <code>-0</code> as not equal</p>

            </div>
            
            <div class="content"><div class="highlight"><pre>      <span class="k">return</span> <span class="nx">a</span> <span class="o">!==</span> <span class="mi">0</span> <span class="o">||</span> <span class="p">(</span><span class="mi">1</span> <span class="o">/</span> <span class="nx">a</span> <span class="o">==</span> <span class="mi">1</span> <span class="o">/</span> <span class="nx">b</span><span class="p">);</span>
    <span class="p">}</span>
    <span class="kd">var</span> <span class="nx">type</span> <span class="o">=</span> <span class="k">typeof</span> <span class="nx">a</span><span class="p">,</span>
        <span class="nx">otherType</span> <span class="o">=</span> <span class="k">typeof</span> <span class="nx">b</span><span class="p">;</span></pre></div></div>
            
        </li>
        
           
        <li id="section-32">
            <div class="annotation">
              <div class="pilwrap">
                <a class="pilcrow" href="#section-32">&#182;</a>
              </div>            
              
<p>exit early for unlike primitive values</p>

            </div>
            
            <div class="content"><div class="highlight"><pre>    <span class="k">if</span> <span class="p">(</span><span class="nx">a</span> <span class="o">===</span> <span class="nx">a</span> <span class="o">&amp;&amp;</span>
        <span class="p">(</span><span class="o">!</span><span class="nx">a</span> <span class="o">||</span> <span class="p">(</span><span class="nx">type</span> <span class="o">!=</span> <span class="s1">&#39;function&#39;</span> <span class="o">&amp;&amp;</span> <span class="nx">type</span> <span class="o">!=</span> <span class="s1">&#39;object&#39;</span><span class="p">))</span> <span class="o">&amp;&amp;</span>
        <span class="p">(</span><span class="o">!</span><span class="nx">b</span> <span class="o">||</span> <span class="p">(</span><span class="nx">otherType</span> <span class="o">!=</span> <span class="s1">&#39;function&#39;</span> <span class="o">&amp;&amp;</span> <span class="nx">otherType</span> <span class="o">!=</span> <span class="s1">&#39;object&#39;</span><span class="p">)))</span> <span class="p">{</span>
      <span class="k">return</span> <span class="kc">false</span><span class="p">;</span>
    <span class="p">}</span></pre></div></div>
            
        </li>
        
           
        <li id="section-33">
            <div class="annotation">
              <div class="pilwrap">
                <a class="pilcrow" href="#section-33">&#182;</a>
              </div>            
              
<p>exit early for <code>null</code> and <code>undefined</code>, avoiding ES3&#39;s Function#call behavior
<a href="http://es5.github.com/#x15.3.4.4">http://es5.github.com/#x15.3.4.4</a></p>

            </div>
            
            <div class="content"><div class="highlight"><pre>    <span class="k">if</span> <span class="p">(</span><span class="nx">a</span> <span class="o">==</span> <span class="kc">null</span> <span class="o">||</span> <span class="nx">b</span> <span class="o">==</span> <span class="kc">null</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">return</span> <span class="nx">a</span> <span class="o">===</span> <span class="nx">b</span><span class="p">;</span>
    <span class="p">}</span></pre></div></div>
            
        </li>
        
           
        <li id="section-34">
            <div class="annotation">
              <div class="pilwrap">
                <a class="pilcrow" href="#section-34">&#182;</a>
              </div>            
              
<p>compare [[Class]] names</p>

            </div>
            
            <div class="content"><div class="highlight"><pre>    <span class="kd">var</span> <span class="nx">className</span> <span class="o">=</span> <span class="nx">toString</span><span class="p">.</span><span class="nx">call</span><span class="p">(</span><span class="nx">a</span><span class="p">),</span>
        <span class="nx">otherClass</span> <span class="o">=</span> <span class="nx">toString</span><span class="p">.</span><span class="nx">call</span><span class="p">(</span><span class="nx">b</span><span class="p">);</span>

    <span class="k">if</span> <span class="p">(</span><span class="nx">className</span> <span class="o">==</span> <span class="nx">argsClass</span><span class="p">)</span> <span class="p">{</span>
      <span class="nx">className</span> <span class="o">=</span> <span class="nx">objectClass</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">otherClass</span> <span class="o">==</span> <span class="nx">argsClass</span><span class="p">)</span> <span class="p">{</span>
      <span class="nx">otherClass</span> <span class="o">=</span> <span class="nx">objectClass</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">className</span> <span class="o">!=</span> <span class="nx">otherClass</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">return</span> <span class="kc">false</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="k">switch</span> <span class="p">(</span><span class="nx">className</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">case</span> <span class="nx">boolClass</span><span class="o">:</span>
      <span class="k">case</span> <span class="nx">dateClass</span><span class="o">:</span></pre></div></div>
            
        </li>
        
           
        <li id="section-35">
            <div class="annotation">
              <div class="pilwrap">
                <a class="pilcrow" href="#section-35">&#182;</a>
              </div>            
              
<p>coerce dates and booleans to numbers, dates to milliseconds and booleans
to <code>1</code> or <code>0</code>, treating invalid dates coerced to <code>NaN</code> as not equal</p>

            </div>
            
            <div class="content"><div class="highlight"><pre>        <span class="k">return</span> <span class="o">+</span><span class="nx">a</span> <span class="o">==</span> <span class="o">+</span><span class="nx">b</span><span class="p">;</span>

      <span class="k">case</span> <span class="nx">numberClass</span><span class="o">:</span></pre></div></div>
            
        </li>
        
           
        <li id="section-36">
            <div class="annotation">
              <div class="pilwrap">
                <a class="pilcrow" href="#section-36">&#182;</a>
              </div>            
              
<p>treat <code>NaN</code> vs. <code>NaN</code> as equal</p>

            </div>
            
            <div class="content"><div class="highlight"><pre>        <span class="k">return</span> <span class="p">(</span><span class="nx">a</span> <span class="o">!=</span> <span class="o">+</span><span class="nx">a</span><span class="p">)</span>
          <span class="o">?</span> <span class="nx">b</span> <span class="o">!=</span> <span class="o">+</span><span class="nx">b</span></pre></div></div>
            
        </li>
        
           
        <li id="section-37">
            <div class="annotation">
              <div class="pilwrap">
                <a class="pilcrow" href="#section-37">&#182;</a>
              </div>            
              
<p>but treat <code>+0</code> vs. <code>-0</code> as not equal</p>

            </div>
            
            <div class="content"><div class="highlight"><pre>          <span class="o">:</span> <span class="p">(</span><span class="nx">a</span> <span class="o">==</span> <span class="mi">0</span> <span class="o">?</span> <span class="p">(</span><span class="mi">1</span> <span class="o">/</span> <span class="nx">a</span> <span class="o">==</span> <span class="mi">1</span> <span class="o">/</span> <span class="nx">b</span><span class="p">)</span> <span class="o">:</span> <span class="nx">a</span> <span class="o">==</span> <span class="o">+</span><span class="nx">b</span><span class="p">);</span>

      <span class="k">case</span> <span class="nx">regexpClass</span><span class="o">:</span>
      <span class="k">case</span> <span class="nx">stringClass</span><span class="o">:</span></pre></div></div>
            
        </li>
        
           
        <li id="section-38">
            <div class="annotation">
              <div class="pilwrap">
                <a class="pilcrow" href="#section-38">&#182;</a>
              </div>            
              
<p>coerce regexes to strings (<a href="http://es5.github.com/#x15.10.6.4">http://es5.github.com/#x15.10.6.4</a>)
treat string primitives and their corresponding object instances as equal</p>

            </div>
            
            <div class="content"><div class="highlight"><pre>        <span class="k">return</span> <span class="nx">a</span> <span class="o">==</span> <span class="nb">String</span><span class="p">(</span><span class="nx">b</span><span class="p">);</span>
    <span class="p">}</span>
    <span class="kd">var</span> <span class="nx">isArr</span> <span class="o">=</span> <span class="nx">className</span> <span class="o">==</span> <span class="nx">arrayClass</span><span class="p">;</span>
    <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">isArr</span><span class="p">)</span> <span class="p">{</span></pre></div></div>
            
        </li>
        
           
        <li id="section-39">
            <div class="annotation">
              <div class="pilwrap">
                <a class="pilcrow" href="#section-39">&#182;</a>
              </div>            
              
<p>unwrap any <code>lodash</code> wrapped values</p>

            </div>
            
            <div class="content"><div class="highlight"><pre>      <span class="k">if</span> <span class="p">(</span><span class="nx">hasOwnProperty</span><span class="p">.</span><span class="nx">call</span><span class="p">(</span><span class="nx">a</span><span class="p">,</span> <span class="s1">&#39;__wrapped__ &#39;</span><span class="p">)</span> <span class="o">||</span> <span class="nx">hasOwnProperty</span><span class="p">.</span><span class="nx">call</span><span class="p">(</span><span class="nx">b</span><span class="p">,</span> <span class="s1">&#39;__wrapped__&#39;</span><span class="p">))</span> <span class="p">{</span>
        <span class="k">return</span> <span class="nx">isEqual</span><span class="p">(</span><span class="nx">a</span><span class="p">.</span><span class="nx">__wrapped__</span> <span class="o">||</span> <span class="nx">a</span><span class="p">,</span> <span class="nx">b</span><span class="p">.</span><span class="nx">__wrapped__</span> <span class="o">||</span> <span class="nx">b</span><span class="p">,</span> <span class="nx">callback</span><span class="p">,</span> <span class="nx">thisArg</span><span class="p">,</span> <span class="nx">stackA</span><span class="p">,</span> <span class="nx">stackB</span><span class="p">);</span>
      <span class="p">}</span></pre></div></div>
            
        </li>
        
           
        <li id="section-40">
            <div class="annotation">
              <div class="pilwrap">
                <a class="pilcrow" href="#section-40">&#182;</a>
              </div>            
              
<p>exit for functions and DOM nodes</p>

            </div>
            
            <div class="content"><div class="highlight"><pre>      <span class="k">if</span> <span class="p">(</span><span class="nx">className</span> <span class="o">!=</span> <span class="nx">objectClass</span> <span class="o">||</span> <span class="p">(</span><span class="o">!</span><span class="nx">support</span><span class="p">.</span><span class="nx">nodeClass</span> <span class="o">&amp;&amp;</span> <span class="p">(</span><span class="nx">isNode</span><span class="p">(</span><span class="nx">a</span><span class="p">)</span> <span class="o">||</span> <span class="nx">isNode</span><span class="p">(</span><span class="nx">b</span><span class="p">))))</span> <span class="p">{</span>
        <span class="k">return</span> <span class="kc">false</span><span class="p">;</span>
      <span class="p">}</span></pre></div></div>
            
        </li>
        
           
        <li id="section-41">
            <div class="annotation">
              <div class="pilwrap">
                <a class="pilcrow" href="#section-41">&#182;</a>
              </div>            
              
<p>in older versions of Opera, <code>arguments</code> objects have <code>Array</code> constructors</p>

            </div>
            
            <div class="content"><div class="highlight"><pre>      <span class="kd">var</span> <span class="nx">ctorA</span> <span class="o">=</span> <span class="o">!</span><span class="nx">support</span><span class="p">.</span><span class="nx">argsObject</span> <span class="o">&amp;&amp;</span> <span class="nx">isArguments</span><span class="p">(</span><span class="nx">a</span><span class="p">)</span> <span class="o">?</span> <span class="nb">Object</span> <span class="o">:</span> <span class="nx">a</span><span class="p">.</span><span class="nx">constructor</span><span class="p">,</span>
          <span class="nx">ctorB</span> <span class="o">=</span> <span class="o">!</span><span class="nx">support</span><span class="p">.</span><span class="nx">argsObject</span> <span class="o">&amp;&amp;</span> <span class="nx">isArguments</span><span class="p">(</span><span class="nx">b</span><span class="p">)</span> <span class="o">?</span> <span class="nb">Object</span> <span class="o">:</span> <span class="nx">b</span><span class="p">.</span><span class="nx">constructor</span><span class="p">;</span></pre></div></div>
            
        </li>
        
           
        <li id="section-42">
            <div class="annotation">
              <div class="pilwrap">
                <a class="pilcrow" href="#section-42">&#182;</a>
              </div>            
              
<p>non <code>Object</code> object instances with different constructors are not equal</p>

            </div>
            
            <div class="content"><div class="highlight"><pre>      <span class="k">if</span> <span class="p">(</span><span class="nx">ctorA</span> <span class="o">!=</span> <span class="nx">ctorB</span> <span class="o">&amp;&amp;</span> <span class="o">!</span><span class="p">(</span>
            <span class="nx">isFunction</span><span class="p">(</span><span class="nx">ctorA</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="nx">ctorA</span> <span class="k">instanceof</span> <span class="nx">ctorA</span> <span class="o">&amp;&amp;</span>
            <span class="nx">isFunction</span><span class="p">(</span><span class="nx">ctorB</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="nx">ctorB</span> <span class="k">instanceof</span> <span class="nx">ctorB</span>
          <span class="p">))</span> <span class="p">{</span>
        <span class="k">return</span> <span class="kc">false</span><span class="p">;</span>
      <span class="p">}</span>
    <span class="p">}</span></pre></div></div>
            
        </li>
        
           
        <li id="section-43">
            <div class="annotation">
              <div class="pilwrap">
                <a class="pilcrow" href="#section-43">&#182;</a>
              </div>            
              
<p>assume cyclic structures are equal
the algorithm for detecting cyclic structures is adapted from ES 5.1
section 15.12.3, abstract operation <code>JO</code> (<a href="http://es5.github.com/#x15.12.3">http://es5.github.com/#x15.12.3</a>)</p>

            </div>
            
            <div class="content"><div class="highlight"><pre>    <span class="nx">stackA</span> <span class="o">||</span> <span class="p">(</span><span class="nx">stackA</span> <span class="o">=</span> <span class="p">[]);</span>
    <span class="nx">stackB</span> <span class="o">||</span> <span class="p">(</span><span class="nx">stackB</span> <span class="o">=</span> <span class="p">[]);</span>

    <span class="kd">var</span> <span class="nx">length</span> <span class="o">=</span> <span class="nx">stackA</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span>
    <span class="k">while</span> <span class="p">(</span><span class="nx">length</span><span class="o">--</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">if</span> <span class="p">(</span><span class="nx">stackA</span><span class="p">[</span><span class="nx">length</span><span class="p">]</span> <span class="o">==</span> <span class="nx">a</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">return</span> <span class="nx">stackB</span><span class="p">[</span><span class="nx">length</span><span class="p">]</span> <span class="o">==</span> <span class="nx">b</span><span class="p">;</span>
      <span class="p">}</span>
    <span class="p">}</span>
    <span class="kd">var</span> <span class="nx">size</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
    <span class="nx">result</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span></pre></div></div>
            
        </li>
        
           
        <li id="section-44">
            <div class="annotation">
              <div class="pilwrap">
                <a class="pilcrow" href="#section-44">&#182;</a>
              </div>            
              
<p>add <code>a</code> and <code>b</code> to the stack of traversed objects</p>

            </div>
            
            <div class="content"><div class="highlight"><pre>    <span class="nx">stackA</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nx">a</span><span class="p">);</span>
    <span class="nx">stackB</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nx">b</span><span class="p">);</span></pre></div></div>
            
        </li>
        
           
        <li id="section-45">
            <div class="annotation">
              <div class="pilwrap">
                <a class="pilcrow" href="#section-45">&#182;</a>
              </div>            
              
<p>recursively compare objects and arrays (susceptible to call stack limits)</p>

            </div>
            
            <div class="content"><div class="highlight"><pre>    <span class="k">if</span> <span class="p">(</span><span class="nx">isArr</span><span class="p">)</span> <span class="p">{</span>
      <span class="nx">length</span> <span class="o">=</span> <span class="nx">a</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span>
      <span class="nx">size</span> <span class="o">=</span> <span class="nx">b</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span></pre></div></div>
            
        </li>
        
           
        <li id="section-46">
            <div class="annotation">
              <div class="pilwrap">
                <a class="pilcrow" href="#section-46">&#182;</a>
              </div>            
              
<p>compare lengths to determine if a deep comparison is necessary</p>

            </div>
            
            <div class="content"><div class="highlight"><pre>      <span class="nx">result</span> <span class="o">=</span> <span class="nx">size</span> <span class="o">==</span> <span class="nx">a</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span>
      <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">result</span> <span class="o">&amp;&amp;</span> <span class="o">!</span><span class="nx">whereIndicator</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">return</span> <span class="nx">result</span><span class="p">;</span>
      <span class="p">}</span></pre></div></div>
            
        </li>
        
           
        <li id="section-47">
            <div class="annotation">
              <div class="pilwrap">
                <a class="pilcrow" href="#section-47">&#182;</a>
              </div>            
              
<p>deep compare the contents, ignoring non-numeric properties</p>

            </div>
            
            <div class="content"><div class="highlight"><pre>      <span class="k">while</span> <span class="p">(</span><span class="nx">size</span><span class="o">--</span><span class="p">)</span> <span class="p">{</span>
        <span class="kd">var</span> <span class="nx">index</span> <span class="o">=</span> <span class="nx">length</span><span class="p">,</span>
            <span class="nx">value</span> <span class="o">=</span> <span class="nx">b</span><span class="p">[</span><span class="nx">size</span><span class="p">];</span>

        <span class="k">if</span> <span class="p">(</span><span class="nx">whereIndicator</span><span class="p">)</span> <span class="p">{</span>
          <span class="k">while</span> <span class="p">(</span><span class="nx">index</span><span class="o">--</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">if</span> <span class="p">((</span><span class="nx">result</span> <span class="o">=</span> <span class="nx">isEqual</span><span class="p">(</span><span class="nx">a</span><span class="p">[</span><span class="nx">index</span><span class="p">],</span> <span class="nx">value</span><span class="p">,</span> <span class="nx">callback</span><span class="p">,</span> <span class="nx">thisArg</span><span class="p">,</span> <span class="nx">stackA</span><span class="p">,</span> <span class="nx">stackB</span><span class="p">)))</span> <span class="p">{</span>
              <span class="k">break</span><span class="p">;</span>
            <span class="p">}</span>
          <span class="p">}</span>
        <span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="p">(</span><span class="nx">result</span> <span class="o">=</span> <span class="nx">isEqual</span><span class="p">(</span><span class="nx">a</span><span class="p">[</span><span class="nx">size</span><span class="p">],</span> <span class="nx">value</span><span class="p">,</span> <span class="nx">callback</span><span class="p">,</span> <span class="nx">thisArg</span><span class="p">,</span> <span class="nx">stackA</span><span class="p">,</span> <span class="nx">stackB</span><span class="p">)))</span> <span class="p">{</span>
          <span class="k">break</span><span class="p">;</span>
        <span class="p">}</span>
      <span class="p">}</span>
      <span class="k">return</span> <span class="nx">result</span><span class="p">;</span>
    <span class="p">}</span></pre></div></div>
            
        </li>
        
           
        <li id="section-48">
            <div class="annotation">
              <div class="pilwrap">
                <a class="pilcrow" href="#section-48">&#182;</a>
              </div>            
              
<p>deep compare objects using <code>forIn</code>, instead of <code>forOwn</code>, to avoid <code>Object.keys</code>
which, in this case, is more costly</p>

            </div>
            
            <div class="content"><div class="highlight"><pre>    <span class="nx">forIn</span><span class="p">(</span><span class="nx">b</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">value</span><span class="p">,</span> <span class="nx">key</span><span class="p">,</span> <span class="nx">b</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">if</span> <span class="p">(</span><span class="nx">hasOwnProperty</span><span class="p">.</span><span class="nx">call</span><span class="p">(</span><span class="nx">b</span><span class="p">,</span> <span class="nx">key</span><span class="p">))</span> <span class="p">{</span></pre></div></div>
            
        </li>
        
           
        <li id="section-49">
            <div class="annotation">
              <div class="pilwrap">
                <a class="pilcrow" href="#section-49">&#182;</a>
              </div>            
              
<p>count the number of properties.</p>

            </div>
            
            <div class="content"><div class="highlight"><pre>        <span class="nx">size</span><span class="o">++</span><span class="p">;</span></pre></div></div>
            
        </li>
        
           
        <li id="section-50">
            <div class="annotation">
              <div class="pilwrap">
                <a class="pilcrow" href="#section-50">&#182;</a>
              </div>            
              
<p>deep compare each property value.</p>

            </div>
            
            <div class="content"><div class="highlight"><pre>        <span class="k">return</span> <span class="p">(</span><span class="nx">result</span> <span class="o">=</span> <span class="nx">hasOwnProperty</span><span class="p">.</span><span class="nx">call</span><span class="p">(</span><span class="nx">a</span><span class="p">,</span> <span class="nx">key</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="nx">isEqual</span><span class="p">(</span><span class="nx">a</span><span class="p">[</span><span class="nx">key</span><span class="p">],</span> <span class="nx">value</span><span class="p">,</span> <span class="nx">callback</span><span class="p">,</span> <span class="nx">thisArg</span><span class="p">,</span> <span class="nx">stackA</span><span class="p">,</span> <span class="nx">stackB</span><span class="p">));</span>
      <span class="p">}</span>
    <span class="p">});</span>

    <span class="k">if</span> <span class="p">(</span><span class="nx">result</span> <span class="o">&amp;&amp;</span> <span class="o">!</span><span class="nx">whereIndicator</span><span class="p">)</span> <span class="p">{</span></pre></div></div>
            
        </li>
        
           
        <li id="section-51">
            <div class="annotation">
              <div class="pilwrap">
                <a class="pilcrow" href="#section-51">&#182;</a>
              </div>            
              
<p>ensure both objects have the same number of properties</p>

            </div>
            
            <div class="content"><div class="highlight"><pre>      <span class="nx">forIn</span><span class="p">(</span><span class="nx">a</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">value</span><span class="p">,</span> <span class="nx">key</span><span class="p">,</span> <span class="nx">a</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="nx">hasOwnProperty</span><span class="p">.</span><span class="nx">call</span><span class="p">(</span><span class="nx">a</span><span class="p">,</span> <span class="nx">key</span><span class="p">))</span> <span class="p">{</span></pre></div></div>
            
        </li>
        
           
        <li id="section-52">
            <div class="annotation">
              <div class="pilwrap">
                <a class="pilcrow" href="#section-52">&#182;</a>
              </div>            
              
<p><code>size</code> will be <code>-1</code> if <code>a</code> has more properties than <code>b</code></p>

            </div>
            
            <div class="content"><div class="highlight"><pre>          <span class="k">return</span> <span class="p">(</span><span class="nx">result</span> <span class="o">=</span> <span class="o">--</span><span class="nx">size</span> <span class="o">&gt;</span> <span class="o">-</span><span class="mi">1</span><span class="p">);</span>
        <span class="p">}</span>
      <span class="p">});</span>
    <span class="p">}</span>
    <span class="k">return</span> <span class="nx">result</span><span class="p">;</span>
  <span class="p">}</span>

  <span class="cm">/**</span>
<span class="cm">   * Checks if `value` is a function.</span>
<span class="cm">   *</span>
<span class="cm">   * @static</span>
<span class="cm">   * @memberOf _</span>
<span class="cm">   * @category Objects</span>
<span class="cm">   * @param {Mixed} value The value to check.</span>
<span class="cm">   * @returns {Boolean} Returns `true`, if the `value` is a function, else `false`.</span>
<span class="cm">   * @example</span>
<span class="cm">   *</span>
<span class="cm">   * _.isFunction(_);</span>
<span class="cm">   * // =&gt; true</span>
<span class="cm">   */</span>
  <span class="kd">function</span> <span class="nx">isFunction</span><span class="p">(</span><span class="nx">value</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="k">typeof</span> <span class="nx">value</span> <span class="o">==</span> <span class="s1">&#39;function&#39;</span><span class="p">;</span>
  <span class="p">}</span></pre></div></div>
            
        </li>
        
           
        <li id="section-53">
            <div class="annotation">
              <div class="pilwrap">
                <a class="pilcrow" href="#section-53">&#182;</a>
              </div>            
              
<p>fallback for older versions of Chrome and Safari</p>

            </div>
            
            <div class="content"><div class="highlight"><pre>  <span class="k">if</span> <span class="p">(</span><span class="nx">isFunction</span><span class="p">(</span><span class="sr">/x/</span><span class="p">))</span> <span class="p">{</span>
    <span class="nx">isFunction</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">value</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">return</span> <span class="k">typeof</span> <span class="nx">value</span> <span class="o">==</span> <span class="s1">&#39;function&#39;</span> <span class="o">&amp;&amp;</span> <span class="nx">toString</span><span class="p">.</span><span class="nx">call</span><span class="p">(</span><span class="nx">value</span><span class="p">)</span> <span class="o">==</span> <span class="nx">funcClass</span><span class="p">;</span>
    <span class="p">};</span>
  <span class="p">}</span>

  <span class="cm">/**</span>
<span class="cm">   * Checks if `value` is the language type of Object.</span>
<span class="cm">   * (e.g. arrays, functions, objects, regexes, `new Number(0)`, and `new String(&#39;&#39;)`)</span>
<span class="cm">   *</span>
<span class="cm">   * @static</span>
<span class="cm">   * @memberOf _</span>
<span class="cm">   * @category Objects</span>
<span class="cm">   * @param {Mixed} value The value to check.</span>
<span class="cm">   * @returns {Boolean} Returns `true`, if the `value` is an object, else `false`.</span>
<span class="cm">   * @example</span>
<span class="cm">   *</span>
<span class="cm">   * _.isObject({});</span>
<span class="cm">   * // =&gt; true</span>
<span class="cm">   *</span>
<span class="cm">   * _.isObject([1, 2, 3]);</span>
<span class="cm">   * // =&gt; true</span>
<span class="cm">   *</span>
<span class="cm">   * _.isObject(1);</span>
<span class="cm">   * // =&gt; false</span>
<span class="cm">   */</span>
  <span class="kd">function</span> <span class="nx">isObject</span><span class="p">(</span><span class="nx">value</span><span class="p">)</span> <span class="p">{</span></pre></div></div>
            
        </li>
        
           
        <li id="section-54">
            <div class="annotation">
              <div class="pilwrap">
                <a class="pilcrow" href="#section-54">&#182;</a>
              </div>            
              
<p>check if the value is the ECMAScript language type of Object
<a href="http://es5.github.com/#x8">http://es5.github.com/#x8</a>
and avoid a V8 bug
<a href="http://code.google.com/p/v8/issues/detail?id=2291">http://code.google.com/p/v8/issues/detail?id=2291</a></p>

            </div>
            
            <div class="content"><div class="highlight"><pre>    <span class="k">return</span> <span class="nx">value</span> <span class="o">?</span> <span class="nx">objectTypes</span><span class="p">[</span><span class="k">typeof</span> <span class="nx">value</span><span class="p">]</span> <span class="o">:</span> <span class="kc">false</span><span class="p">;</span>
  <span class="p">}</span>

  <span class="cm">/**</span>
<span class="cm">   * Creates an array composed of the own enumerable property values of `object`.</span>
<span class="cm">   *</span>
<span class="cm">   * @static</span>
<span class="cm">   * @memberOf _</span>
<span class="cm">   * @category Objects</span>
<span class="cm">   * @param {Object} object The object to inspect.</span>
<span class="cm">   * @returns {Array} Returns a new array of property values.</span>
<span class="cm">   * @example</span>
<span class="cm">   *</span>
<span class="cm">   * _.values({ &#39;one&#39;: 1, &#39;two&#39;: 2, &#39;three&#39;: 3 });</span>
<span class="cm">   * // =&gt; [1, 2, 3] (order is not guaranteed)</span>
<span class="cm">   */</span>
  <span class="kd">function</span> <span class="nx">values</span><span class="p">(</span><span class="nx">object</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">index</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span>
        <span class="nx">props</span> <span class="o">=</span> <span class="nx">keys</span><span class="p">(</span><span class="nx">object</span><span class="p">),</span>
        <span class="nx">length</span> <span class="o">=</span> <span class="nx">props</span><span class="p">.</span><span class="nx">length</span><span class="p">,</span>
        <span class="nx">result</span> <span class="o">=</span> <span class="nb">Array</span><span class="p">(</span><span class="nx">length</span><span class="p">);</span>

    <span class="k">while</span> <span class="p">(</span><span class="o">++</span><span class="nx">index</span> <span class="o">&lt;</span> <span class="nx">length</span><span class="p">)</span> <span class="p">{</span>
      <span class="nx">result</span><span class="p">[</span><span class="nx">index</span><span class="p">]</span> <span class="o">=</span> <span class="nx">object</span><span class="p">[</span><span class="nx">props</span><span class="p">[</span><span class="nx">index</span><span class="p">]];</span>
    <span class="p">}</span>
    <span class="k">return</span> <span class="nx">result</span><span class="p">;</span>
  <span class="p">}</span>

  <span class="cm">/*--------------------------------------------------------------------------*/</span>

  <span class="cm">/**</span>
<span class="cm">   * Produces a callback bound to an optional `thisArg`. If `func` is a property</span>
<span class="cm">   * name, the created callback will return the property value for a given element.</span>
<span class="cm">   * If `func` is an object, the created callback will return `true` for elements</span>
<span class="cm">   * that contain the equivalent object properties, otherwise it will return `false`.</span>
<span class="cm">   *</span>
<span class="cm">   * Note: All Lo-Dash methods, that accept a `callback` argument, use `_.createCallback`.</span>
<span class="cm">   *</span>
<span class="cm">   * @static</span>
<span class="cm">   * @memberOf _</span>
<span class="cm">   * @category Functions</span>
<span class="cm">   * @param {Mixed} [func=identity] The value to convert to a callback.</span>
<span class="cm">   * @param {Mixed} [thisArg] The `this` binding of the created callback.</span>
<span class="cm">   * @param {Number} [argCount=3] The number of arguments the callback accepts.</span>
<span class="cm">   * @returns {Function} Returns a callback function.</span>
<span class="cm">   * @example</span>
<span class="cm">   *</span>
<span class="cm">   * var stooges = [</span>
<span class="cm">   *   { &#39;name&#39;: &#39;moe&#39;, &#39;age&#39;: 40 },</span>
<span class="cm">   *   { &#39;name&#39;: &#39;larry&#39;, &#39;age&#39;: 50 }</span>
<span class="cm">   * ];</span>
<span class="cm">   *</span>
<span class="cm">   * // wrap to create custom callback shorthands</span>
<span class="cm">   * _.createCallback = _.wrap(_.createCallback, function(func, callback, thisArg) {</span>
<span class="cm">   *   var match = /^(.+?)__([gl]t)(.+)$/.exec(callback);</span>
<span class="cm">   *   return !match ? func(callback, thisArg) : function(object) {</span>
<span class="cm">   *     return match[2] == &#39;gt&#39; ? object[match[1]] &gt; match[3] : object[match[1]] &lt; match[3];</span>
<span class="cm">   *   };</span>
<span class="cm">   * });</span>
<span class="cm">   *</span>
<span class="cm">   * _.filter(stooges, &#39;age__gt45&#39;);</span>
<span class="cm">   * // =&gt; [{ &#39;name&#39;: &#39;larry&#39;, &#39;age&#39;: 50 }]</span>
<span class="cm">   *</span>
<span class="cm">   * // create mixins with support for &quot;_.pluck&quot; and &quot;_.where&quot; callback shorthands</span>
<span class="cm">   * _.mixin({</span>
<span class="cm">   *   &#39;toLookup&#39;: function(collection, callback, thisArg) {</span>
<span class="cm">   *     callback = _.createCallback(callback, thisArg);</span>
<span class="cm">   *     return _.reduce(collection, function(result, value, index, collection) {</span>
<span class="cm">   *       return (result[callback(value, index, collection)] = value, result);</span>
<span class="cm">   *     }, {});</span>
<span class="cm">   *   }</span>
<span class="cm">   * });</span>
<span class="cm">   *</span>
<span class="cm">   * _.toLookup(stooges, &#39;name&#39;);</span>
<span class="cm">   * // =&gt; { &#39;moe&#39;: { &#39;name&#39;: &#39;moe&#39;, &#39;age&#39;: 40 }, &#39;larry&#39;: { &#39;name&#39;: &#39;larry&#39;, &#39;age&#39;: 50 } }</span>
<span class="cm">   */</span>
  <span class="kd">function</span> <span class="nx">createCallback</span><span class="p">(</span><span class="nx">func</span><span class="p">,</span> <span class="nx">thisArg</span><span class="p">,</span> <span class="nx">argCount</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">func</span> <span class="o">==</span> <span class="kc">null</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">return</span> <span class="nx">identity</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="kd">var</span> <span class="nx">type</span> <span class="o">=</span> <span class="k">typeof</span> <span class="nx">func</span><span class="p">;</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">type</span> <span class="o">!=</span> <span class="s1">&#39;function&#39;</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">if</span> <span class="p">(</span><span class="nx">type</span> <span class="o">!=</span> <span class="s1">&#39;object&#39;</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">return</span> <span class="kd">function</span><span class="p">(</span><span class="nx">object</span><span class="p">)</span> <span class="p">{</span>
          <span class="k">return</span> <span class="nx">object</span><span class="p">[</span><span class="nx">func</span><span class="p">];</span>
        <span class="p">};</span>
      <span class="p">}</span>
      <span class="kd">var</span> <span class="nx">props</span> <span class="o">=</span> <span class="nx">keys</span><span class="p">(</span><span class="nx">func</span><span class="p">);</span>
      <span class="k">return</span> <span class="kd">function</span><span class="p">(</span><span class="nx">object</span><span class="p">)</span> <span class="p">{</span>
        <span class="kd">var</span> <span class="nx">length</span> <span class="o">=</span> <span class="nx">props</span><span class="p">.</span><span class="nx">length</span><span class="p">,</span>
            <span class="nx">result</span> <span class="o">=</span> <span class="kc">false</span><span class="p">;</span>
        <span class="k">while</span> <span class="p">(</span><span class="nx">length</span><span class="o">--</span><span class="p">)</span> <span class="p">{</span>
          <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="p">(</span><span class="nx">result</span> <span class="o">=</span> <span class="nx">isEqual</span><span class="p">(</span><span class="nx">object</span><span class="p">[</span><span class="nx">props</span><span class="p">[</span><span class="nx">length</span><span class="p">]],</span> <span class="nx">func</span><span class="p">[</span><span class="nx">props</span><span class="p">[</span><span class="nx">length</span><span class="p">]],</span> <span class="nx">indicatorObject</span><span class="p">)))</span> <span class="p">{</span>
            <span class="k">break</span><span class="p">;</span>
          <span class="p">}</span>
        <span class="p">}</span>
        <span class="k">return</span> <span class="nx">result</span><span class="p">;</span>
      <span class="p">};</span>
    <span class="p">}</span>
    <span class="k">if</span> <span class="p">(</span><span class="k">typeof</span> <span class="nx">thisArg</span> <span class="o">!=</span> <span class="s1">&#39;undefined&#39;</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">if</span> <span class="p">(</span><span class="nx">argCount</span> <span class="o">===</span> <span class="mi">1</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">return</span> <span class="kd">function</span><span class="p">(</span><span class="nx">value</span><span class="p">)</span> <span class="p">{</span>
          <span class="k">return</span> <span class="nx">func</span><span class="p">.</span><span class="nx">call</span><span class="p">(</span><span class="nx">thisArg</span><span class="p">,</span> <span class="nx">value</span><span class="p">);</span>
        <span class="p">};</span>
      <span class="p">}</span>
      <span class="k">if</span> <span class="p">(</span><span class="nx">argCount</span> <span class="o">===</span> <span class="mi">2</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">return</span> <span class="kd">function</span><span class="p">(</span><span class="nx">a</span><span class="p">,</span> <span class="nx">b</span><span class="p">)</span> <span class="p">{</span>
          <span class="k">return</span> <span class="nx">func</span><span class="p">.</span><span class="nx">call</span><span class="p">(</span><span class="nx">thisArg</span><span class="p">,</span> <span class="nx">a</span><span class="p">,</span> <span class="nx">b</span><span class="p">);</span>
        <span class="p">};</span>
      <span class="p">}</span>
      <span class="k">if</span> <span class="p">(</span><span class="nx">argCount</span> <span class="o">===</span> <span class="mi">4</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">return</span> <span class="kd">function</span><span class="p">(</span><span class="nx">accumulator</span><span class="p">,</span> <span class="nx">value</span><span class="p">,</span> <span class="nx">index</span><span class="p">,</span> <span class="nx">collection</span><span class="p">)</span> <span class="p">{</span>
          <span class="k">return</span> <span class="nx">func</span><span class="p">.</span><span class="nx">call</span><span class="p">(</span><span class="nx">thisArg</span><span class="p">,</span> <span class="nx">accumulator</span><span class="p">,</span> <span class="nx">value</span><span class="p">,</span> <span class="nx">index</span><span class="p">,</span> <span class="nx">collection</span><span class="p">);</span>
        <span class="p">};</span>
      <span class="p">}</span>
      <span class="k">return</span> <span class="kd">function</span><span class="p">(</span><span class="nx">value</span><span class="p">,</span> <span class="nx">index</span><span class="p">,</span> <span class="nx">collection</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">return</span> <span class="nx">func</span><span class="p">.</span><span class="nx">call</span><span class="p">(</span><span class="nx">thisArg</span><span class="p">,</span> <span class="nx">value</span><span class="p">,</span> <span class="nx">index</span><span class="p">,</span> <span class="nx">collection</span><span class="p">);</span>
      <span class="p">};</span>
    <span class="p">}</span>
    <span class="k">return</span> <span class="nx">func</span><span class="p">;</span>
  <span class="p">}</span>

  <span class="cm">/*--------------------------------------------------------------------------*/</span>

  <span class="cm">/**</span>
<span class="cm">   * Converts the characters `&amp;`, `&lt;`, `&gt;`, `&quot;`, and `&#39;` in `string` to their</span>
<span class="cm">   * corresponding HTML entities.</span>
<span class="cm">   *</span>
<span class="cm">   * @static</span>
<span class="cm">   * @memberOf _</span>
<span class="cm">   * @category Utilities</span>
<span class="cm">   * @param {String} string The string to escape.</span>
<span class="cm">   * @returns {String} Returns the escaped string.</span>
<span class="cm">   * @example</span>
<span class="cm">   *</span>
<span class="cm">   * _.escape(&#39;Moe, Larry &amp; Curly&#39;);</span>
<span class="cm">   * // =&gt; &#39;Moe, Larry &amp;amp; Curly&#39;</span>
<span class="cm">   */</span>
  <span class="kd">function</span> <span class="nx">escape</span><span class="p">(</span><span class="nx">string</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="nx">string</span> <span class="o">==</span> <span class="kc">null</span> <span class="o">?</span> <span class="s1">&#39;&#39;</span> <span class="o">:</span> <span class="nb">String</span><span class="p">(</span><span class="nx">string</span><span class="p">).</span><span class="nx">replace</span><span class="p">(</span><span class="nx">reUnescapedHtml</span><span class="p">,</span> <span class="nx">escapeHtmlChar</span><span class="p">);</span>
  <span class="p">}</span>

  <span class="cm">/**</span>
<span class="cm">   * This function returns the first argument passed to it.</span>
<span class="cm">   *</span>
<span class="cm">   * @static</span>
<span class="cm">   * @memberOf _</span>
<span class="cm">   * @category Utilities</span>
<span class="cm">   * @param {Mixed} value Any value.</span>
<span class="cm">   * @returns {Mixed} Returns `value`.</span>
<span class="cm">   * @example</span>
<span class="cm">   *</span>
<span class="cm">   * var moe = { &#39;name&#39;: &#39;moe&#39; };</span>
<span class="cm">   * moe === _.identity(moe);</span>
<span class="cm">   * // =&gt; true</span>
<span class="cm">   */</span>
  <span class="kd">function</span> <span class="nx">identity</span><span class="p">(</span><span class="nx">value</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="nx">value</span><span class="p">;</span>
  <span class="p">}</span>

  <span class="cm">/**</span>
<span class="cm">   * A micro-templating method that handles arbitrary delimiters, preserves</span>
<span class="cm">   * whitespace, and correctly escapes quotes within interpolated code.</span>
<span class="cm">   *</span>
<span class="cm">   * Note: In the development build, `_.template` utilizes sourceURLs for easier</span>
<span class="cm">   * debugging. See http://www.html5rocks.com/en/tutorials/developertools/sourcemaps/#toc-sourceurl</span>
<span class="cm">   *</span>
<span class="cm">   * For more information on precompiling templates see:</span>
<span class="cm">   * http://lodash.com/#custom-builds</span>
<span class="cm">   *</span>
<span class="cm">   * For more information on Chrome extension sandboxes see:</span>
<span class="cm">   * http://developer.chrome.com/stable/extensions/sandboxingEval.html</span>
<span class="cm">   *</span>
<span class="cm">   * @static</span>
<span class="cm">   * @memberOf _</span>
<span class="cm">   * @category Utilities</span>
<span class="cm">   * @param {String} text The template text.</span>
<span class="cm">   * @param {Object} data The data object used to populate the text.</span>
<span class="cm">   * @param {Object} options The options object.</span>
<span class="cm">   *  escape - The &quot;escape&quot; delimiter regexp.</span>
<span class="cm">   *  evaluate - The &quot;evaluate&quot; delimiter regexp.</span>
<span class="cm">   *  interpolate - The &quot;interpolate&quot; delimiter regexp.</span>
<span class="cm">   *  sourceURL - The sourceURL of the template&#39;s compiled source.</span>
<span class="cm">   *  variable - The data object variable name.</span>
<span class="cm">   * @returns {Function|String} Returns a compiled function when no `data` object</span>
<span class="cm">   *  is given, else it returns the interpolated text.</span>
<span class="cm">   * @example</span>
<span class="cm">   *</span>
<span class="cm">   * // using a compiled template</span>
<span class="cm">   * var compiled = _.template(&#39;hello &lt;%= name %&gt;&#39;);</span>
<span class="cm">   * compiled({ &#39;name&#39;: &#39;moe&#39; });</span>
<span class="cm">   * // =&gt; &#39;hello moe&#39;</span>
<span class="cm">   *</span>
<span class="cm">   * var list = &#39;&lt;% _.forEach(people, function(name) { %&gt;&lt;li&gt;&lt;%= name %&gt;&lt;/li&gt;&lt;% }); %&gt;&#39;;</span>
<span class="cm">   * _.template(list, { &#39;people&#39;: [&#39;moe&#39;, &#39;larry&#39;] });</span>
<span class="cm">   * // =&gt; &#39;&lt;li&gt;moe&lt;/li&gt;&lt;li&gt;larry&lt;/li&gt;&#39;</span>
<span class="cm">   *</span>
<span class="cm">   * // using the &quot;escape&quot; delimiter to escape HTML in data property values</span>
<span class="cm">   * _.template(&#39;&lt;b&gt;&lt;%- value %&gt;&lt;/b&gt;&#39;, { &#39;value&#39;: &#39;&lt;script&gt;&#39; });</span>
<span class="cm">   * // =&gt; &#39;&lt;b&gt;&amp;lt;script&amp;gt;&lt;/b&gt;&#39;</span>
<span class="cm">   *</span>
<span class="cm">   * // using the ES6 delimiter as an alternative to the default &quot;interpolate&quot; delimiter</span>
<span class="cm">   * _.template(&#39;hello ${ name }&#39;, { &#39;name&#39;: &#39;curly&#39; });</span>
<span class="cm">   * // =&gt; &#39;hello curly&#39;</span>
<span class="cm">   *</span>
<span class="cm">   * // using the internal `print` function in &quot;evaluate&quot; delimiters</span>
<span class="cm">   * _.template(&#39;&lt;% print(&quot;hello &quot; + epithet); %&gt;!&#39;, { &#39;epithet&#39;: &#39;stooge&#39; });</span>
<span class="cm">   * // =&gt; &#39;hello stooge!&#39;</span>
<span class="cm">   *</span>
<span class="cm">   * // using custom template delimiters</span>
<span class="cm">   * _.templateSettings = {</span>
<span class="cm">   *   &#39;interpolate&#39;: /{{([\s\S]+?)}}/g</span>
<span class="cm">   * };</span>
<span class="cm">   *</span>
<span class="cm">   * _.template(&#39;hello {{ name }}!&#39;, { &#39;name&#39;: &#39;mustache&#39; });</span>
<span class="cm">   * // =&gt; &#39;hello mustache!&#39;</span>
<span class="cm">   *</span>
<span class="cm">   * // using the `sourceURL` option to specify a custom sourceURL for the template</span>
<span class="cm">   * var compiled = _.template(&#39;hello &lt;%= name %&gt;&#39;, null, { &#39;sourceURL&#39;: &#39;/basic/greeting.jst&#39; });</span>
<span class="cm">   * compiled(data);</span>
<span class="cm">   * // =&gt; find the source of &quot;greeting.jst&quot; under the Sources tab or Resources panel of the web inspector</span>
<span class="cm">   *</span>
<span class="cm">   * // using the `variable` option to ensure a with-statement isn&#39;t used in the compiled template</span>
<span class="cm">   * var compiled = _.template(&#39;hi &lt;%= data.name %&gt;!&#39;, null, { &#39;variable&#39;: &#39;data&#39; });</span>
<span class="cm">   * compiled.source;</span>
<span class="cm">   * // =&gt; function(data) {</span>
<span class="cm">   *   var __t, __p = &#39;&#39;, __e = _.escape;</span>
<span class="cm">   *   __p += &#39;hi &#39; + ((__t = ( data.name )) == null ? &#39;&#39; : __t) + &#39;!&#39;;</span>
<span class="cm">   *   return __p;</span>
<span class="cm">   * }</span>
<span class="cm">   *</span>
<span class="cm">   * // using the `source` property to inline compiled templates for meaningful</span>
<span class="cm">   * // line numbers in error messages and a stack trace</span>
<span class="cm">   * fs.writeFileSync(path.join(cwd, &#39;jst.js&#39;), &#39;\</span>
<span class="cm">   *   var JST = {\</span>
<span class="cm">   *     &quot;main&quot;: &#39; + _.template(mainText).source + &#39;\</span>
<span class="cm">   *   };\</span>
<span class="cm">   * &#39;);</span>
<span class="cm">   */</span>
  <span class="kd">function</span> <span class="nx">template</span><span class="p">(</span><span class="nx">text</span><span class="p">,</span> <span class="nx">data</span><span class="p">,</span> <span class="nx">options</span><span class="p">)</span> <span class="p">{</span></pre></div></div>
            
        </li>
        
           
        <li id="section-55">
            <div class="annotation">
              <div class="pilwrap">
                <a class="pilcrow" href="#section-55">&#182;</a>
              </div>            
              
<p>based on John Resig&#39;s <code>tmpl</code> implementation
<a href="http://ejohn.org/blog/javascript-micro-templating/">http://ejohn.org/blog/javascript-micro-templating/</a>
and Laura Doktorova&#39;s doT.js
<a href="https://github.com/olado/doT">https://github.com/olado/doT</a></p>

            </div>
            
            <div class="content"><div class="highlight"><pre>    <span class="kd">var</span> <span class="nx">settings</span> <span class="o">=</span> <span class="nx">lodash</span><span class="p">.</span><span class="nx">templateSettings</span><span class="p">;</span>
    <span class="nx">text</span> <span class="o">||</span> <span class="p">(</span><span class="nx">text</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span><span class="p">);</span></pre></div></div>
            
        </li>
        
           
        <li id="section-56">
            <div class="annotation">
              <div class="pilwrap">
                <a class="pilcrow" href="#section-56">&#182;</a>
              </div>            
              
<p>avoid missing dependencies when <code>iteratorTemplate</code> is not defined</p>

            </div>
            
            <div class="content"><div class="highlight"><pre>    <span class="nx">options</span> <span class="o">=</span> <span class="nx">defaults</span><span class="p">({},</span> <span class="nx">options</span><span class="p">,</span> <span class="nx">settings</span><span class="p">);</span>

    <span class="kd">var</span> <span class="nx">imports</span> <span class="o">=</span> <span class="nx">defaults</span><span class="p">({},</span> <span class="nx">options</span><span class="p">.</span><span class="nx">imports</span><span class="p">,</span> <span class="nx">settings</span><span class="p">.</span><span class="nx">imports</span><span class="p">),</span>
        <span class="nx">importsKeys</span> <span class="o">=</span> <span class="nx">keys</span><span class="p">(</span><span class="nx">imports</span><span class="p">),</span>
        <span class="nx">importsValues</span> <span class="o">=</span> <span class="nx">values</span><span class="p">(</span><span class="nx">imports</span><span class="p">);</span>

    <span class="kd">var</span> <span class="nx">isEvaluating</span><span class="p">,</span>
        <span class="nx">index</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
        <span class="nx">interpolate</span> <span class="o">=</span> <span class="nx">options</span><span class="p">.</span><span class="nx">interpolate</span> <span class="o">||</span> <span class="nx">reNoMatch</span><span class="p">,</span>
        <span class="nx">source</span> <span class="o">=</span> <span class="s2">&quot;__p += &#39;&quot;</span><span class="p">;</span></pre></div></div>
            
        </li>
        
           
        <li id="section-57">
            <div class="annotation">
              <div class="pilwrap">
                <a class="pilcrow" href="#section-57">&#182;</a>
              </div>            
              
<p>compile the regexp to match each delimiter</p>

            </div>
            
            <div class="content"><div class="highlight"><pre>    <span class="kd">var</span> <span class="nx">reDelimiters</span> <span class="o">=</span> <span class="nb">RegExp</span><span class="p">(</span>
      <span class="p">(</span><span class="nx">options</span><span class="p">.</span><span class="nx">escape</span> <span class="o">||</span> <span class="nx">reNoMatch</span><span class="p">).</span><span class="nx">source</span> <span class="o">+</span> <span class="s1">&#39;|&#39;</span> <span class="o">+</span>
      <span class="nx">interpolate</span><span class="p">.</span><span class="nx">source</span> <span class="o">+</span> <span class="s1">&#39;|&#39;</span> <span class="o">+</span>
      <span class="p">(</span><span class="nx">interpolate</span> <span class="o">===</span> <span class="nx">reInterpolate</span> <span class="o">?</span> <span class="nx">reEsTemplate</span> <span class="o">:</span> <span class="nx">reNoMatch</span><span class="p">).</span><span class="nx">source</span> <span class="o">+</span> <span class="s1">&#39;|&#39;</span> <span class="o">+</span>
      <span class="p">(</span><span class="nx">options</span><span class="p">.</span><span class="nx">evaluate</span> <span class="o">||</span> <span class="nx">reNoMatch</span><span class="p">).</span><span class="nx">source</span> <span class="o">+</span> <span class="s1">&#39;|$&#39;</span>
    <span class="p">,</span> <span class="s1">&#39;g&#39;</span><span class="p">);</span>

    <span class="nx">text</span><span class="p">.</span><span class="nx">replace</span><span class="p">(</span><span class="nx">reDelimiters</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">match</span><span class="p">,</span> <span class="nx">escapeValue</span><span class="p">,</span> <span class="nx">interpolateValue</span><span class="p">,</span> <span class="nx">esTemplateValue</span><span class="p">,</span> <span class="nx">evaluateValue</span><span class="p">,</span> <span class="nx">offset</span><span class="p">)</span> <span class="p">{</span>
      <span class="nx">interpolateValue</span> <span class="o">||</span> <span class="p">(</span><span class="nx">interpolateValue</span> <span class="o">=</span> <span class="nx">esTemplateValue</span><span class="p">);</span></pre></div></div>
            
        </li>
        
           
        <li id="section-58">
            <div class="annotation">
              <div class="pilwrap">
                <a class="pilcrow" href="#section-58">&#182;</a>
              </div>            
              
<p>escape characters that cannot be included in string literals</p>

            </div>
            
            <div class="content"><div class="highlight"><pre>      <span class="nx">source</span> <span class="o">+=</span> <span class="nx">text</span><span class="p">.</span><span class="nx">slice</span><span class="p">(</span><span class="nx">index</span><span class="p">,</span> <span class="nx">offset</span><span class="p">).</span><span class="nx">replace</span><span class="p">(</span><span class="nx">reUnescapedString</span><span class="p">,</span> <span class="nx">escapeStringChar</span><span class="p">);</span></pre></div></div>
            
        </li>
        
           
        <li id="section-59">
            <div class="annotation">
              <div class="pilwrap">
                <a class="pilcrow" href="#section-59">&#182;</a>
              </div>            
              
<p>replace delimiters with snippets</p>

            </div>
            
            <div class="content"><div class="highlight"><pre>      <span class="k">if</span> <span class="p">(</span><span class="nx">escapeValue</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">source</span> <span class="o">+=</span> <span class="s2">&quot;&#39; +\n__e(&quot;</span> <span class="o">+</span> <span class="nx">escapeValue</span> <span class="o">+</span> <span class="s2">&quot;) +\n&#39;&quot;</span><span class="p">;</span>
      <span class="p">}</span>
      <span class="k">if</span> <span class="p">(</span><span class="nx">evaluateValue</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">isEvaluating</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span>
        <span class="nx">source</span> <span class="o">+=</span> <span class="s2">&quot;&#39;;\n&quot;</span> <span class="o">+</span> <span class="nx">evaluateValue</span> <span class="o">+</span> <span class="s2">&quot;;\n__p += &#39;&quot;</span><span class="p">;</span>
      <span class="p">}</span>
      <span class="k">if</span> <span class="p">(</span><span class="nx">interpolateValue</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">source</span> <span class="o">+=</span> <span class="s2">&quot;&#39; +\n((__t = (&quot;</span> <span class="o">+</span> <span class="nx">interpolateValue</span> <span class="o">+</span> <span class="s2">&quot;)) == null ? &#39;&#39; : __t) +\n&#39;&quot;</span><span class="p">;</span>
      <span class="p">}</span>
      <span class="nx">index</span> <span class="o">=</span> <span class="nx">offset</span> <span class="o">+</span> <span class="nx">match</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span></pre></div></div>
            
        </li>
        
           
        <li id="section-60">
            <div class="annotation">
              <div class="pilwrap">
                <a class="pilcrow" href="#section-60">&#182;</a>
              </div>            
              
<p>the JS engine embedded in Adobe products requires returning the <code>match</code>
string in order to produce the correct <code>offset</code> value</p>

            </div>
            
            <div class="content"><div class="highlight"><pre>      <span class="k">return</span> <span class="nx">match</span><span class="p">;</span>
    <span class="p">});</span>

    <span class="nx">source</span> <span class="o">+=</span> <span class="s2">&quot;&#39;;\n&quot;</span><span class="p">;</span></pre></div></div>
            
        </li>
        
           
        <li id="section-61">
            <div class="annotation">
              <div class="pilwrap">
                <a class="pilcrow" href="#section-61">&#182;</a>
              </div>            
              
<p>if <code>variable</code> is not specified, wrap a with-statement around the generated
code to add the data object to the top of the scope chain</p>

            </div>
            
            <div class="content"><div class="highlight"><pre>    <span class="kd">var</span> <span class="nx">variable</span> <span class="o">=</span> <span class="nx">options</span><span class="p">.</span><span class="nx">variable</span><span class="p">,</span>
        <span class="nx">hasVariable</span> <span class="o">=</span> <span class="nx">variable</span><span class="p">;</span>

    <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">hasVariable</span><span class="p">)</span> <span class="p">{</span>
      <span class="nx">variable</span> <span class="o">=</span> <span class="s1">&#39;obj&#39;</span><span class="p">;</span>
      <span class="nx">source</span> <span class="o">=</span> <span class="s1">&#39;with (&#39;</span> <span class="o">+</span> <span class="nx">variable</span> <span class="o">+</span> <span class="s1">&#39;) {\n&#39;</span> <span class="o">+</span> <span class="nx">source</span> <span class="o">+</span> <span class="s1">&#39;\n}\n&#39;</span><span class="p">;</span>
    <span class="p">}</span></pre></div></div>
            
        </li>
        
           
        <li id="section-62">
            <div class="annotation">
              <div class="pilwrap">
                <a class="pilcrow" href="#section-62">&#182;</a>
              </div>            
              
<p>cleanup code by stripping empty strings</p>

            </div>
            
            <div class="content"><div class="highlight"><pre>    <span class="nx">source</span> <span class="o">=</span> <span class="p">(</span><span class="nx">isEvaluating</span> <span class="o">?</span> <span class="nx">source</span><span class="p">.</span><span class="nx">replace</span><span class="p">(</span><span class="nx">reEmptyStringLeading</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">)</span> <span class="o">:</span> <span class="nx">source</span><span class="p">)</span>
      <span class="p">.</span><span class="nx">replace</span><span class="p">(</span><span class="nx">reEmptyStringMiddle</span><span class="p">,</span> <span class="s1">&#39;$1&#39;</span><span class="p">)</span>
      <span class="p">.</span><span class="nx">replace</span><span class="p">(</span><span class="nx">reEmptyStringTrailing</span><span class="p">,</span> <span class="s1">&#39;$1;&#39;</span><span class="p">);</span></pre></div></div>
            
        </li>
        
           
        <li id="section-63">
            <div class="annotation">
              <div class="pilwrap">
                <a class="pilcrow" href="#section-63">&#182;</a>
              </div>            
              
<p>frame code as the function body</p>

            </div>
            
            <div class="content"><div class="highlight"><pre>    <span class="nx">source</span> <span class="o">=</span> <span class="s1">&#39;function(&#39;</span> <span class="o">+</span> <span class="nx">variable</span> <span class="o">+</span> <span class="s1">&#39;) {\n&#39;</span> <span class="o">+</span>
      <span class="p">(</span><span class="nx">hasVariable</span> <span class="o">?</span> <span class="s1">&#39;&#39;</span> <span class="o">:</span> <span class="nx">variable</span> <span class="o">+</span> <span class="s1">&#39; || (&#39;</span> <span class="o">+</span> <span class="nx">variable</span> <span class="o">+</span> <span class="s1">&#39; = {});\n&#39;</span><span class="p">)</span> <span class="o">+</span>
      <span class="s2">&quot;var __t, __p = &#39;&#39;, __e = _.escape&quot;</span> <span class="o">+</span>
      <span class="p">(</span><span class="nx">isEvaluating</span>
        <span class="o">?</span> <span class="s1">&#39;, __j = Array.prototype.join;\n&#39;</span> <span class="o">+</span>
          <span class="s2">&quot;function print() { __p += __j.call(arguments, &#39;&#39;) }\n&quot;</span>
        <span class="o">:</span> <span class="s1">&#39;;\n&#39;</span>
      <span class="p">)</span> <span class="o">+</span>
      <span class="nx">source</span> <span class="o">+</span>
      <span class="s1">&#39;return __p\n}&#39;</span><span class="p">;</span></pre></div></div>
            
        </li>
        
           
        <li id="section-64">
            <div class="annotation">
              <div class="pilwrap">
                <a class="pilcrow" href="#section-64">&#182;</a>
              </div>            
              
<p>Use a sourceURL for easier debugging and wrap in a multi-line comment to
avoid issues with Narwhal, IE conditional compilation, and the JS engine
embedded in Adobe products.
<a href="http://www.html5rocks.com/en/tutorials/developertools/sourcemaps/#toc-sourceurl">http://www.html5rocks.com/en/tutorials/developertools/sourcemaps/#toc-sourceurl</a></p>

            </div>
            
            <div class="content"><div class="highlight"><pre>    <span class="kd">var</span> <span class="nx">sourceURL</span> <span class="o">=</span> <span class="s1">&#39;\n/*\n//@ sourceURL=&#39;</span> <span class="o">+</span> <span class="p">(</span><span class="nx">options</span><span class="p">.</span><span class="nx">sourceURL</span> <span class="o">||</span> <span class="s1">&#39;/lodash/template/source[&#39;</span> <span class="o">+</span> <span class="p">(</span><span class="nx">templateCounter</span><span class="o">++</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;]&#39;</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;\n*/&#39;</span><span class="p">;</span>

    <span class="k">try</span> <span class="p">{</span>
      <span class="kd">var</span> <span class="nx">result</span> <span class="o">=</span> <span class="nb">Function</span><span class="p">(</span><span class="nx">importsKeys</span><span class="p">,</span> <span class="s1">&#39;return &#39;</span> <span class="o">+</span> <span class="nx">source</span> <span class="o">+</span> <span class="nx">sourceURL</span><span class="p">).</span><span class="nx">apply</span><span class="p">(</span><span class="kc">undefined</span><span class="p">,</span> <span class="nx">importsValues</span><span class="p">);</span>
    <span class="p">}</span> <span class="k">catch</span><span class="p">(</span><span class="nx">e</span><span class="p">)</span> <span class="p">{</span>
      <span class="nx">e</span><span class="p">.</span><span class="nx">source</span> <span class="o">=</span> <span class="nx">source</span><span class="p">;</span>
      <span class="k">throw</span> <span class="nx">e</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">data</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">return</span> <span class="nx">result</span><span class="p">(</span><span class="nx">data</span><span class="p">);</span>
    <span class="p">}</span></pre></div></div>
            
        </li>
        
           
        <li id="section-65">
            <div class="annotation">
              <div class="pilwrap">
                <a class="pilcrow" href="#section-65">&#182;</a>
              </div>            
              
<p>provide the compiled function&#39;s source via its <code>toString</code> method, in
supported environments, or the <code>source</code> property as a convenience for
inlining compiled templates during the build process</p>

            </div>
            
            <div class="content"><div class="highlight"><pre>    <span class="nx">result</span><span class="p">.</span><span class="nx">source</span> <span class="o">=</span> <span class="nx">source</span><span class="p">;</span>
    <span class="k">return</span> <span class="nx">result</span><span class="p">;</span>
  <span class="p">}</span>

  <span class="cm">/*--------------------------------------------------------------------------*/</span>

  <span class="nx">lodash</span><span class="p">.</span><span class="nx">createCallback</span> <span class="o">=</span> <span class="nx">createCallback</span><span class="p">;</span>
  <span class="nx">lodash</span><span class="p">.</span><span class="nx">defaults</span> <span class="o">=</span> <span class="nx">defaults</span><span class="p">;</span>
  <span class="nx">lodash</span><span class="p">.</span><span class="nx">forIn</span> <span class="o">=</span> <span class="nx">forIn</span><span class="p">;</span>
  <span class="nx">lodash</span><span class="p">.</span><span class="nx">forOwn</span> <span class="o">=</span> <span class="nx">forOwn</span><span class="p">;</span>
  <span class="nx">lodash</span><span class="p">.</span><span class="nx">keys</span> <span class="o">=</span> <span class="nx">keys</span><span class="p">;</span>
  <span class="nx">lodash</span><span class="p">.</span><span class="nx">values</span> <span class="o">=</span> <span class="nx">values</span><span class="p">;</span>

  <span class="cm">/*--------------------------------------------------------------------------*/</span>

  <span class="nx">lodash</span><span class="p">.</span><span class="nx">escape</span> <span class="o">=</span> <span class="nx">escape</span><span class="p">;</span>
  <span class="nx">lodash</span><span class="p">.</span><span class="nx">identity</span> <span class="o">=</span> <span class="nx">identity</span><span class="p">;</span>
  <span class="nx">lodash</span><span class="p">.</span><span class="nx">isArguments</span> <span class="o">=</span> <span class="nx">isArguments</span><span class="p">;</span>
  <span class="nx">lodash</span><span class="p">.</span><span class="nx">isArray</span> <span class="o">=</span> <span class="nx">isArray</span><span class="p">;</span>
  <span class="nx">lodash</span><span class="p">.</span><span class="nx">isEqual</span> <span class="o">=</span> <span class="nx">isEqual</span><span class="p">;</span>
  <span class="nx">lodash</span><span class="p">.</span><span class="nx">isFunction</span> <span class="o">=</span> <span class="nx">isFunction</span><span class="p">;</span>
  <span class="nx">lodash</span><span class="p">.</span><span class="nx">isObject</span> <span class="o">=</span> <span class="nx">isObject</span><span class="p">;</span>
  <span class="nx">lodash</span><span class="p">.</span><span class="nx">template</span> <span class="o">=</span> <span class="nx">template</span><span class="p">;</span>

  <span class="cm">/*--------------------------------------------------------------------------*/</span>

  <span class="cm">/**</span>
<span class="cm">   * The semantic version number.</span>
<span class="cm">   *</span>
<span class="cm">   * @static</span>
<span class="cm">   * @memberOf _</span>
<span class="cm">   * @type String</span>
<span class="cm">   */</span>
  <span class="nx">lodash</span><span class="p">.</span><span class="nx">VERSION</span> <span class="o">=</span> <span class="s1">&#39;1.2.1&#39;</span><span class="p">;</span>

  <span class="cm">/*--------------------------------------------------------------------------*/</span></pre></div></div>
            
        </li>
        
           
        <li id="section-66">
            <div class="annotation">
              <div class="pilwrap">
                <a class="pilcrow" href="#section-66">&#182;</a>
              </div>            
              
<p>expose Lo-Dash
some AMD build optimizers, like r.js, check for specific condition patterns like the following:</p>

            </div>
            
            <div class="content"><div class="highlight"><pre>  <span class="k">if</span> <span class="p">(</span><span class="k">typeof</span> <span class="nx">define</span> <span class="o">==</span> <span class="s1">&#39;function&#39;</span> <span class="o">&amp;&amp;</span> <span class="k">typeof</span> <span class="nx">define</span><span class="p">.</span><span class="nx">amd</span> <span class="o">==</span> <span class="s1">&#39;object&#39;</span> <span class="o">&amp;&amp;</span> <span class="nx">define</span><span class="p">.</span><span class="nx">amd</span><span class="p">)</span> <span class="p">{</span></pre></div></div>
            
        </li>
        
           
        <li id="section-67">
            <div class="annotation">
              <div class="pilwrap">
                <a class="pilcrow" href="#section-67">&#182;</a>
              </div>            
              
<p>Expose Lo-Dash to the global object even when an AMD loader is present in
case Lo-Dash was injected by a third-party script and not intended to be
loaded as a module. The global assignment can be reverted in the Lo-Dash
module via its <code>noConflict()</code> method.</p>

            </div>
            
            <div class="content"><div class="highlight"><pre>    <span class="nb">window</span><span class="p">.</span><span class="nx">_</span> <span class="o">=</span> <span class="nx">lodash</span><span class="p">;</span></pre></div></div>
            
        </li>
        
           
        <li id="section-68">
            <div class="annotation">
              <div class="pilwrap">
                <a class="pilcrow" href="#section-68">&#182;</a>
              </div>            
              
<p>define as an anonymous module so, through path mapping, it can be
referenced as the &quot;underscore&quot; module</p>

            </div>
            
            <div class="content"><div class="highlight"><pre>    <span class="nx">define</span><span class="p">(</span><span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
      <span class="k">return</span> <span class="nx">lodash</span><span class="p">;</span>
    <span class="p">});</span>
  <span class="p">}</span></pre></div></div>
            
        </li>
        
           
        <li id="section-69">
            <div class="annotation">
              <div class="pilwrap">
                <a class="pilcrow" href="#section-69">&#182;</a>
              </div>            
              
<p>check for <code>exports</code> after <code>define</code> in case a build optimizer adds an <code>exports</code> object</p>

            </div>
            
            <div class="content"><div class="highlight"><pre>  <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="nx">freeExports</span> <span class="o">&amp;&amp;</span> <span class="o">!</span><span class="nx">freeExports</span><span class="p">.</span><span class="nx">nodeType</span><span class="p">)</span> <span class="p">{</span></pre></div></div>
            
        </li>
        
           
        <li id="section-70">
            <div class="annotation">
              <div class="pilwrap">
                <a class="pilcrow" href="#section-70">&#182;</a>
              </div>            
              
<p>in Node.js or RingoJS v0.8.0+</p>

            </div>
            
            <div class="content"><div class="highlight"><pre>    <span class="k">if</span> <span class="p">(</span><span class="nx">freeModule</span><span class="p">)</span> <span class="p">{</span>
      <span class="p">(</span><span class="nx">freeModule</span><span class="p">.</span><span class="nx">exports</span> <span class="o">=</span> <span class="nx">lodash</span><span class="p">).</span><span class="nx">_</span> <span class="o">=</span> <span class="nx">lodash</span><span class="p">;</span>
    <span class="p">}</span></pre></div></div>
            
        </li>
        
           
        <li id="section-71">
            <div class="annotation">
              <div class="pilwrap">
                <a class="pilcrow" href="#section-71">&#182;</a>
              </div>            
              
<p>in Narwhal or RingoJS v0.7.0-</p>

            </div>
            
            <div class="content"><div class="highlight"><pre>    <span class="k">else</span> <span class="p">{</span>
      <span class="nx">freeExports</span><span class="p">.</span><span class="nx">_</span> <span class="o">=</span> <span class="nx">lodash</span><span class="p">;</span>
    <span class="p">}</span>
  <span class="p">}</span>
  <span class="k">else</span> <span class="p">{</span></pre></div></div>
            
        </li>
        
           
        <li id="section-72">
            <div class="annotation">
              <div class="pilwrap">
                <a class="pilcrow" href="#section-72">&#182;</a>
              </div>            
              
<p>in a browser or Rhino</p>

            </div>
            
            <div class="content"><div class="highlight"><pre>    <span class="nb">window</span><span class="p">.</span><span class="nx">_</span> <span class="o">=</span> <span class="nx">lodash</span><span class="p">;</span>
  <span class="p">}</span>
<span class="p">}(</span><span class="k">this</span><span class="p">));</span>

</pre></div></div>
            
        </li>
        
    </ul> 
  </div>
</body>
</html>
